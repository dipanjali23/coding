"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1942],{31942:function(e,l,a){a.d(l,{Z:function(){return eR}});var t=a(74817),r=a(71248),s=a(36497),n=a(51645),o=a(36842),i=a(6561),d=a(94308),c=a(37518),u=a.n(c),p=a(20373),b=a.n(p),x=a(19249),h=a(22170),m=a(4901),v=a(32014),f=a(46114),g=e=>{let{curTrigger:l,disabled:a,onChange:r}=e;return(0,t.jsxs)(f.Z,{disabled:a,value:l,onChange:e=>{r(e.target.value)},required:!0,children:[(0,t.jsx)("option",{disabled:!0,hidden:!0,value:"",children:"Select"},"placeholder"),m.Ae.map(e=>(0,t.jsx)("option",{value:e,children:(0,v.jS)(e,!1)},e))]})},k=a(58535),y=a(89970),j=a(77797),w=a(2586),N=e=>{let{canAddContentType:l,typesToSkip:a=[],onCreateBlock:s,onCreateTemplateBlock:o,className:i="",templateBlocks:d=[]}=e,[c,p]=(0,r.useState)(!1),{user:b}=(0,n.a)(),x=(0,y.G)(null==b?void 0:b.id);return(0,t.jsxs)("div",{className:"relative ".concat(i),children:[(0,t.jsx)("div",{className:"flex flex-row items-center justify-center",children:(0,t.jsxs)("button",{onClick:()=>p(!c),className:"rounded-[14px] bg-[#F4F0E9] px-4 py-2 text-[15px] font-[500] text-[#504C46] enabled:hover:bg-[#e4e0d9] disabled:opacity-50 dark:bg-[#2a2a2a] dark:text-white dark:enabled:hover:bg-[#1f1f1f]",disabled:!l,children:[(0,t.jsx)("span",{className:"sr-only",children:c?"Close Options":"Open Options"}),c?(0,t.jsx)(j.Z,{className:"h-5 w-5 dark:text-white","aria-hidden":"true"}):(0,t.jsx)(w.Z,{className:"h-5 w-5 dark:text-white","aria-hidden":"true"})]})}),c&&(0,t.jsx)("div",{className:"mt-3 w-full pb-[3rem] md:w-auto",children:(0,t.jsxs)("div",{className:"w-[300px] space-y-4 rounded-lg border border-black/10 bg-white p-4 shadow-lg dark:border-[#1f1f1f] dark:bg-[#2a2a2a] md:w-[500px]",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2",children:m.Tr.filter(e=>!a.includes(e)).filter(e=>"user-block"!==e||x).filter(e=>"google-sheets"!==e||x).map(e=>(0,t.jsx)("button",{disabled:!l,onClick:()=>{p(!1),s(e)},className:"m-2 whitespace-nowrap rounded-lg border border-gray-200 bg-gray-100 px-4 py-2 font-bold text-black/90 enabled:hover:bg-gray-200 disabled:opacity-50 dark:border-[#2a2a2a] dark:bg-[#1f1f1f] dark:text-white dark:enabled:hover:bg-[#2a2a2a]",children:(0,v.jS)(e)},e))}),(0,t.jsx)("div",{className:"h-px w-full bg-black/10 dark:bg-[#1f1f1f]"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2",children:m.kD.filter(e=>!a.includes(e)).map(e=>(0,t.jsx)("button",{onClick:()=>{p(!1),s(e)},className:"m-2 whitespace-nowrap rounded-lg border border-gray-200 bg-gray-100 px-4 py-2 font-bold text-black/90 enabled:hover:bg-gray-300 disabled:opacity-50 dark:border-[#2a2a2a] dark:bg-[#1f1f1f] dark:text-white dark:enabled:hover:bg-[#2a2a2a]",children:(0,v.jS)(e)},e))}),d.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"h-px w-full bg-black/10 dark:bg-[#1f1f1f]"}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2",children:d.map((e,l)=>(0,t.jsx)("button",{onClick:()=>{p(!1),o(e)},className:"m-2 whitespace-nowrap rounded-lg border border-gray-200 bg-gray-100 px-4 py-2 font-bold text-black/90 enabled:hover:bg-gray-300 disabled:opacity-50 dark:border-[#2a2a2a] dark:bg-[#1f1f1f] dark:text-white dark:enabled:hover:bg-[#2a2a2a]",children:e.blockName},e.blockName||""+l))}),(0,t.jsx)("div",{className:"flex grid-cols-1 justify-center py-2",children:(0,t.jsx)(u(),{href:"/blocks#custom-blocks",target:"_blank",className:"h-[40px] whitespace-nowrap rounded-lg bg-cyan-500 px-3 py-2 text-center font-bold text-white enabled:hover:bg-cyan-400 disabled:opacity-50 dark:bg-[#00aaff] dark:text-white dark:hover:bg-white dark:hover:text-[#00aaff]",children:"Manage Custom Blocks"})})]})]})})]})},C=a(83252),S=a(15305),E=a(72317),_=a(50141),R=a(51827),Z=a(91835),L=a(42820),I=a(29008),D=a(20117),F=a(29386),T=a(32068),B=a(12947),A=a(37943),z=a(76422),U=a(82691),O=a(78301),M=a(38),P=a(82172);let G=(0,r.memo)(e=>{let{loop:l,message:a,creatorState:s,creatorControls:n,status:o,handleError:i,handleLoopUpdate:d,handleUpdateMessage:c,handleStopMessage:u,handleCreateVar:p,handleRegenerateCurBlock:b,handleUploadFiles:x,handlePublishLoop:h}=e,m=(0,r.useCallback)((e,l,a)=>{let t={...e,content:JSON.stringify({...l,details:a})};null==c||c(t)},[c]),v=(0,r.useMemo)(()=>{let e=!n||(null==s?void 0:s.status)==="done"||(0,D.lU)(s);if("validate"===a.type){let r=(0,O.OA)(a.content);if((null==r?void 0:r.decision)==="correct")return(0,t.jsx)(P.o,{justification:null==r?void 0:r.justification,isLast:!0,streaming:"messaging"===o});if((null==r?void 0:r.decision)==="incorrect-needs-rewrite")return(0,t.jsx)(B.g,{details:r.details,streaming:"messaging"===o,isLast:!0,disabled:e,blockResult:null==s?void 0:s.blockResult,loop:l,handleLoopUpdate:d,onError:e=>i((0,F.f0)(e)),onContinue:null==n?void 0:n.resume,onRewriteBlock:b,onUpdateDetails:e=>{m(a,r,e)}});if((null==r?void 0:r.decision)==="incorrect-needs-variable")return(0,t.jsx)(T.s,{details:r.details,streaming:"messaging"===o,isLast:!0,disabled:e,loop:l,handleLoopUpdate:d,onError:e=>i((0,F.f0)(e)),onCreateVar:p,onUpdateDetails:e=>{m(a,r,e)}});if((null==r?void 0:r.decision)==="incorrect-needs-user-intervention")return(0,t.jsx)(A.a,{details:r.details,isLast:!0,disabled:e,streaming:"messaging"===o,onError:e=>i((0,F.f0)(e)),onContinue:()=>{null==n||n.setLoop(l,!0),null==n||n.resume("fix")},onFixLoop:()=>{null==n||n.setLoop(l,!0),null==n||n.start()}});else if((null==r?void 0:r.decision)==="incorrect-needs-file-upload")return(0,t.jsx)(z.N,{streaming:"messaging"===o,isLast:!0,loopId:l.id,disabled:e,onError:e=>i((0,F.f0)(e)),onFilesUploaded:e=>x(e,l,d)});else return(0,t.jsx)(M.D,{justification:null==r?void 0:r.justification,isLast:!0,streaming:"messaging"===o})}return"success"===a.type?(0,t.jsx)(U.A,{isLast:!0,disabled:(0,D.lU)(s),onError:e=>i((0,F.f0)(e)),onPublish:h}):(0,t.jsx)(t.Fragment,{})},[o,n,s,h,p,b,x,m,l,a,i,d]);return(0,t.jsx)("div",{className:"flex h-full w-full flex-col",children:(0,t.jsx)("div",{className:"flex w-full flex-col overflow-y-auto",children:v})})});G.displayName="Loop Creator Message";var W=a(27019),V=a(81173),q=a(51254),J=a(85658),X=a(37010),H=a(12164),$=a(15072),K=a(42997),Y=a(33470),Q=a(22621),ee=a(90526),el=a(62965),ea=a(45576),et=a(50453),er=a(1178),es=a(2002);function en(e){let{className:l,children:a,size:r="default",...s}=e;return(0,t.jsxs)(V.Z,{size:r,className:(0,es.cn)("relative bg-purple-300 transition-all before:absolute before:inset-0 before:z-[-1] dark:bg-purple-400","before:animate-pulse before:rounded-md before:shadow-[0_0_10px_2px_rgba(147,51,234,0.3)]","enabled:hover:bg-purple-400","dark:enabled:hover:bg-purple-500","enabled:hover:before:shadow-[0_0_15px_3px_rgba(147,51,234,0.4)]","disabled:bg-purple-500 disabled:before:shadow-none","dark:before:shadow-[0_0_10px_2px_rgba(192,132,252,0.4)]","dark:enabled:hover:before:shadow-[0_0_15px_3px_rgba(192,132,252,0.5)]","default"===r&&"h-10 px-6 py-2",l),...s,children:[(0,t.jsx)(Q.Z,{className:(0,es.cn)("mr-1 text-black","sm"===r?"h-4 w-4":"h-5 w-5")}),(0,t.jsx)("span",{className:"text-black",children:a})]})}var eo=a(74870),ei=a(87392),ed=a(50352);function ec(e){var l;let{isPaidUser:a=!1,curLoop:s,creatorState:n,isRunning:o,isLoopEditableNow:i,isLoopReady:d,creatorControls:c,startAction:p,endAction:b,setError:h,handleLoopUpdate:m,handleLoopDryRun:v,handleLoopPublish:f,handleLoopDelete:g,abortController:k}=e,{t:y}=(0,x.Z)("loop"),[j,w]=(0,r.useState)(!1),[N,C]=(0,r.useState)(!1),[S,E]=(0,r.useState)(!1);function _(e){switch(e){case"owner-only":return"private";case"anyone-with-link":return"link-only";default:return"public"}}let[R,Z]=(0,r.useState)(_(s.visibility));(0,r.useEffect)(()=>{Z(_(s.visibility))},[s.visibility]);let L=[{value:"public",label:y("visibility.public"),icon:(0,t.jsx)(J.Z,{className:"h-4 w-4"})},{value:"link-only",label:y("visibility.linkOnly"),icon:(0,t.jsx)(X.Z,{className:"h-4 w-4"})},{value:"private",label:y("visibility.private"),icon:(0,t.jsx)(H.Z,{className:"h-4 w-4"})}],I=(0,r.useCallback)(async e=>{if(!s){h(y("errors.noLoopToUpdate"));return}let l=function(e){switch(e){case"private":return"owner-only";case"link-only":return"anyone-with-link";default:return"discoverable"}}(e);if(s.visibility!==l)try{h(void 0),w(!0),await (0,eo.FW)(s.id,l),Z(e),s.visibility=l}catch(e){console.error(e),h(e.message||y("errors.updateVisibility"))}finally{w(!1)}},[s,h,y]),F=(0,r.useCallback)(async()=>{try{if(!c.current)return;p("ai"),h(void 0),c.current.clearError(),(0,D.lU)(n)?c.current.pause():(c.current.setLoop(s),await m(),await c.current.start())}catch(e){console.error(e),h(e)}finally{b("ai")}},[c,n,s,m,h,p,b]),T=(0,r.useCallback)(async()=>{if(o()){var e;null==k||null===(e=k.current)||void 0===e||e.abort()}else await m(),await v()},[o,m,v,k]),B=(0,r.useCallback)(async()=>{await m(),await f(!0)},[m,f]),A=(0,r.useCallback)(async()=>{await f(!1)},[f]),z=(0,r.useCallback)(()=>{C(!0)},[]);return(0,t.jsxs)(er.pn,{delayDuration:0,children:[(0,t.jsxs)("div",{className:"flex w-full items-center justify-end space-x-2",children:[(null==s?void 0:s.published)?(0,t.jsxs)(er.u,{children:[(0,t.jsx)(er.aJ,{asChild:!0,children:(0,t.jsxs)(V.Z,{variant:"outline",size:"sm",onClick:A,disabled:!d(s),children:[(0,t.jsx)(Q.Z,{className:"mr-1 h-4 w-4"}),y("headerActions.deactivate")]})}),(0,t.jsx)(er._v,{children:y("tooltips.deactivate")})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(er.u,{children:[(0,t.jsx)(er.aJ,{asChild:!0,children:(0,t.jsxs)(V.Z,{size:"sm",className:"bg-orange-300 enabled:hover:bg-orange-400",onClick:F,disabled:o()||!c.current||!i(s)&&!(0,D.lU)(n),children:[(0,D.lU)(n)?(0,t.jsx)($.Z,{className:"mr-1 h-4 w-4"}):(0,t.jsx)(K.Z,{className:"mr-1 h-4 w-4"}),(0,D.lU)(n)?y("headerActions.stop"):y("headerActions.fix")]})}),(0,t.jsx)(er._v,{children:y("tooltips.fix")})]}),(0,t.jsxs)(er.u,{children:[(0,t.jsx)(er.aJ,{asChild:!0,children:(0,t.jsxs)(V.Z,{className:"bg-emerald-400 enabled:hover:bg-emerald-500",size:"sm",onClick:T,disabled:!d(s)||(0,D.lU)(n),children:[o()?(0,t.jsx)($.Z,{className:"mr-1 h-4 w-4"}):(0,t.jsx)(Y.Z,{className:"mr-1 h-4 w-4"}),o()?y("headerActions.stop"):y("headerActions.test")]})}),(0,t.jsx)(er._v,{children:y("tooltips.test")})]}),(0,t.jsxs)(er.u,{children:[(0,t.jsx)(er.aJ,{asChild:!0,children:(0,t.jsx)(en,{size:"sm",onClick:B,disabled:!i(s),children:y("headerActions.activate")})}),(0,t.jsx)(er._v,{children:y("tooltips.activate")})]})]}),(0,t.jsxs)(et.h_,{children:[(0,t.jsx)(et.$F,{asChild:!0,children:(0,t.jsxs)(V.Z,{variant:"outline",size:"sm",disabled:!i(s),children:[j&&(0,t.jsx)(q.Z,{className:"h-4 w-4"}),!j&&(null===(l=L.find(e=>e.value===R))||void 0===l?void 0:l.icon)]})}),(0,t.jsx)(et.AW,{align:"end",children:L.map(e=>(0,t.jsxs)(et.Xi,{onClick:()=>a||"public"===e.value?I(e.value):null,disabled:!a&&"public"!==e.value,children:[e.icon,(0,t.jsx)("span",{className:"ml-2",children:e.label}),!a&&"public"!==e.value&&(0,t.jsxs)(er.u,{children:[(0,t.jsx)(er.aJ,{asChild:!0,children:(0,t.jsx)("span",{className:"ml-2 rounded-full bg-muted px-2 py-0.5 text-xs font-medium text-muted-foreground",children:y("visibility.pro")})}),(0,t.jsx)(er._v,{children:(0,t.jsx)("p",{children:y("tooltips.proFeature")})})]})]},e.value))})]}),(0,t.jsxs)(et.h_,{children:[(0,t.jsx)(et.$F,{asChild:!0,children:(0,t.jsxs)(V.Z,{variant:"outline",size:"sm",disabled:!i(s),children:[(0,t.jsx)(ee.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"sr-only",children:y("navigation.options")})]})}),(0,t.jsxs)(et.AW,{align:"end",children:[(0,t.jsx)(et.Xi,{children:(0,t.jsx)(u(),{href:"/loop/".concat(null==s?void 0:s.id,"/runs"),children:(0,t.jsxs)("div",{className:"flex flex-row",children:[(0,t.jsx)(Y.Z,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:y("navigation.runs")})]})})}),(0,t.jsx)(et.Xi,{onClick:z,children:(0,t.jsxs)("div",{className:"flex flex-row",children:[(0,t.jsx)(el.Z,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:y("actions.duplicate")})]})}),(0,t.jsx)(et.Xi,{onClick:()=>E(!0),children:(0,t.jsxs)("div",{className:"flex flex-row",children:[(0,t.jsx)(ea.Z,{className:"mr-2 h-4 w-4"}),(0,t.jsx)("span",{children:y("actions.addTag")})]})}),(0,t.jsxs)(et.Xi,{onClick:g,children:[(0,t.jsx)("span",{className:"mr-2",children:"\uD83D\uDDD1️"}),(0,t.jsx)("span",{children:y("navigation.delete")})]}),(0,t.jsx)(et.Xi,{children:(0,t.jsxs)(u(),{href:"/help",children:[(0,t.jsx)("span",{className:"mr-2",children:"❓"}),(0,t.jsx)("span",{children:y("navigation.help")})]})})]})]})]}),N&&(0,t.jsx)(ei.Z,{loop:s,show:N,onClose:()=>C(!1)}),s&&(0,t.jsx)(ed.Z,{loopId:s.id,show:S,onClose:()=>E(!1)})]})}var eu=a(43685),ep=a(69054);let eb=(0,r.memo)(e=>{let{loop:l,loopGen:a,localMsgs:s,chatStatus:n,chatError:o,chatStyle:i,genMsgIndex:d,genState:c,genControls:u,autoGen:p=!1,setChatError:b,handleCreateLoop:x,handleSendMessage:h}=e,m=(0,r.useRef)(!1),[v,f]=(0,r.useState)(!1),[g,k]=(0,r.useState)(!0),[y,j]=(0,r.useState)(!0),w=(0,r.useRef)(null),N=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];w.current&&(w.current.scrollIntoView({behavior:e?"smooth":"auto",block:"end"}),j(!0))},[]);(0,r.useEffect)(()=>{N(!1)},[s,n,N]),(0,r.useEffect)(()=>{if(!g){let e=setTimeout(()=>{N(!0)},100);return()=>clearTimeout(e)}},[s,n,N,g]),(0,r.useLayoutEffect)(()=>{g&&(N(!1),k(!1))},[g,N]),(0,r.useEffect)(()=>{let e=new ResizeObserver(()=>{g||N(!0)});return w.current&&e.observe(w.current),()=>{e.disconnect()}},[g,N]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{f(!s||0===s.length)},500);return()=>clearTimeout(e)},[s]),(0,r.useEffect)(()=>{var e;if(!a||m.current)return;m.current=!0;let t=a.userInput||l.description,r=a.messages.some(e=>"ai"===e.role&&"referenceLoop"!==e.type),s=(null!==(e=l.blocks)&&void 0!==e?e:[]).length>=2;r||s||!t||(console.log("calling send message"),h({role:"user",type:"text",content:t}))},[a,l,h]);let C=(0,r.useCallback)(()=>{if(w.current){let{scrollTop:e,scrollHeight:l,clientHeight:a}=w.current.parentElement||document.documentElement;j(1>Math.abs(l-a-e))}},[]);(0,r.useEffect)(()=>{var e;let l=null===(e=w.current)||void 0===e?void 0:e.parentElement;if(l)return l.addEventListener("scroll",C),()=>l.removeEventListener("scroll",C)},[C]);let S=0===(null!=s?s:[]).length;return(0,t.jsxs)("div",{className:"flex h-full w-full flex-col bg-[#FEFCF8] dark:bg-[#1f1f1f]",children:[(0,t.jsxs)("div",{className:"relative flex-grow overflow-y-auto px-4",children:[S&&v&&(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 p-10 md:p-20",children:[(0,t.jsx)("label",{className:"text-3xl text-black/80 dark:text-gray-300",children:"\uD83E\uDE84"}),(0,t.jsx)("label",{className:"text-center italic text-black/40 dark:text-gray-500",children:"Try sending a message to the Loop Creator to help you get started!"})]}),null==s?void 0:s.map((e,a)=>{if((null==e?void 0:e.type)!=="outline")return null;let r=d===a;return(0,t.jsx)("div",{className:"m-auto flex\n                  ".concat("full"===i?"md:w-3/4 lg:w-1/2 2xl:w-2/5":"max-w-[580px]","\n                "),children:(0,t.jsx)(ep.O,{message:e,isLast:!0,state:r?c:void 0,streaming:"messaging"===n,autoGen:p,onError:e=>b((0,F.f0)(e)),onCreateLoop:e=>null==x?void 0:x(a,e),onPause:r?null==u?void 0:u.pause:void 0,onResume:r?()=>{null==u||u.setLoop(l),null==u||u.resume()}:void 0,onNextStep:r?()=>{null==u||u.setLoop(l),null==u||u.runOneStep()}:void 0},a)},a)}),"messaging"===n&&(null==s||!s.length||(null==s?void 0:s.length)<2)&&(0,t.jsx)("div",{className:"flex flex-row items-center justify-center gap-2 p-2 text-sm italic text-black dark:text-gray-300",children:(0,t.jsx)(eu.Z,{})}),"messaging"===n&&(null==s||!s.length||(null==s?void 0:s.length)>=2)&&(0,t.jsx)("div",{className:"flex flex-row items-center justify-center gap-2 p-2 text-sm italic text-black dark:text-gray-300",children:(0,t.jsx)(q.Z,{size:"20"})}),(0,t.jsx)("div",{ref:w,style:{minHeight:"1px"}})]}),o&&(0,t.jsx)("div",{className:"border-t border-gray-200 p-2 text-start text-sm italic text-red-600 dark:border-gray-700",children:null!=o?o:"Unknown error"})]})});eb.displayName="OutlineView";var ex=a(23489),eh=a(65414),em=a(75334),ev=a(253);function ef(e){var l;let{isOpen:a,onClose:s,onConfirm:n,suggestedName:o,operation:i,dataPreview:d,existingSpreadsheets:c=[]}=e,[u,p]=(0,r.useState)(""),[b,x]=(0,r.useState)(!1),[h,m]=(0,r.useState)(!1);(0,r.useEffect)(()=>{a&&(p(""),x(!1),m(!1))},[a]);let v=async()=>{if(u){x(!0);try{n(u)}finally{x(!1)}}},f=()=>{switch(i){case"append":return"add new rows to";case"update":return"update data in";case"create":return"create";default:return"modify"}},g=u.length>0;return(0,t.jsx)(ex.Vq,{open:a,onOpenChange:s,children:(0,t.jsxs)(ex.cZ,{className:"border-3 fixed left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 transform border-black bg-blue-100 p-0 shadow-[6px_6px_0px_0px_rgba(0,0,0,1)] sm:max-w-2xl",children:[(0,t.jsx)("div",{className:"border-b-3 border-black bg-blue-400 p-5",children:(0,t.jsx)(ex.$N,{className:"text-2xl font-black text-black",children:"SELECT SPREADSHEET"})}),(0,t.jsxs)("div",{className:"space-y-6 p-6",children:[(0,t.jsxs)("div",{className:"rounded border-2 border-black bg-white p-4",children:[(0,t.jsxs)("p",{className:"mb-2 text-lg font-semibold",children:["\uD83D\uDCCA About to ",f()," a Google Spreadsheet"]}),(0,t.jsx)("p",{className:"text-gray-700",children:"Please select a spreadsheet or create a new one to continue."})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(em.Z,{className:"text-lg font-bold",children:"Choose spreadsheet:"}),(0,t.jsx)(ev.q,{value:u,onChange:e=>{p(e),h||m(!0)},label:"Select or Create Spreadsheet",description:"Choose a spreadsheet to ".concat(f()),suggestedName:o,autoTriggerCreate:!h,onCreateCanceled:()=>{m(!0),p("")}})]}),d.length>0&&(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)(em.Z,{className:"text-lg font-bold",children:"\uD83D\uDCCB Data to be added:"}),(0,t.jsx)("div",{className:"max-h-40 overflow-auto rounded border-2 border-black bg-gray-50 p-4",children:(0,t.jsx)("table",{className:"w-full text-sm",children:(0,t.jsxs)("tbody",{children:[d.slice(0,5).map((e,l)=>(0,t.jsx)("tr",{className:0===l?"border-b font-semibold":"",children:e.map((e,l)=>(0,t.jsx)("td",{className:"border-r border-gray-300 px-2 py-1 last:border-r-0",children:e||"-"},l))},l)),d.length>5&&(0,t.jsx)("tr",{children:(0,t.jsxs)("td",{colSpan:(null===(l=d[0])||void 0===l?void 0:l.length)||1,className:"px-2 py-1 text-center italic text-gray-500",children:["... and ",d.length-5," more rows"]})})]})})})]})]}),(0,t.jsxs)("div",{className:"border-t-3 flex justify-end space-x-3 border-black bg-gray-100 p-5",children:[(0,t.jsx)(eh.z,{onClick:s,variant:"outline",className:"border-2 border-black",disabled:b,children:"Cancel"}),(0,t.jsx)(eh.z,{onClick:v,disabled:!g||b,className:"border-2 border-black bg-blue-500 text-white hover:bg-blue-600",children:b?"Processing...":"Continue"})]})]})})}let eg=()=>{let[e,l]=(0,r.useState)(!1),[a,t]=(0,r.useState)(null),[s,n]=(0,r.useState)(null),[o,i]=(0,r.useState)(null);return{isModalOpen:e,currentBlock:a,validationResult:s,showModal:(0,r.useCallback)((e,a,r)=>{t(e),n(a),i(()=>r),l(!0)},[]),handleConfirm:(0,r.useCallback)(e=>{o&&o(e),l(!1),t(null),n(null),i(null)},[o]),handleCancel:(0,r.useCallback)(()=>{l(!1),t(null),n(null),i(null)},[])}};var ek=a(5673),ey=a(82681),ej=a(76286),ew=a(37942);class eN{constructor(e,l){this.rawError=e,this.interrupt=l}}let eC=["initing","loading"],eS=["publishing","running"];var eE=a(19760);let e_=(e,l)=>{let a={},t={};return e.forEach((e,l)=>{var r,s,n,o,i;let d="file".concat(l+1);if(null===(r=e.type)||void 0===r?void 0:r.startsWith("image/")){let e=(t.image||0)+1;t.image=e,d=1===e?"image":"image".concat(e)}else if(null===(s=e.type)||void 0===s?void 0:s.includes("pdf")){let e=(t.document||0)+1;t.document=e,d=1===e?"document":"document".concat(e)}else if(null===(n=e.type)||void 0===n?void 0:n.includes("csv")){let e=(t.dataFile||0)+1;t.dataFile=e,d=1===e?"dataFile":"dataFile".concat(e)}else if(null===(o=e.type)||void 0===o?void 0:o.startsWith("video/")){let e=(t.video||0)+1;t.video=e,d=1===e?"video":"video".concat(e)}else if(null===(i=e.type)||void 0===i?void 0:i.startsWith("audio/")){let e=(t.audio||0)+1;t.audio=e,d=1===e?"audio":"audio".concat(e)}else{let e=(t.file||0)+1;t.file=e,d=1===e?"file":"file".concat(e)}a[d]="$EXAMPLE_FILES[".concat(l,"].url")}),JSON.stringify(a,null,2)};function eR(e){var l,a,c,p,m,f,j,w,T,B,A,z,U,M,P,J;let{loop:X,initLoopGen:H,refetchOnLoad:$=!1,showChat:K=!0,autoGen:Y=!1,onPublish:Q}=e,ee=(0,s.useRouter)(),el=null==X?void 0:X.id,{t:ea}=(0,x.Z)("loop"),et=(0,o.U0)(),{supabase:er,user:es,loading:en}=(0,n.a)(),{userUsage:ei}=(0,ek.$)(),[ed,eu]=(0,r.useState)(X),[ep,ex]=(0,r.useState)(H),[eh,em]=(0,r.useState)(!$),ev=(0,r.useRef)(),[eR,eZ]=(0,r.useState)([]),[eL,eI]=(0,r.useState)(!1),{actions:eD,error:eF,setError:eT,dirtyStatus:eB,setDirtyStatus:eA,highlight:ez,setHighlight:eU,addBlock:eO,copyBlock:eM,deleteBlock:eP,updateTrigger:eG,handleBlockChange:eW,handleOutputChange:eV,handleLoopUpdate:eq,handleLoopDelete:eJ,handleLoopPublish:eX,handleLoopDryRun:eH,handleLoopNameChange:e$,handleLoopDescriptionChange:eK,handleVarChange:eY,blockRefs:eQ,scrollToBlock:e0,isLoopReady:e1,isLoopEditableNow:e2,isRunning:e4,startAction:e5,endAction:e3,abortControllerRef:e7}=function(e){let{loop:l,setLoop:a,user:t,supabase:s,posthog:n,router:o,onPublish:i}=e,[d,c]=(0,r.useState)([]),[u,p]=(0,r.useState)(),x=(0,r.useRef)(l),[h,m]=(0,r.useState)({}),[f,g]=(0,r.useState)(),k=(0,r.useRef)({}),y=(0,r.useCallback)(e=>{c(l=>[...l,e])},[]),j=(0,r.useCallback)(e=>{c(l=>l.filter(l=>l!==e))},[]),w=d.some(e=>eC.includes(e)),N=d.some(e=>eS.includes(e)),C=(0,r.useCallback)(e=>!!e&&!w,[w]),S=(0,r.useCallback)(e=>C(e)&&!N&&!(null==e?void 0:e.published),[N,C]),E=(0,r.useCallback)(()=>d.includes("running"),[d]),_=(0,r.useCallback)(async(e,l)=>{a(a=>{let t=[...a.blocks];t.splice(e,0,l);let r={...a,blocks:t};return(0,ew.e)(l,r,s,"create","manual"),r})},[]),R=(0,r.useCallback)((e,l)=>{a(a=>{let t=[...a.blocks];return t.splice(e,0,l),{...a,blocks:t}})},[]),Z=(0,r.useCallback)(e=>{a(l=>{let a=l.blocks.filter(l=>l.id!==e);return{...l,blocks:a}})},[]),L=(0,r.useCallback)(e=>{a(l=>{if(0===l.blocks.length)return{...l,blocks:[e]};let a=l.blocks.map((l,a)=>0===a?e:l),r="api-trigger"===e.type,s=l.blocks.some(e=>"api-notify"===e.type);if(r&&!s){let e=(0,v.xW)(t,l,"api-notify");a.push(e)}else!r&&s&&(a=a.filter(e=>"api-notify"!==e.type));return{...l,blocks:a}})},[t]),I=(0,r.useCallback)((e,l)=>{a(a=>{var t;let r=a.blocks.findIndex(l=>l.id===e);if(-1===r)return a;let s=a.blocks[r],n="function"==typeof l?l(s):{...s,...l},o={...h[s.id]||{impl:!1,output:!1}};b().isEqual({...s,description:void 0},{...n,description:void 0})||(o.impl=!0),(null!==(t=s.description)&&void 0!==t?t:"")!==n.description&&(o.description=!0),m(e=>({...e,[s.id]:o}));let i=[...a.blocks];return i[r]=n,{...a,blocks:i}})},[h]),D=(0,r.useCallback)((e,l)=>{m(l=>({...l,[e]:{...l[e]||{},output:!0}})),a(a=>{var t,r,s;return{...a,testRunResult:{...null==a?void 0:a.testRunResult,blockResults:{...null==a?void 0:null===(t=a.testRunResult)||void 0===t?void 0:t.blockResults,[e]:{...null==a?void 0:null===(s=a.testRunResult)||void 0===s?void 0:null===(r=s.blockResults)||void 0===r?void 0:r[e],stdout:l,status:"not-ran"}}}}})},[]),F=(0,r.useCallback)((e,l)=>{var a;let t=null===(a=k.current[e])||void 0===a?void 0:a[l];(null==t?void 0:t.current)&&t.current.scrollIntoView({behavior:"smooth",block:"center"})},[]),T=(0,r.useCallback)(async e=>{var a;let t=null!=e?e:l;if(!t||l.published||d.includes("updating")||d.includes("initing")||d.includes("loading"))return;let{published:r,visibility:s,...n}=null!==(a=x.current)&&void 0!==a?a:{},{published:o,visibility:i,...c}=t;if(b().isEqual(n,c))return;y("updating");let u=null;try{let e=await (0,eo.Ot)(t);e?u=e:x.current=t}catch(e){u=e}u&&(console.error(u),p(u)),j("updating")},[l,d,y,j]),B=(0,r.useCallback)(async e=>{if(!l||!C(l))return!1;(0,ey.fJ)(n,"publish",{loopId:l.id}),y("publishing");let t=await (0,eo.Jo)(l,e);return t?((0,ey.gT)(n,"publish",{error:t,loopId:l.id},!1),p(new eN(t,!0)),j("publishing"),!1):(a(l=>({...l,published:e})),(0,ey.S_)(n,"publish",{loopId:l.id}),e&&i?i():e&&o?o.push("/loop/".concat(l.id,"/runs")):j("publishing"),!0)},[l,C,n,o,y,j]),A=(0,r.useCallback)(async()=>{if(!l||d.includes("initing")||d.includes("loading")||d.includes("updating"))return;y("updating");let e=null;try{let a=await (0,eo.nV)(l);!a&&o?o.push("/"):a&&(e=a)}catch(l){e=l}e&&(console.error(e),p(e)),j("updating")},[l,d,o,y,j]),z=(0,r.useRef)(null),U=(0,r.useCallback)(async e=>{var t;if(!(null==l?void 0:l.id)||!C(l))return;(0,ey.fJ)(n,"dry-run",{loopId:l.id,indexToRun:e}),y("running"),p(void 0),null===(t=z.current)||void 0===t||t.abort(),z.current=new AbortController;let r=null;await (0,eo.Qm)(l,z.current.signal,e,(e,t)=>{for(let[l,a]of Object.entries(e.blockResults)){let e="success"===a.status||"error"===a.status;h[l]&&e&&(h[l]={impl:!1,output:!1})}if(a(l=>({...l,testRunResult:e})),t){let e=l.blocks.findIndex(e=>e.id===t);e>=0&&(g({index:e,type:"block"}),F(t,"block"))}else g(void 0);r=e.error}),r?(0,ey.gT)(n,"dry-run",{error:r,loopId:l.id},!1):(0,ey.S_)(n,"dry-run",{loopId:l.id}),j("running")},[l,C,F,h,n,y,j]),O=(0,r.useCallback)(e=>{(null==l?void 0:l.id)&&((0,ej.DA)(l.id,e),a(l=>({...l,name:e})))},[null==l?void 0:l.id]),M=(0,r.useCallback)(e=>{(null==l?void 0:l.id)&&((0,ej.hr)(l.id,e),a(l=>({...l,description:e})))},[null==l?void 0:l.id]),P=(0,r.useCallback)(e=>{a(l=>({...l,variables:e}))},[]),G=(0,r.useRef)(null);return(0,r.useEffect)(()=>{var e;if(!l)return;let{published:a,visibility:t,...r}=null!==(e=x.current)&&void 0!==e?e:{},{published:s,visibility:n,...o}=l;if(!b().isEqual(r,o))return G.current&&clearTimeout(G.current),G.current=setTimeout(()=>T(),1e3),()=>{G.current&&clearTimeout(G.current)}},[l,T]),(0,r.useEffect)(()=>{if(!l)return;let e=new Set(l.blocks.map(e=>e.id));l.blocks.forEach(e=>{k.current[e.id]||(k.current[e.id]={block:r.createRef(),output:r.createRef()})}),Object.keys(k.current).forEach(l=>{e.has(l)||delete k.current[l]})},[l]),{actions:d,error:u,setError:p,dirtyStatus:h,setDirtyStatus:m,highlight:f,setHighlight:g,addBlock:_,copyBlock:R,deleteBlock:Z,updateTrigger:L,handleBlockChange:I,handleOutputChange:D,handleLoopUpdate:T,handleLoopDelete:A,handleLoopPublish:B,handleLoopDryRun:U,handleLoopNameChange:O,handleLoopDescriptionChange:M,handleVarChange:P,blockRefs:k,scrollToBlock:F,isLoopReady:C,isLoopEditableNow:S,isRunning:E,startAction:y,endAction:j,abortControllerRef:z}}({loop:ed,setLoop:eu,user:es,supabase:er,posthog:et,router:ee,onPublish:Q}),{localMsgs:e8,chatStatus:e6,chatError:e9,creatorState:le,showCreatorWelcome:ll,showCreatorMsg:la,creatorMsg:lt,creatorMsgStatus:lr,creatorControlsRef:ls,isLoopCreatorBusy:ln,setShowCreatorWelcome:lo,setShowCreatorMsg:li,setCreatorMsg:ld,setChatError:lc,setLocalMsgs:lu,initLoopCreator:lp,handleAiUpdateBlock:lb,handleSendMessage:lx,handleStopMessage:lh,handleCreateVarAndResumeLoopCreator:lm,handleRegenerateCurBlockAndResumeLoopCreator:lv,handleUploadFilesAndResumeLoopCreator:lf,handleSpreadsheetConfirmationAndResumeLoopCreator:lg,handleAddBlockAtIndex:lk}=function(e){var l,a;let{loopId:t,loop:s,setLoop:n,loopGen:o,posthog:i,supabase:d,startAction:c,endAction:u,setError:p,setDirtyStatus:b,setHighlight:x,scrollToBlock:h,handleLoopUpdate:m,handleLoopPublish:v,autoGen:f=!1,isLoopEditableNow:g,genId:k}=e,[y,j]=(0,r.useState)(null!==(l=null==o?void 0:o.messages)&&void 0!==l?l:[]),[w,N]=(0,r.useState)("idle"),[C,S]=(0,r.useState)(),[E,_]=(0,r.useState)(null!==(a=null==o?void 0:o.creatorState)&&void 0!==a?a:void 0),[R,Z]=(0,r.useState)(!1),[L,I]=(0,r.useState)("hide"),[F,T]=(0,r.useState)(),[B,A]=(0,r.useState)("loading"),z=(0,r.useRef)(),U=(0,D.lU)(E),M=(0,r.useCallback)(async(e,l,a)=>{var t;await (null===(t=z.current)||void 0===t?void 0:t.kill()),z.current=await (0,eE.uW)(i,k,e,e=>{var l,a,t,r,s;if(_(e),(null===(l=e.error)||void 0===l?void 0:l.resumeable)&&"Google Sheets block requires spreadsheet selection."===e.error.message&&void 0!==e.curBlockIndex&&(null===(t=e.loop.blocks)||void 0===t?void 0:null===(a=t[e.curBlockIndex])||void 0===a?void 0:a.type)==="google-sheets"){let l=e.loop.blocks[e.curBlockIndex],a={needsConfirmation:!0,suggestedName:l.suggestedSpreadsheetName||"".concat("append"===l.operation?"Data Collection":"Data Update"," - ").concat(new Date().toLocaleDateString()),validationDetails:{blockId:l.id,suggestedName:l.suggestedSpreadsheetName||"".concat("append"===l.operation?"Data Collection":"Data Update"," - ").concat(new Date().toLocaleDateString()),operation:l.operation,dataPreview:[],existingSpreadsheets:[]}};z.current&&z.current.clearError(),p({message:"TRIGGER_SPREADSHEET_MODAL",resumeable:!0,spreadsheetModalData:{block:l,validation:a}});return}if((0,eo.Hr)(k,e,d).catch(console.error),(0,D.lU)(e)||"paused"===e.status){let l=e.curBlockIndex,a=null===(s=e.loop.blocks)||void 0===s?void 0:null===(r=s[l])||void 0===r?void 0:r.id,t="block-run"===e.blockStatus||"block-validate"===e.blockStatus?"output":"block";x({index:l,type:t}),h(a,t)}else x(void 0)},e=>{n(e)},(e,l,a)=>{let t="dialog";if("validate"===e.type){let l=(0,O.OA)(e.content);t=(null==l?void 0:l.decision)&&"correct"!==l.decision?"inline":"status"}I(t),T(e),A(a?"idle":"messaging"),f&&a&&"success"===e.type&&(console.log("Should attempt to publish Loop here?"),v(!0)),j(a=>l&&a.length>0?(a[a.length-1]=e,[...a]):[...a,e])}),void 0!==l&&await z.current.createLoop(l),a&&(localStorage.getItem("edit-creator-welcome-shown")||Z(!0),await z.current.start())},[k,i,d,n]),P=(0,r.useCallback)(async(e,l,a,t)=>{t&&(a.blocks[e].description+="\nFIX: ".concat(t)),await m(a),c("ai");try{var r,s,n;z.current||await M(a),await (null===(r=z.current)||void 0===r?void 0:r.updateBlock(e,l,a));let t=null==a?void 0:null===(n=a.blocks)||void 0===n?void 0:null===(s=n[e])||void 0===s?void 0:s.id;b(e=>({...e,[t]:{}}))}catch(e){console.error(e),p(e)}finally{u("ai")}},[M,c,u,p,b]),G=(0,r.useCallback)(async(e,l,a)=>{var t,r;let s=[...l.variables||[]],n=!1;for(let l=0;l<s.length;l++)if(s[l].key===e.key){s[l]=e,n=!0;break}n||s.push(e);let o={...l,variables:s};await a(o),null===(t=z.current)||void 0===t||t.setLoop(o,!0),await (null===(r=z.current)||void 0===r?void 0:r.resume("fix"))},[]),W=(0,r.useCallback)(async(e,l,a)=>{var t,r;let s=null==E?void 0:E.curBlockIndex;if(void 0===s)return;let n=[...l.blocks];n[s]={...n[s],description:e};let o={...l,blocks:n};await a(o),null===(t=z.current)||void 0===t||t.setLoop(o,!0),await (null===(r=z.current)||void 0===r?void 0:r.resume("fix"))},[null==E?void 0:E.curBlockIndex]),V=(0,r.useCallback)(async(e,l,a,t)=>{let r=a.blocks.findIndex(l=>l.id===e);if(-1===r){console.error("❌ Block not found in loop:",e);return}let s=[...a.blocks],n=s[r];if("google-sheets"===n.type)s[r]={...n,spreadsheetId:l};else{console.error("❌ Block is not a GoogleSheets block:",n.type);return}let o={...a,blocks:s};try{var i;await t(o),await (null===(i=z.current)||void 0===i?void 0:i.resume("rerun"))}catch(e){throw console.error("❌ Failed to update loop and resume creator:",e),e}},[]),q=(0,r.useCallback)(async(e,l,a)=>{var t,r;let s=null==E?void 0:E.curBlockIndex;if(void 0===s)return;let n=[...l.blocks],o=n[s];if("api-trigger"===o.type){let a=e_(e,l.description||"");n[s]={...o,exampleFiles:e,exampleInput:a}}let i={...l,blocks:n};await a(i),null===(t=z.current)||void 0===t||t.setLoop(i,!0),await (null===(r=z.current)||void 0===r?void 0:r.resume("fix"))},[null==E?void 0:E.curBlockIndex]),J=(0,r.useCallback)(async e=>{if(!o)return!1;let l={len:e.content.length,index:y.length,genId:o.id};try{(0,ey.fJ)(i,"send message",l),N("messaging"),S(void 0);let a=y.length+1;j(l=>[...l,e]);let t=new AbortController,r=[];await (0,eo.bH)(o.id,e,t.signal,(e,l)=>{r=[...e],S(l?String(l):void 0),j(l=>{for(let t=0;t<e.length;t++)l[a+t]={...e[t]};return[...l]})}),(0,ey.S_)(i,"send message",l);for(let e=0;e<r.length;e++){if("outline"!==r[e].type)continue;let a=l.index+1+e;(0,O.OA)(r[e].content)?((0,ey.S_)(i,"create outline",{...l,index:a}),f&&M(s,a,!0)):(0,ey.gT)(i,"create outline",{error:Error("outline parse fail"),partialContent:r[e].content.slice(0,100),...l,index:a},!0)}return!0}catch(e){return console.error(e),(0,ey.gT)(i,"send message",{error:e,...l},!0),S(String(e)),!1}finally{N("idle")}},[o,s,y,i]),X=(0,r.useCallback)(async()=>{},[]),H=(0,r.useCallback)(async(e,l)=>{await m(e),c("ai");try{z.current||await M(e);for(let t=l;t<e.blocks.length;t++){var a;await (null===(a=z.current)||void 0===a?void 0:a.updateBlock(t,"gen",e))}b(a=>{let t={...a};return e.blocks.forEach((e,a)=>{a>=l&&e.id&&(t[e.id]={})}),t})}catch(e){console.error(e),p(e)}finally{u("ai")}},[M,c,u,p,b,m]),$=(0,r.useCallback)(async(e,l,a)=>{try{var t;z.current||await M(a),await (null===(t=z.current)||void 0===t?void 0:t.addBlock(l,e,a,!0))}catch(e){console.error("Error adding block:",e)}},[z,M,m]);return{localMsgs:y,chatStatus:w,chatError:C,creatorState:E,showCreatorWelcome:R,showCreatorMsg:L,creatorMsg:F,creatorMsgStatus:B,creatorControlsRef:z,isLoopCreatorBusy:U,setLocalMsgs:j,setShowCreatorWelcome:Z,setShowCreatorMsg:I,setCreatorMsg:T,setCreatorMsgStatus:A,setChatError:S,initLoopCreator:M,handleAiUpdateBlock:P,handleSendMessage:J,handleStopMessage:X,handleCreateVarAndResumeLoopCreator:G,handleRegenerateCurBlockAndResumeLoopCreator:W,handleUploadFilesAndResumeLoopCreator:q,handleSpreadsheetConfirmationAndResumeLoopCreator:V,handleRegenerateLoop:H,handleAddBlockAtIndex:$}}({loopId:el,loop:ed,setLoop:eu,loopGen:ep,posthog:et,supabase:er,startAction:e5,endAction:e3,setError:eT,setDirtyStatus:eA,isLoopEditableNow:e2,genId:el,setHighlight:eU,scrollToBlock:e0,handleLoopUpdate:eq,handleLoopPublish:eX,autoGen:Y}),ly=(0,r.useRef)(),lj=(0,r.useRef)(null),lw=(0,r.useRef)(null),[lN,lC]=(0,r.useState)((null==ed?void 0:ed.description)||""),[lS,lE]=(0,r.useState)(!1),l_=eg(),lR=(0,r.useRef)(!1),lZ=(0,r.useCallback)(async e=>{if(l_.currentBlock){if(lR.current){l_.handleCancel();return}try{l_.handleCancel(),await lg(l_.currentBlock.id,e,ed,eq)}catch(e){console.error("Error confirming spreadsheet:",e),eT(e)}}},[l_,ed,eT,lg,eq]),lL=(0,r.useCallback)(async()=>{if(el)try{let e;let l=await (0,eo.gk)(el),a=await (0,eo.At)(el);if(!(null==l?void 0:l.loop)||!a)throw Error("Couldn't load Loop or LoopGen");eu(l.loop),ex(a),lu(null==a?void 0:a.messages),await lp(l.loop,e,!1)}catch(e){console.error("Error fetching loop/loopGen:",e),eT(e)}finally{em(!0)}},[el]);(0,r.useEffect)(()=>{$?!en&&es&&el&&lL():lp(ed,void 0,!1)},[$,en,es,el,lL]),(0,r.useEffect)(()=>{var e;(null==ed?void 0:null===(e=ed.blocks)||void 0===e?void 0:e.length)&&eI(!0)},[null==ed?void 0:null===(l=ed.blocks)||void 0===l?void 0:l.length]);let lI=(0,r.useCallback)(async e=>{eZ(await (0,eo.tw)(e))},[]),lD=(0,r.useCallback)(()=>lE(e=>!e),[]),lF=(0,r.useCallback)(e=>{var l;if(e.blockIndex>ed.blocks.length){eT({message:"Cannot add block beyond the end of the loop"});return}if((null===(l=ed.blocks[0])||void 0===l?void 0:l.type)==="api-trigger"&&e.blockIndex===ed.blocks.length){eT({message:"API-triggered loops must end with an API response block"});return}let a=(0,v.xW)(es,ed,e.type,void 0,e.description);lk({id:a.id,outputName:a.outputName,type:a.type,description:a.description},e.blockIndex,ed).catch(e=>{console.error("Error adding block:",e),eT(e)})},[ed,es,lk,eT]),[lT,lB]=(0,r.useState)(!1),lA=(0,r.useRef)(null);if((0,r.useEffect)(()=>{if(!lA.current)return;let e=new ResizeObserver(e=>{for(let l of e){let{width:e}=l.contentRect;lB(e<980)}});return e.observe(lA.current),()=>{lA.current&&e.unobserve(lA.current)}},[]),(0,r.useEffect)(()=>{es&&(0,eo.nE)(es.id).then(e=>eZ(e)).catch(e=>console.error("Failed to load block templates:",e))},[es]),(0,r.useEffect)(()=>{if(lS){var e;null===(e=lw.current)||void 0===e||e.focus()}},[lS]),(0,r.useEffect)(()=>{var e;if(!ed)return;lC((null==ed?void 0:ed.description)||"");let{published:l,visibility:a,...t}=null!==(e=ev.current)&&void 0!==e?e:{},{published:r,visibility:s,...n}=ed;if(!b().isEqual(t,n))return clearTimeout(ly.current),ly.current=setTimeout(()=>eq(),1e3),()=>clearTimeout(ly.current)},[ed,eq]),(0,r.useEffect)(()=>{let e=new Set(null==ed?void 0:ed.blocks.map(e=>e.id));null==ed||ed.blocks.forEach(e=>{eQ.current[e.id]||(eQ.current[e.id]={block:r.createRef(),output:r.createRef()})}),Object.keys(eQ.current).forEach(l=>{e.has(l)||delete eQ.current[l]})},[ed]),(0,r.useEffect)(()=>{var e;let l=(null==le?void 0:le.curBlockIndex)?null==ed?void 0:null===(e=ed.blocks[le.curBlockIndex])||void 0===e?void 0:e.id:void 0;(null==lt?void 0:lt.blockId)&&l&&lt.blockId!==l&&(ld(void 0),li("hide"))},[null==ed?void 0:ed.blocks,null==le?void 0:le.curBlockIndex,null==lt?void 0:lt.blockId]),(0,r.useEffect)(()=>{ll&&((null==eF?void 0:eF.interrupt)||"dialog"===la)&&lo(!1)},[ll,eF,la]),(0,r.useEffect)(()=>{if((null==eF?void 0:eF.resumeable)&&"TRIGGER_SPREADSHEET_MODAL"===eF.message&&eF.spreadsheetModalData){let{block:e,validation:l}=eF.spreadsheetModalData;eT(void 0),l_.showModal(e,l,async l=>{lR.current=!0;try{await lg(e.id,l,ed,eq)}catch(e){console.error("Error in spreadsheet confirmation:",e),eT(e)}finally{lR.current=!1}})}},[eF,eT,l_,ed,eu,ls,eq,lg,lR]),!eh)return(0,t.jsx)("div",{className:"flex h-full items-center justify-center",ref:lA,children:(0,t.jsx)(q.Z,{})});if(!ed||"loading"===e6)return(0,t.jsx)("div",{className:"flex h-full flex-col items-center justify-center",ref:lA,children:(0,t.jsx)(q.Z,{})});let lz=[{label:ea("common:nav.dashboard"),href:"/dashboard"},{label:ea("common:nav.loops"),href:"/loops"},{label:null!==(z=null==ed?void 0:ed.name)&&void 0!==z?z:ea("common.newLoopName")}],lU=eD.length>0||!!eF||!!(null==ed?void 0:null===(a=ed.testRunResult)||void 0===a?void 0:a.error)||ln,lO=(null==ed?void 0:null===(c=ed.blocks[0])||void 0===c?void 0:c.type)!=="api-trigger"||(null==ed?void 0:ed.blocks.some(e=>(null==e?void 0:e.type)==="api-notify"));return(0,t.jsxs)("div",{className:"flex h-full w-full overflow-hidden dark:bg-[#2a2a2a]",ref:lA,children:[(0,t.jsx)("div",{className:"\n          border-r\n          border-gray-200\n          transition-all duration-500 dark:border-[#2a2a2a]\n          ".concat(eL?!K||lT?"hidden w-0":"w-[500px]":"w-full","\n        "),children:(0,t.jsxs)("div",{className:"w-full border-r border-gray-200 dark:border-[#2a2a2a] ",children:[(0,t.jsxs)("div",{className:"static top-0 z-10 flex h-14 items-center gap-4 border-b px-4 py-4 dark:border-[#2a2a2a] dark:bg-[#1a1a1a] ".concat(lT?"hidden":""),children:[(0,t.jsx)(E.aG,{className:"hidden md:flex",children:(0,t.jsx)(E.Jb,{children:lz.map((e,l)=>(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)(E.gN,{children:e.href?(0,t.jsx)(E.At,{asChild:!0,className:"font-medium",children:(0,t.jsx)(u(),{prefetch:!1,href:e.href,children:e.label})}):(0,t.jsx)(E.AG,{className:"cursor-default font-medium",children:e.label})}),l<lz.length-1&&(0,t.jsx)(E.bg,{})]},l))})}),(0,t.jsx)("div",{className:"flex w-full flex-row justify-center md:hidden",children:(0,t.jsx)(W.Z,{sizeMultiplier:.5,className:"pt-4"})})]}),(0,t.jsx)("div",{className:"flex h-[calc(100vh-56px)] w-full dark:bg-[#1f1f1f]",children:K||eL?(0,t.jsx)(I.e,{loop:ed,loopGen:ep,localMsgs:e8,chatStatus:e6,chatError:e9,chatStyle:eL?"embed":lT?"embed":"full",genMsgIndex:void 0,genState:le,genControls:ls.current,setChatError:lc,handleLoopUpdate:eq,handleActivateLoop:()=>eX(!0),handleRegenerateCurBlock:e=>{lv(e,ed,eq)},handleSendMessage:lx,handleStopMessage:()=>{},handleCreateLoop:(e,l)=>{lp(ed,e,l)},handleCreateBlock:lF,handleUploadFiles:lf}):(0,t.jsx)(eb,{loop:ed,loopGen:ep,localMsgs:e8,chatStatus:e6,chatError:e9,chatStyle:eL?"embed":lT?"embed":"full",genMsgIndex:void 0,genState:le,genControls:ls.current,autoGen:Y,setChatError:lc,handleSendMessage:lx,handleCreateLoop:(e,l)=>{lp(ed,e,l)}})})]})}),(0,t.jsx)("div",{className:"\n          bg-radial-dots \n          overflow-y-auto \n          transition-all \n          duration-500 \n          dark:bg-[#2c2c2c]\n          ".concat(eL?lT?"w-full":"w-[calc(100vw-500px)]":"w-0","\n        "),children:(0,t.jsxs)("div",{className:"bg-radial-dots h-full flex-grow overflow-y-auto dark:bg-[#2c2c2c]",children:[(0,t.jsx)("div",{className:"pointer-events-none fixed h-full w-full\n                        ".concat(ln?"z-[4] bg-black bg-opacity-50 dark:bg-[#1f1f1f] dark:bg-opacity-80":"z-[-1]")}),(0,t.jsx)("div",{className:"sticky top-0 z-[29] flex h-14 w-full flex-col justify-end overflow-visible py-2 pr-1",children:(0,t.jsx)(ec,{isPaidUser:null==ei?void 0:ei.stripeIsSubActive,curLoop:ed,creatorState:le,isRunning:e4,isLoopEditableNow:e2,isLoopReady:e1,creatorControls:ls,startAction:e5,endAction:e3,setError:eT,handleLoopUpdate:eq,handleLoopDryRun:eH,handleLoopPublish:eX,handleLoopDelete:eJ,abortController:e7})}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4 pt-4",children:[lU&&(0,t.jsxs)("div",{className:"top-50 absolute right-3 z-[11] flex max-h-[200px] w-[350px] flex-col space-y-1 overflow-y-auto rounded-md border border-[3px] border-dashed border-sky-400 bg-white p-4 font-semibold text-emerald-600 shadow-none dark:border-sky-400 dark:bg-[#2a2a2a] dark:text-[#00ffcc]",children:[eF&&!(null==eF?void 0:eF.interrupt)&&(0,t.jsx)("p",{className:"cursor-pointer ".concat(eF.resumeable?"text-yellow-900":"text-red-600"),onClick:()=>eT(void 0),children:(0,F.f0)(eF).slice(0,250)}),(null==ed?void 0:null===(p=ed.testRunResult)||void 0===p?void 0:p.error)&&(0,t.jsx)("p",{className:"cursor-pointer text-red-600",onClick:()=>eu(e=>{var l,a;return{...e,testRunResult:{...e.testRunResult,blockResults:null!==(a=null===(l=e.testRunResult)||void 0===l?void 0:l.blockResults)&&void 0!==a?a:{},error:void 0}}}),children:(0,F.f0)(null==ed?void 0:null===(m=ed.testRunResult)||void 0===m?void 0:m.error).slice(0,250)}),ln?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:ea("status.".concat(null!==(U=null==le?void 0:le.blockStatus)&&void 0!==U?U:"ready"))}),(null==lt?void 0:lt.type)==="validate"&&(0,t.jsx)("p",{className:"text-xs font-normal text-black/90 dark:text-gray-400 ",children:null!==(M=null===(j=(0,O.OA)(null==lt?void 0:lt.content))||void 0===j?void 0:null===(f=j.justification)||void 0===f?void 0:f.slice(0,500))&&void 0!==M?M:"..."})]}):eD&&eD.length>0?(0,t.jsx)("p",{children:eD[0]&&ea("actions.".concat(eD[0]))}):null]}),(0,t.jsxs)("div",{className:"flex w-[90vw] flex-col items-center rounded-none border-2 border-black bg-white p-4 pl-2 shadow-[2px_2px_0_0_rgba(0,0,0,1)] dark:bg-[#212121] md:w-3/4 lg:w-3/5 2xl:w-1/2",children:[(0,t.jsx)("div",{className:"top-[2px]",children:(0,t.jsx)("h1",{contentEditable:e2(ed),className:"overflow-ellipsis p-2 text-center text-2xl text-gray-600 focus:outline-none dark:text-gray-200",onBlur:()=>{var e,l;e$(null!==(l=null==lj?void 0:null===(e=lj.current)||void 0===e?void 0:e.textContent)&&void 0!==l?l:"")},onKeyDown:e=>{if("Enter"===e.key){var l,a,t;e.preventDefault(),e$(null!==(t=null==lj?void 0:null===(l=lj.current)||void 0===l?void 0:l.textContent)&&void 0!==t?t:""),null===(a=lj.current)||void 0===a||a.blur()}},ref:lj,suppressContentEditableWarning:!0,children:null!==(P=null==ed?void 0:ed.name)&&void 0!==P?P:ea("common.newLoopName")})}),lS?(0,t.jsx)("div",{className:"flex w-full flex-col items-center justify-center px-2",children:(0,t.jsx)(R.Z,{containerClassName:"prose w-full text-sm text-black/90 border border-dashed border-black p-2 bg-white dark:bg-[#1f1f1f] dark:border-gray-700 dark:text-gray-200",value:lN,textClassName:"prose text-[1rem]",placeholder:ea("common.noDescription"),onChange:e=>eK(e),onBlur:()=>lE(!1),minRowCount:1,ref:lw})}):(0,t.jsx)("div",{className:"flex w-full flex-col items-center justify-center px-2 text-sm dark:text-gray-400",onClick:lD,children:(0,t.jsx)("div",{className:"prose w-full dark:text-gray-300",children:(0,t.jsx)(_.s,{remarkPlugins:[d.Z],children:lN||ea("common.clickToEditDescription")})})}),(0,t.jsx)("div",{className:"w-full pt-4 sm:px-4",children:(0,t.jsx)(C.Z,{loopVariables:null==ed?void 0:ed.variables,readOnly:!1,disabled:!e2(ed),onChange:eY})})]}),(0,t.jsxs)("div",{className:"flex flex-row items-center gap-2 pt-4",children:[(0,t.jsx)("p",{className:"font-semibold",children:ea("trigger.label")}),(0,t.jsx)(g,{disabled:!e2(ed),curTrigger:null!==(J=null==ed?void 0:null===(T=ed.blocks)||void 0===T?void 0:null===(w=T[0])||void 0===w?void 0:w.type)&&void 0!==J?J:"",onChange:e=>{var l;e!==(null==ed?void 0:null===(l=ed.blocks[0])||void 0===l?void 0:l.type)&&eG((0,v.xW)(es,ed,e))}}),(0,t.jsx)(S.Z,{content:ea("trigger.tooltip")})]}),!(null==ed?void 0:null===(B=ed.blocks)||void 0===B?void 0:B.length)&&(0,t.jsx)(N,{canAddContentType:e2(ed),typesToSkip:lO?["api-notify"]:void 0,onCreateBlock:e=>{if("user-block"===e&&!(0,y.G)(null==es?void 0:es.id))throw Error("User blocks are only available to admin users");eO(0,(0,v.xW)(es,ed,e))},templateBlocks:eR,onCreateTemplateBlock:e=>eO(0,(0,v.h_)(ed,e))}),null==ed?void 0:null===(A=ed.blocks)||void 0===A?void 0:A.map((e,l)=>{var a,r,s,n,o;let d=!e2(ed),c="api-notify"!==e.type,u=c||l<(null==ed?void 0:null===(a=ed.blocks)||void 0===a?void 0:a.length)-1,p="inline"===la&&e.id===(null==lt?void 0:lt.blockId),b=l===(null==ez?void 0:ez.index)?p?"loopCreatorMsg":null==ez?void 0:ez.type:void 0,x=l===(null==ez?void 0:ez.index)?"z-10":"",m="inline"===la&&(null==lt?void 0:lt.blockId)===e.id;return(0,t.jsxs)("div",{className:"flex w-full flex-col items-center justify-center px-2 sm:px-6 xl:w-3/4 xl:px-0 2xl:w-3/5",children:[(0,t.jsx)("div",{className:"".concat(x," flex w-full"),children:(0,t.jsx)(h.Z,{outputPlaceholder:e4()?"...":(0,v.s4)(e.type),block:e,blockIndex:l,blockResult:null==ed?void 0:null===(s=ed.testRunResult)||void 0===s?void 0:null===(r=s.blockResults)||void 0===r?void 0:r[e.id],dirtyStatus:eB[e.id],onDirtyChange:l=>{eA(a=>({...a,[e.id]:{...a[e.id],...l}}))},blockRef:null===(n=eQ.current[e.id])||void 0===n?void 0:n.block,outputRef:null===(o=eQ.current[e.id])||void 0===o?void 0:o.output,onBlockCopy:()=>eM(l+1,(0,v.ue)(ed,e)),onBlockTemplateAdd:lI,onBlockDelete:eP,onAiUpdateBlock:lb,onOutputChange:eV,onBlockChange:l=>eW(e.id,l),onRunBlock:eH,runType:"dry-run",disabled:d,deleteable:(0!==l||!(0,v.Jd)(e))&&(l+1<(null==ed?void 0:ed.blocks.length)||"api-notify"!==e.type),readOnly:!1,hideOutput:!1,loopRunning:e4(),loopId:ed.id,loop:ed,highlight:b,genState:le,exampleInput:ed.exampleInput})}),m&&(0,t.jsx)("div",{className:"".concat(x," mt-2 w-full border bg-white p-4 md:rounded-lg\n                                  ").concat("loopCreatorMsg"===b?"border-[3px] border-dashed border-sky-400":"border border-gray-200","\n                                "),children:(0,t.jsx)(G,{loop:ed,message:lt,status:lr,creatorState:le,creatorControls:ls.current,handleError:eT,handleLoopUpdate:eq,handleUpdateMessage:ld,handleStopMessage:lh,handleCreateVar:lm,handleRegenerateCurBlock:lv,handleUploadFiles:lf,handlePublishLoop:()=>eX(!0)})}),u&&(0,t.jsx)("div",{className:"flex text-[#e4e0d9]",children:(0,t.jsx)(i.Z,{size:48,strokeWidth:1.5})}),c&&(0,t.jsx)(N,{canAddContentType:e2(ed),typesToSkip:lO?["api-notify"]:void 0,onCreateBlock:e=>{if("user-block"===e&&!(0,y.G)(null==es?void 0:es.id))throw Error("User blocks are only available to admin users");eO(l+1,(0,v.xW)(es,ed,e))},templateBlocks:eR,onCreateTemplateBlock:e=>eO(l+1,(0,v.h_)(ed,e))})]},e.id)}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-between space-y-2 pb-[100px] pt-[30px]",children:[lT&&(0,t.jsxs)(t.Fragment,{children:[(null==ed?void 0:ed.published)?(0,t.jsx)(Z.Z,{content:ea("loop.active"),children:(0,t.jsx)(V.Z,{disabled:!e1(ed),onClick:async()=>{await eX(!1)},className:"h-[40px] bg-red-600 enabled:hover:bg-red-500 disabled:opacity-50",children:ea("loop.deactivate")})}):(0,t.jsx)(Z.Z,{content:ea("loop.notActivated"),children:(0,t.jsx)(V.Z,{disabled:!e2(ed),onClick:async()=>{await eq(),await eX(!0)},className:"h-[40px] min-w-[6rem] bg-purple-300 enabled:hover:bg-purple-400 disabled:opacity-50 dark:bg-purple-400 dark:enabled:hover:bg-purple-500",children:ea("loop.activate")})}),(0,t.jsx)("p",{className:"bold",children:ea("common.or")})]}),(0,t.jsx)(k.Z,{mode:"button",loopId:ed.id,active:!1})]})]})]})}),(0,t.jsx)(L.Z,{show:!Y&&"dialog"===la,showXButton:!0,onClose:()=>li("hide"),children:lt?(0,t.jsx)(G,{loop:ed,message:lt,status:lr,creatorState:le,creatorControls:ls.current,handleLoopUpdate:eq,handleError:eT,handleUpdateMessage:ld,handleStopMessage:lh,handleCreateVar:lm,handleRegenerateCurBlock:lv,handleUploadFiles:lf,handlePublishLoop:()=>eX(!0)}):(0,t.jsx)("div",{className:"mb-6 mt-10 flex w-full items-center justify-center",children:(0,t.jsx)(q.Z,{size:"20"})})}),(0,t.jsx)(L.Z,{show:!!(null==eF?void 0:eF.interrupt),title:ea("dialog.errorTitle"),type:"error",showXButton:!0,onClose:()=>eT(void 0),children:(0,t.jsx)("p",{className:"max-h-[500px] overflow-y-auto",children:(0,F.f0)(eF).slice(0,1e4)})}),(0,t.jsx)(L.Z,{show:ll,title:ea("dialog.welcomeTitle"),showXButton:!0,onClose:()=>{localStorage.setItem("edit-creator-welcome-shown","true"),lo(!1)},children:(0,t.jsx)("p",{children:ea("dialog.welcomeMessage")})}),l_.isModalOpen&&l_.currentBlock&&l_.validationResult&&(0,t.jsx)(ef,{isOpen:l_.isModalOpen,onClose:l_.handleCancel,onConfirm:lZ,suggestedName:l_.validationResult.suggestedName||"",operation:l_.currentBlock.operation,dataPreview:[],existingSpreadsheets:[]})]})}},87392:function(e,l,a){a.d(l,{Z:function(){return b}});var t=a(74817),r=a(36497),s=a(36842),n=a(71248),o=a(51254),i=a(82681),d=a(74870),c=a(29386),u=a(42390),p=a(30836);function b(e){var l;let{loop:a,show:b=!1,onClose:x}=e,h=(0,r.useRouter)(),m=(0,s.U0)(),[v,f]=(0,n.useState)(""),[g,k]=(0,n.useState)(),[y,j]=(0,n.useState)(!1);(0,n.useEffect)(()=>{f((null==a?void 0:a.name)||u.ZN.name)},[null==a?void 0:a.name]);let w=(0,n.useCallback)(async()=>{if((0,i.fJ)(m,"create loop",{type:"copy"}),!a){k("No Loop available to duplicate");return}try{k(void 0),j(!0);let{newLoop:e,newLoopUrl:l}=await (0,d.zV)(a.id,v,(0,p.EP)());(0,i.S_)(m,"create loop",{type:"copy",loopId:e.id}),h.replace(l+"/build")}catch(e){(0,i.gT)(m,"create loop",{error:e,type:"copy"},!0),k((0,c.f0)(e))}finally{setTimeout(()=>{j(!1),x()},1e3)}},[a,v,x,m,h]);return(0,t.jsx)("div",{className:"fixed inset-0 z-[60] overflow-y-auto ".concat(b?"":"hidden"),children:(0,t.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,t.jsx)("div",{className:"fixed inset-0 bg-black opacity-50 transition-opacity",onClick:x}),(0,t.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,t.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"inline-block w-full transform overflow-hidden rounded-lg bg-white px-4 pb-4 pt-5 align-bottom shadow-xl transition-all dark:bg-[#2a2a2a] sm:my-8 sm:w-auto sm:max-w-lg sm:p-6 sm:align-middle",children:[(0,t.jsx)("h3",{className:"mb-6 text-lg font-medium leading-6 text-gray-900 dark:text-white",children:'Use "'.concat(null!==(l=null==a?void 0:a.name)&&void 0!==l?l:u.ZN.name,'"')}),(0,t.jsx)("label",{className:"text-md mb-2 block text-start italic text-black/90 dark:text-gray-300",children:"Name"}),(0,t.jsx)("input",{type:"text",className:"w-full rounded-lg border border-black/10 p-2 focus:border-black/20 focus:outline-none dark:border-gray-600 dark:bg-[#1f1f1f] dark:text-white dark:focus:border-gray-500",value:v,disabled:!a,placeholder:"Loop name...",onChange:e=>{k(void 0),f(e.target.value)}}),(0,t.jsxs)("div",{className:"w-full items-end pt-4",children:[g&&(0,t.jsx)("p",{className:"pb-4 text-start text-sm text-red-600 dark:text-red-400",onClick:()=>k(void 0),children:g}),y&&(0,t.jsx)(o.Z,{className:"h-[40px] w-full p-2"}),!y&&(0,t.jsxs)("div",{className:"flex flex-row items-end justify-end space-x-4",children:[(0,t.jsx)("button",{className:"rounded-lg bg-gray-200 px-4 py-2 font-bold text-black/90 enabled:hover:bg-gray-300 disabled:opacity-50 dark:bg-gray-700 dark:text-white dark:enabled:hover:bg-gray-600",onClick:x,children:"Close"}),(0,t.jsx)("button",{className:"rounded-lg bg-sky-600 px-4 py-2 font-bold text-white enabled:hover:bg-sky-500 disabled:opacity-50 dark:bg-sky-700 dark:enabled:hover:bg-sky-600",onClick:w,children:"Duplicate Loop"})]})]})]})]})})}},42820:function(e,l,a){var t=a(74817),r=a(10688),s=a(6634),n=a(77797),o=a(71248);l.Z=e=>{var l;let{show:a,onClose:i,title:d,type:c,showXButton:u,buttons:p,children:b}=e,x=(0,o.useMemo)(()=>"error"===c?"text-red-600 dark:text-red-400":"warning"===c?"text-yellow-900 dark:text-yellow-300":"text-black/90 dark:text-white",[c]);return(0,t.jsx)(r.u,{appear:!0,show:a,as:o.Fragment,children:(0,t.jsx)(s.V,{as:"div",className:"fixed inset-0 z-[300] overflow-y-auto",onClose:i,children:(0,t.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,t.jsx)(s.V.Overlay,{className:"fixed inset-0 bg-black opacity-50 transition-opacity dark:bg-black/80"}),(0,t.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,t.jsx)(r.u.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,t.jsxs)("div",{className:"relative inline-block transform overflow-hidden \n                             rounded-lg bg-[#FEFCF8] p-4 text-left align-bottom shadow-xl \n                             transition-all dark:border-[3px] dark:border-dashed dark:border-sky-400 dark:bg-[#1f1f1f] \n                             sm:my-8 sm:w-full sm:max-w-lg\n                             sm:p-6 sm:align-middle",children:[u&&!d&&(0,t.jsx)("button",{className:"absolute right-3 top-3 rounded-lg p-2 text-black/40 transition duration-200 ease-in-out enabled:hover:bg-[#F4F0E9] dark:text-gray-400 dark:enabled:hover:bg-gray-700",onClick:()=>i(),children:(0,t.jsx)(n.Z,{size:18})}),d&&(0,t.jsxs)("div",{className:"mb-2 flex flex-row items-center justify-between",children:[(0,t.jsx)(s.V.Title,{as:"h3",className:"p text-xl font-medium leading-4 ".concat(x),children:d}),u&&(0,t.jsx)("button",{className:"rounded-lg p-1 text-black/40 transition duration-200 ease-in-out enabled:hover:bg-[#F4F0E9] dark:text-gray-400 dark:enabled:hover:bg-gray-700",onClick:()=>i(),children:(0,t.jsx)(n.Z,{size:20})})]}),(0,t.jsx)("div",{children:b}),(null!==(l=null==p?void 0:p.length)&&void 0!==l?l:0)>0&&(0,t.jsx)("div",{className:"mt-5 font-bold text-white sm:mt-4 sm:flex sm:flex-row-reverse",children:null==p?void 0:p.map((e,l)=>(0,t.jsx)("button",{disabled:e.disabled,onClick:e.onClick,className:"whitespace-nowrap rounded-lg px-3 py-2 disabled:opacity-50 ".concat(e.className),children:e.title},"dialog-".concat(d,"-").concat(l)))})]})})]})})})}},58535:function(e,l,a){a.d(l,{Z:function(){return v}});var t=a(74817),r=a(71248),s=a(10688),n=a(6634),o=a(51645),i=a(19249),d=a(51254),c=a(2002);function u(e){let{className:l="",fullWidth:a=!1}=e,{t:s}=(0,i.Z)("common"),[n,o]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{localStorage.getItem("clickedDiscord")&&o(!0)},[]),(0,t.jsx)("div",{className:(0,c.cn)("flex flex-col items-center",a&&"w-full"),children:(0,t.jsx)("button",{onClick:()=>{localStorage.setItem("clickedDiscord","true"),o(!0),window.open("https://discord.gg/78DJrRtwfW","_blank","noopener,noreferrer")},className:(0,c.cn)("relative px-4 py-3 font-bold uppercase tracking-wider transition-transform duration-200","border-[3px] border-black shadow-[4px_4px_0_0_#000]","hover:-translate-y-1 hover:translate-x-1 active:translate-x-0 active:translate-y-0",a&&"w-full",n?"bg-gray-200 text-black/90 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-100 dark:hover:bg-gray-600":"bg-violet-500 text-white hover:bg-violet-400",l),children:s(n?"discord.goTo":"discord.join")})})}var p=a(81173),b=a(74870),x=a(42390),h=a(64544),m=a(86169);function v(e){var l,a,c;let{mode:v,className:f="",loopId:g,appSubdomain:k,active:y,context:j="loop"}=e,{t:w}=(0,i.Z)("common"),{user:N}=(0,o.a)(),[C,S]=(0,r.useState)(!1),[E,_]=(0,r.useState)(""),[R,Z]=(0,r.useState)(null!==(a=null==N?void 0:null===(l=N.user_metadata)||void 0===l?void 0:l.full_name)&&void 0!==a?a:""),[L,I]=(0,r.useState)(null!==(c=null==N?void 0:N.email)&&void 0!==c?c:""),[D,F]=(0,r.useState)(!1),[T,B]=(0,r.useState)(!1),{isIncomplete:A,emailInvalid:z}=(0,r.useMemo)(()=>{let e=E.trim(),l=R.trim(),a=L.trim();return{isIncomplete:!e||!l||!a,emailInvalid:!!a&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)}},[E,R,L]),U=D||T||A||z,O=()=>{var e,l;_(""),Z(null!==(e=null==N?void 0:N.user_metadata.full_name)&&void 0!==e?e:""),I(null!==(l=null==N?void 0:N.email)&&void 0!==l?l:""),F(!1),B(!1)},M=()=>{O(),S(!0)},P=()=>{O(),S(!1)},G=(0,r.useCallback)(async()=>{if(!U){F(!0);try{let e={name:R.trim(),email:L.trim(),active:null!=y&&y,context:j,app:"",loop:""};"app"===j?k&&(e.app="".concat((0,h.T)(k))):e.loop=y?"link: ".concat((0,x.vJ)(g),"/runs"):"id: ".concat(g),await (0,b.fA)(E.trim(),e),B(!0)}catch(e){console.error(e),alert(w("feedback.error"))}finally{F(!1),"full"!==v&&P()}}},[U,j,E,R,L,y,g,v,P,w]),W=(0,t.jsx)("div",{className:"relative mx-auto w-full max-w-md bg-white p-8",style:{boxShadow:"8px 8px 0 0 #000",border:"3px solid #000"},children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),G()},className:"space-y-5",children:[(0,t.jsx)("textarea",{name:"issue",placeholder:w("feedback.issuePlaceholder",{context:j}),value:E,onChange:e=>{_(e.target.value),B(!1)},rows:4,className:"border-3 w-full border-black bg-yellow-100 p-4 text-black placeholder-black/70 focus:outline-none",style:{boxShadow:"4px 4px 0 0 #000",borderWidth:"3px"},onKeyDown:e=>{"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&G()}}),(0,t.jsx)("input",{type:"text",name:"name",placeholder:w("feedback.namePlaceholder"),value:R,onChange:e=>{Z(e.target.value),B(!1)},className:"border-3 w-full border-black bg-pink-100 px-4 py-2 text-black placeholder-black/70 focus:outline-none",style:{boxShadow:"4px 4px 0 0 #000",borderWidth:"3px"}}),(0,t.jsx)("input",{type:"email",name:"email",placeholder:w("feedback.emailPlaceholder"),value:L,onChange:e=>{I(e.target.value),B(!1)},className:"border-3 w-full border-black bg-blue-100 px-4 py-2 text-black placeholder-black/70 focus:outline-none",style:{boxShadow:"4px 4px 0 0 #000",borderWidth:"3px"}}),(0,t.jsx)("button",{type:"submit",disabled:U,className:"w-full transform bg-orange-400 p-4 text-lg font-bold uppercase tracking-wider text-black transition-transform duration-200 hover:-translate-y-1 hover:translate-x-1 active:translate-x-0 active:translate-y-0 disabled:pointer-events-none disabled:opacity-50",style:{boxShadow:"4px 4px 0 0 #000",border:"3px solid #000"},children:D?(0,t.jsx)(d.Z,{size:"20"}):T?w("feedback.sent"):w("feedback.submit")}),(0,t.jsxs)("div",{className:"relative py-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,t.jsx)("div",{className:"w-full border-t-2 border-dashed border-black"})}),(0,t.jsx)("div",{className:"relative flex justify-center",children:(0,t.jsx)("span",{className:"-rotate-2 bg-white px-4 text-lg font-bold uppercase text-black",style:{border:"0px solid #000",boxShadow:"3px 3px 0 0 #000",backgroundColor:"#ffcc00"},children:w("feedback.or")})})]}),(0,t.jsx)(u,{fullWidth:!0,className:"bg-violet-500 p-4 text-center text-lg font-bold uppercase tracking-wider text-white"}),(0,t.jsx)("p",{className:"font-mono ml-1 mt-4 bg-green-200 p-2 text-center text-sm",style:{border:"2px dashed #000"},children:w("feedback.discordHelp",{context:j})})]})});return(0,t.jsx)("div",{className:f,children:"full"===v?W:(0,t.jsxs)(t.Fragment,{children:["button"===v?(0,t.jsx)(p.Z,{onClick:M,className:"h-[36px] px-3 py-2 font-medium focus:outline-none disabled:opacity-50 "+("button"===v?"bg-orange-300 text-black enabled:hover:bg-orange-400":"enabled:hover:bg-gray-200 dark:enabled:hover:bg-gray-700"),children:D?(0,t.jsx)(d.Z,{size:"20"}):T?w("feedback.thankYou"):w("feedback.title")}):(0,t.jsxs)("div",{onClick:M,className:"flex items-center",children:[(0,t.jsx)(m.Z,{className:"mr-2 h-4 w-4"}),D?(0,t.jsx)(d.Z,{size:"20"}):T?w("feedback.thankYou"):w("feedback.title")]}),(0,t.jsx)(s.u,{appear:!0,show:C,as:r.Fragment,children:(0,t.jsx)(n.V,{as:"div",className:"fixed inset-0 z-[60] overflow-y-auto",onClose:P,children:(0,t.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,t.jsx)(n.V.Overlay,{className:"fixed inset-0 bg-black opacity-50"}),(0,t.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,t.jsx)(s.u.Child,{as:r.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,t.jsx)("div",{className:"inline-block w-full max-w-lg transform overflow-hidden pb-2 align-middle transition-all",children:W})})]})})})]})})}},83252:function(e,l,a){var t=a(74817),r=a(71248),s=a(77797),n=a(2586),o=a(15305),i=a(7988),d=a(12957),c=a(28923),u=a(78301);l.Z=e=>{let{loopVariables:l,readOnly:a,disabled:p,onChange:b}=e,[x,h]=(0,r.useState)([]),[m,v]=(0,r.useState)([]),f=(0,r.useCallback)((e,a,t)=>{if(!l||l[e][a]===t)return;let r=[...l];r[e]={...l[e],[a]:t},null==b||b(r)},[l,b]);return(0,r.useEffect)(()=>{if(!l)return;let e=[],a=[];for(let r=0;r<l.length;r++){var t;let s=l[r];(!s.key||s.key.length<3||s.key.length>100||s.key.includes("BLOCK")||!c.R.test(s.key))&&e.push(r),(!s.value&&s.required||(null===(t=s.value)||void 0===t?void 0:t.length)>5e3)&&a.push(r)}h(e),v(a)},[l]),(0,t.jsxs)("div",{className:"flex w-full flex-col items-center space-y-1",children:[(0,t.jsxs)("div",{className:"flex flex-row",children:[(0,t.jsx)("h1",{className:"text-md pr-1 font-semibold text-black/90 dark:text-gray-200",children:"Variables"}),(0,t.jsx)(o.Z,{className:"pr-1 pt-1",content:"Here you can add values / constants that you can use throughout your Loop"})]}),(null!=l?l:[]).length>0&&(0,t.jsxs)("table",{className:"w-full table-auto",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"h-10 text-left align-bottom text-xs dark:text-gray-400",children:[(0,t.jsx)("th",{className:"w-4/12 pl-1",children:"Name"}),(0,t.jsx)("th",{className:"w-5/12 pl-1",children:"Value"}),(0,t.jsx)("th",{className:"w-1/12 rotate-45 transform",children:"Req*"}),(0,t.jsx)("th",{className:"w-1/12 rotate-45 transform",children:"Secret"}),!a&&(0,t.jsx)("th",{className:"w-1/12 "})]})}),(0,t.jsx)("tbody",{children:null==l?void 0:l.map((e,r)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"pr-1",children:(0,t.jsx)(i.Z,{type:"text",className:"w-full bg-white/50 px-1.5 pb-1 pt-0.5 focus:outline-none disabled:opacity-50 dark:bg-[#2a2a2a] dark:text-gray-200 ".concat(x.includes(r)?"border-red-500":""),value:e.key?"$".concat(e.key):"",disabled:p||a,placeholder:"$NAME",onChange:e=>{var l;let a=null!==(l=e.target.value)&&void 0!==l?l:"",t=a.startsWith("$")?a.slice(1):a;f(r,"key",(0,u.Dk)(t))}})}),(0,t.jsx)("td",{className:"pr-1",children:(0,t.jsx)(i.Z,{className:"w-full bg-white/50 px-1.5 pb-1 pt-0.5 focus:outline-none disabled:opacity-50 dark:bg-[#2a2a2a] dark:text-gray-200 ".concat(m.includes(r)?"border-red-500":""),type:(0,u.Se)(e.key),autoComplete:(0,u.AG)(e.key),placeholder:(0,u.qH)(e.key,"Value"),value:e.value,disabled:p||a,onChange:e=>{f(r,"value",e.target.value)}})}),(0,t.jsx)("td",{className:"pl-4 text-center",children:(0,t.jsx)(d.Z,{checked:e.required,disabled:p||a,alt:"Required?",onChange:e=>{f(r,"required",e.target.checked)}})}),(0,t.jsx)("td",{className:"pl-2 text-center",children:(0,t.jsx)(d.Z,{checked:e.secret,disabled:p||a,alt:"Secret?",onChange:e=>{f(r,"secret",e.target.checked)}})}),!a&&(0,t.jsx)("td",{children:(0,t.jsx)("button",{className:"rounded-lg p-1 text-center text-black/40 enabled:hover:bg-gray-100 disabled:opacity-0 dark:text-gray-400 dark:enabled:hover:bg-gray-700",disabled:p,onClick:()=>{let e=l.filter((e,l)=>l!==r);null==b||b(e)},children:(0,t.jsx)(s.Z,{size:18})})})]},r))})]}),x.length>0&&(0,t.jsx)("p",{className:"w-full pl-2 text-start text-xs italic text-red-500",children:"* Names must start with a letter, be 3-100 chars long; use only letters/numbers/_; and not contain 'BLOCK'"}),m.length>0&&(0,t.jsx)("p",{className:"w-full pl-2 text-start text-xs italic text-red-500",children:"* Required values can't be empty (and <5000 chars)"}),(0,t.jsxs)("div",{className:"h-8",children:[(p||a)&&(!l||0===l.length)&&(0,t.jsx)("p",{className:"w-full p-2 text-center text-xs italic text-black/40 dark:text-gray-400",children:"None defined"}),!p&&!a&&(0,t.jsx)("button",{className:"rounded-lg p-1 text-black/40 enabled:hover:bg-gray-100 dark:text-gray-400 dark:enabled:hover:bg-gray-700",onClick:()=>{null==b||b([...null!=l?l:[],{key:"",value:"",required:!1,secret:!1}])},children:(0,t.jsx)(n.Z,{size:20})})]})]})}},50352:function(e,l,a){var t=a(74817),r=a(71248),s=a(19249),n=a(94620),o=a(1019),i=a(44016),d=a(74870);l.Z=e=>{let{loopId:l,show:a,onClose:c}=e,{t:u}=(0,s.Z)("loop"),[p,b]=(0,r.useState)([]),[x,h]=(0,r.useState)(!1),[m,v]=(0,r.useState)(!1),[f,g]=(0,r.useState)(""),k=(0,r.useRef)(null);(0,r.useEffect)(()=>{a&&(k.current&&(k.current.scrollTop=0),y())},[a]);let y=async()=>{if(l){h(!0);try{let e=await (0,d.eS)(l);b(e)}catch(e){console.error(e)}h(!1)}},j=e=>{let a=[...p];b(l=>l.map(l=>l.id===e.id?{...l,checkedForCurrentLoop:!l.checkedForCurrentLoop}:l)),e.checkedForCurrentLoop?(0,d.rx)(l,e.id).catch(e=>{console.error(e),b(a)}):(0,d.P5)(l,e.id).catch(e=>{console.error(e),b(a)})},w=()=>{if(!f.trim()){v(!1),g("");return}let e="temp-"+Date.now(),a=[...p];b([...p,{id:e,tag_name:f,checkedForCurrentLoop:!0}]),(0,d.ln)(l,f).then(l=>{b(a=>a.map(a=>a.id===e?{...a,id:l.id}:a))}).catch(e=>{console.error(e),b(a)}).finally(()=>{v(!1),g("")})};return a?(0,t.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center overflow-y-auto bg-black/50 p-4",ref:k,children:(0,t.jsxs)("div",{className:"w-full max-w-lg border-4 border-black bg-white shadow-[4px_4px_0_0_rgba(0,0,0,1)] dark:bg-[#1f1f1f]",style:{backgroundImage:"radial-gradient(circle, #00000022 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[(0,t.jsxs)("div",{className:"sticky top-0 z-[100] flex items-center justify-between border-b-4 border-black bg-white p-4 dark:bg-[#1f1f1f]",children:[(0,t.jsx)("h2",{className:"text-lg font-bold",children:u("tag.addTag")}),(0,t.jsx)("button",{onClick:c,className:"rounded-none border-2 border-black bg-red-400 p-1 transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)] dark:hover:bg-gray-700",children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})})]}),(0,t.jsx)("div",{className:"p-4",children:x?(0,t.jsxs)("div",{className:"py-4 text-center dark:text-gray-300",children:[u("tag.loading"),"..."]}):(0,t.jsxs)(t.Fragment,{children:[0===p.length?(0,t.jsx)("div",{className:"py-4 text-center text-gray-500 dark:text-gray-300",children:u("tag.noTagsFound")}):(0,t.jsx)("div",{className:"mb-4 flex flex-wrap gap-2",children:p.map(e=>e.checkedForCurrentLoop?(0,t.jsx)("button",{onClick:()=>j(e),className:"border-2 border-black px-2 py-1 text-sm font-medium shadow-[2px_2px_0_0_rgba(0,0,0,1)] transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)] dark:text-white",children:e.tag_name},e.id):(0,t.jsx)("button",{onClick:()=>j(e),className:"border-2 border-gray-300 px-2 py-1 text-sm font-medium text-gray-600 hover:bg-gray-200 dark:border-gray-600 dark:text-gray-300 dark:hover:bg-[#2a2a2a]",children:e.tag_name},e.id))}),m?(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{autoFocus:!0,type:"text",value:f,onChange:e=>g(e.target.value),onKeyDown:e=>{"Enter"===e.key?(e.preventDefault(),w()):"Escape"===e.key&&(e.preventDefault(),v(!1),g(""))},className:"border-2 border-black px-2 py-1 text-sm text-gray-700 outline-none dark:bg-[#2a2a2a] dark:text-gray-200",placeholder:u("tag.enterTagName")}),(0,t.jsx)("button",{onClick:w,className:"rounded-none border-2 border-black bg-green-400 p-1 transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)]",title:u("tag.confirm"),children:(0,t.jsx)(o.Z,{className:"h-4 w-4"})}),(0,t.jsx)("button",{onClick:()=>{v(!1),g("")},className:"rounded-none border-2 border-black bg-red-400 p-1 transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)]",title:u("tag.cancel"),children:(0,t.jsx)(n.Z,{className:"h-4 w-4"})})]}):(0,t.jsxs)("button",{className:"flex items-center gap-1 border-2 border-black bg-gray-200 px-2 py-1 text-sm text-black shadow-[2px_2px_0_0_rgba(0,0,0,1)] transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:bg-gray-300 hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)] dark:bg-[#2a2a2a] dark:text-white ",onClick:()=>v(!0),children:[(0,t.jsx)(i.Z,{className:"h-4 w-4"}),u("tag.newTag")]})]})})]})}):null}},64544:function(e,l,a){a.d(l,{T:function(){return r}});var t=a(31031);let r=e=>(0,t.r8)()?"http://localhost:3000/app/".concat(e):"https://".concat(e,".magicloops.app")}}]);