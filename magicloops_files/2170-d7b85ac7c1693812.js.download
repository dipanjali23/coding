"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2170],{59264:function(e,t,a){a.d(t,{D:function(){return d}});var l=a(74817),s=a(71248),r=a(65414),n=a(86774),i=a(91156),o=a(42264),c=a(97457);let d=()=>{let[e,t]=(0,s.useState)(!1),[a,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(!1),p=(0,n.e)(),x=(0,s.useCallback)(async()=>{try{let{data:{user:e}}=await p.auth.getUser();if(!e)return;let a=await fetch("/api/googleSheets/status"),l=await a.json();t(l.success&&l.isConnected)}catch(e){console.error("Error checking Google Sheets connection:",e),t(!1)}finally{d(!1)}},[p]);(0,s.useEffect)(()=>{x()},[x]);let h=async()=>{m(!0);try{let e=window.location.origin,{error:t}=await p.auth.signInWithOAuth({provider:"google",options:{scopes:"https://www.googleapis.com/auth/drive.file https://www.googleapis.com/auth/userinfo.email",redirectTo:"".concat(e,"/api/auth/callback?feature=sheets"),queryParams:{include_granted_scopes:"true",prompt:"consent",access_type:"offline"}}});t&&(console.error("Error connecting to Google Sheets:",t),m(!1))}catch(e){console.error("Error initiating Google Sheets connection:",e),m(!1)}};return a?(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-gray-500",children:[(0,l.jsx)(i.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"Checking connection..."})]}):e?(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-green-600",children:[(0,l.jsx)(o.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"Google Sheets Connected"})]}):(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 text-yellow-600",children:[(0,l.jsx)(c.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{children:"Google Sheets access required"})]}),(0,l.jsx)(r.z,{onClick:h,disabled:u,variant:"outline",className:"w-full",children:u?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.Z,{className:"mr-2 h-4 w-4 animate-pulse"}),"Connecting..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.Z,{className:"mr-2 h-4 w-4"}),"Connect Google Sheets"]})})]})}},22170:function(e,t,a){a.d(t,{Z:function(){return tL}});var l=a(74817),s=a(36952),r=a(26991),n=a(10688),i=a(6634),o=a(71248),c=a(11142),d=a(33657),u=a(93748),m=a(12991),p=a(20547),x=a(2689),h=a(77797),g=a(76785),f=a(19249),b=a(51645),v=a(37518),y=a.n(v),j=a(9143),N=a(47254),k=a(53446),w=a(10958),_=a(37010),C=a(96027),I=a(71940);let T=C.Z;var S=e=>{let{language:t,value:a}=e;return(0,l.jsx)("div",{className:"codeblock font-sans text-[14px]",children:(0,l.jsx)(T,{language:t,style:I.MS,wrapLongLines:!0,customStyle:{margin:0,backgroundColor:"#00000000"},children:a})})};let L=JSON.stringify({input:"Hello World"},null,2),O=e=>{try{let t=JSON.parse(e);return JSON.stringify(t,null,2).replace(/"\$EXAMPLE_FILES\[(\d+)\]\.(url|fileName|type)"/g,"files[$1].$2")}catch(e){return JSON.stringify({input:"Hello World"},null,2)}},E=e=>{try{let t=JSON.parse(e);return JSON.stringify(t,null,2).replace(/"/g,"'").replace(/true/g,"True").replace(/false/g,"False").replace(/null/g,"None").replace(/'\$EXAMPLE_FILES\[(\d+)\]\.(url|fileName|type)'/g,"files[$1].$2")}catch(e){return"{'input': 'Hello World'}"}},Z=e=>{try{let t=JSON.parse(e);return JSON.stringify(t).replace(/"\$EXAMPLE_FILES\[(\d+)\]\.url"/g,'"${file$1_url}"').replace(/"\$EXAMPLE_FILES\[(\d+)\]\.fileName"/g,'"${file$1_name}"').replace(/"\$EXAMPLE_FILES\[(\d+)\]\.type"/g,'"${file$1_type}"')}catch(e){return'{"input": "Hello World"}'}},A=e=>[...new Set((e.match(/\$EXAMPLE_FILES\[(\d+)\]/g)||[]).map(e=>{var t;let a=null===(t=e.match(/\[(\d+)\]/))||void 0===t?void 0:t[1];return a?parseInt(a):0}))].sort((e,t)=>e-t);var P=e=>{let{reqUrl:t,exampleInput:a,includeFileUpload:s=!1,files:r=[],loopId:n}=e,i=r.filter(e=>e.url).map(e=>e.url),c=i.length>0?i:["https://magicloops.dev/images/bud_avatar.png"],u=a||JSON.stringify({input:"Hello World"},null,2),m=a?(()=>{try{return JSON.parse(a),a}catch(e){return L}})():JSON.stringify(s?{input:"Hello World",files:c}:{input:"Hello World"},null,2),p={url:s?"/* File uploads require POST requests – URL query params won't work */":"".concat(t,"?input=Hello+World"),curl:(()=>{if(!s)return'curl -X POST \\\n  -H "Content-Type: application/json" \\\n  -d \''.concat(m,"' \\\n  ").concat(t);let e=A(u),a=Z(u),l=e.map(e=>'  -F "file=@/path/to/example-file-'.concat(e,'.jpg" \\')).join("\n"),r=e.map(e=>"file".concat(e,"_url=$(echo $response | jq -r '.[").concat(e,"].url')")).join("\n");return"# Step 1: Upload your files to Magic Loops and capture the response\nresponse=$(curl -X POST \\\n".concat(l,"\n  https://magicloops.dev/api/loop/").concat(n||"[loopId]","/upload)\n\n# Extract file URLs from the response\n").concat(r,'\n\n# Step 2: Trigger your loop with the file references\ncurl -X POST \\\n  -H "Content-Type: application/json" \\\n  -d \'').concat(a,"' \\\n  ").concat(t)})(),typescript:(()=>{if(!s)return"// Trigger your loop\nconst response = await fetch('".concat(t,"', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify(").concat(u,")});\nconst data = await response.json();\nconsole.log(data);");let e=O(u);return"// Step 1: uploadFile helper (returns { url, fileName, type })\nasync function uploadFile(file, loopId) {\n  const formData = new FormData();\n  formData.append('file', file);\n  const res = await fetch(`https://magicloops.dev/api/loop/${loopId}/upload`, { \n    method: 'POST', \n    body: formData \n  });\n  const output = res.json();\n  return output.url;\n}\n\n// Step 2: upload all files and collect results\nconst files = await Promise.all(selectedFiles.map((f) => \n  uploadFile(f, '".concat(n||"LOOP_ID","')));\n\n// Step 3: Trigger your loop with the file references\nconst triggerRes = await fetch('").concat(t,"', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify(").concat(e,"),\n});\nconsole.log(await triggerRes.json());")})(),python:(()=>{if(!s)return"import requests\n\nresponse = requests.post('".concat(t,"', json=").concat(u,")\nprint(response.json())");let e=E(u);return"import requests\n\n# Step 1: uploadFile helper (returns { url, fileName, type })\ndef upload_file(path, user_id, loop_id):\n    with open(path, 'rb') as f:\n        res = requests.post(f'https://magicloops.dev/api/loop/{loop_id}/upload', files={'file': f})\n    return res.json()['url']\n\n# Step 2: upload all files and collect results\nfiles = [upload_file(p, '".concat(n||"LOOP_ID","') for p in ['file1.jpg', 'file2.jpg']]\n\n# Step 3: Trigger your loop with the file references\npayload = ").concat(e,"\nresult = requests.post('").concat(t,"', json=payload).json()\nprint(result)")})()},[x,h]=(0,o.useState)(s?"curl":"url"),[g,f]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{s&&"url"===x&&h("curl")},[s,x]),(0,o.useEffect)(()=>{if(!g)return;let e=setTimeout(()=>f(!1),2500);return()=>clearTimeout(e)},[g]),(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{className:"flex pl-2",children:Object.keys(p).map(e=>{let t="url"===e&&s,a=x===e;return(0,l.jsxs)("button",{disabled:t||a,onClick:()=>!t&&h(e),className:"".concat("py-0.5 px-1 mx-1 rounded-t-lg hover:bg-black/10 dark:hover:bg-white/10"," ").concat(t?"cursor-not-allowed opacity-50":""," ").concat(a?"bg-black/10 dark:bg-white/10":""),style:{fontFamily:"monospace"},title:t?"Not compatible with file uploads":void 0,children:[e,t&&(0,l.jsx)(w.Z,{className:"ml-1 inline-block",size:12})]},e)})}),(0,l.jsxs)("div",{onClick:e=>{var a;e.preventDefault();let l=e.target.closest(".link-icon-class")?t:p[x];null===(a=navigator.clipboard)||void 0===a||a.writeText(l).then(()=>f(!0))},className:"flex cursor-pointer rounded-none border-2 border-black bg-white shadow-[2px_2px_0_0_rgba(0,0,0,1)] dark:bg-black/80",children:[(0,l.jsx)("pre",{className:"flex-1 overflow-x-auto whitespace-pre-wrap",style:{fontFamily:"monospace"},children:(0,l.jsx)(S,{language:"curl"===x?"bash":x,value:p[x]})}),"url"===x&&!s&&(0,l.jsx)(_.Z,{size:18,className:"link-icon-class m-2 hover:text-sky-500"}),(0,l.jsx)(d.Z,{size:18,className:"m-2 hover:text-sky-500 dark:text-gray-400 dark:hover:text-sky-400"})]}),g&&(0,l.jsx)("span",{className:"py-2 text-xs italic text-sky-500",children:"Copied to clipboard!"}),"url"===x&&s&&(0,l.jsxs)("div",{className:"mt-2 flex items-center gap-1 text-xs text-amber-600 dark:text-amber-400",children:[(0,l.jsx)(w.Z,{size:12}),(0,l.jsx)("span",{children:"URL requests are not compatible with file uploads. Please use another method."})]})]})},F=a(65414);async function M(e,t){let a=new FormData;a.append("file",e);let l=await fetch("/api/loop/".concat(t,"/upload"),{method:"POST",body:a});if(!l.ok)throw Error((await l.json()).error||"Failed to upload file");return l.json()}var B=a(42390),R=a(17428),K=a(901),z=a(10434),U=a(57597),D=a(73853),V=a(32014);let q=e=>null==e?"null":"string"==typeof e?e:"number"==typeof e||"boolean"==typeof e?String(e):Array.isArray(e)?"[…]":"object"==typeof e?"{…}":String(e),$=U.p.mark({class:"cm-var"}),G=/\$[A-Z0-9_]+(?:\.[A-Za-z0-9_\[\]"']+|\[\d+])*/g,J=U.lg.fromClass(class{update(e){(e.docChanged||e.viewportChanged)&&(this.decorations=this.decorator.createDeco(e.view))}constructor(e){this.decorator=new U.Y1({regexp:G,decoration:$}),this.decorations=this.decorator.createDeco(e)}},{decorations:e=>e.decorations}),W=e=>{let t=[],a=function(e,l){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;t.push(e),!(s>3)&&(Array.isArray(l)?l.forEach((t,l)=>a("".concat(e,"[").concat(l,"]"),t,s+1)):l&&"object"==typeof l&&Object.keys(l).forEach(t=>a("".concat(e,".").concat(t),l[t],s+1)))};return e.forEach(e=>{let{key:t,value:l}=e;return a("$".concat(t),(0,V.bj)(l))}),Array.from(new Set(t))},H=e=>t=>{let a=t.matchBefore(/\$[A-Za-z0-9_.\[\]"']*/);if(!a||a.from===a.to&&!t.explicit)return null;let l=a.text.search(/[.\[]/),s=l>0?a.text.slice(0,l+1):"",r=s.length;return{from:a.from,options:W(e.current).filter(e=>e.toLowerCase().startsWith(a.text.toLowerCase())).sort((e,t)=>{var a,l,s,r;let n=((null===(a=e.match(/[.\[]/g))||void 0===a?void 0:a.length)||0)+((null===(l=e.match(/\]/g))||void 0===l?void 0:l.length)||0),i=((null===(s=t.match(/[.\[]/g))||void 0===s?void 0:s.length)||0)+((null===(r=t.match(/\]/g))||void 0===r?void 0:r.length)||0);return n!==i?n-i:e.localeCompare(t)}).slice(0,40).map(t=>{var a,l;let n=function(e,t){let a=t.replace(/^\$/,"").replace(/\[(\d+)]/g,".$1").split("."),l=a.shift();if(!l)return;let s=e.find(e=>e.key===l);if(s)return a.reduce((e,t)=>{if(null!=e){if(Array.isArray(e)){let a=Number(t);return Number.isInteger(a)?e[a]:void 0}if("object"==typeof e)return e[t]}},s.value)}(e.current,t),i=q(n),o=r&&t.startsWith(s)?t.slice(r)||"⟨root⟩":t,c=((null===(a=o.match(/\./g))||void 0===a?void 0:a.length)||0)+((null===(l=o.match(/\[/g))||void 0===l?void 0:l.length)||0);return{label:t,displayLabel:o,detail:"→ ".concat(i),apply:t,type:"variable",boost:0,depth:c,info:()=>{if("object"!=typeof n)return null;let e=document.createElement("pre");return e.className="ml-preview-box",e.style.margin="0",e.textContent="object"==typeof n?JSON.stringify(n,null,2):String(n),e}}})}},Y=e=>(0,U.bF)((t,a)=>{let l=t.state.doc.lineAt(a),s=a-l.from,r=l.text,n=s;for(;n>0&&/[A-Za-z0-9_\.\[\]"]/u.test(r[n-1]);)n--;if("$"!==r[n-1])return null;n--;let i=s;for(;i<r.length&&/[A-Za-z0-9_\.\[\]"]/u.test(r[i]);)i++;let o=r.slice(n,i),c=document.createElement("div");c.className="cm-var-tooltip",c.textContent=(0,V.Es)("json",o,e.current,"none");try{c.textContent=JSON.stringify(JSON.parse(c.textContent),null,2)}catch(e){}let d=l.from+n,u=l.from+i;return{pos:l.from+n+(u-d)/2,end:l.from+i,strictSide:!0,create:()=>({dom:c,offset:{x:0,y:2}})}},{hoverTime:150}),X="#d97706",Q="#ff8900",ee="#1f2937",et="#1f2937",ea="#0f172a",el=U.tk.theme({"&.cm-focused":{outline:"none !important"},".cm-scroller":{lineHeight:"unset !important"},".cm-var":{color:X,fontWeight:"bold"},".cm-tooltip.cm-tooltip-autocomplete, .cm-tooltip.cm-completionInfo, .cm-var-tooltip, .cm-tooltip.cm-tooltip-info":{background:"#ffffff",border:"2px solid ".concat(ee),boxShadow:"2px 2px 0 0 ".concat(ee),color:X,borderRadius:0,padding:"6px 6px",fontFamily:"monospace",fontSize:"14px",fontWeight:"bold",whiteSpace:"pre",zIndex:1001,maxWidth:"400px",maxHeight:"500px"},".cm-tooltip-below":{marginTop:"0.5rem"},".cm-completionInfo-right-narrow":{top:"100% !important"},".cm-tooltip-hover.cm-tooltip":{border:"none"},".cm-var-tooltip, .ml-preview-box":{overflow:"scroll",maxWidth:"400px",maxHeight:"490px"},".cm-tooltip-autocomplete ul":{maxHeight:"15rem !important",overflowY:"auto",margin:0,padding:0},".cm-tooltip-autocomplete li":{display:"flex",alignItems:"center",gap:"6px",padding:"6px 6px !important",borderBottom:"1px solid ".concat(ee),whiteSpace:"nowrap",cursor:"pointer",justifyContent:"space-between"},'.cm-tooltip-autocomplete li[aria-selected="true"]':{background:ee,color:et},".cm-completionIcon":{display:"none !important"},".cm-completionDetail":{maxWidth:"250px"},".cm-tooltip.cm-completionInfo.cm-completionInfo-right":{marginLeft:"10px",marginTop:"-10px"},".ml-nest-1":{paddingLeft:"12px"},".ml-nest-2":{paddingLeft:"24px"}},{dark:!1}),es=U.tk.theme({"&.cm-focused":{outline:"none !important"},".cm-scroller":{lineHeight:"unset !important"},".cm-var":{color:Q,fontWeight:"bold"},".cm-tooltip.cm-tooltip-autocomplete, .cm-tooltip.cm-completionInfo, .cm-var-tooltip, .cm-tooltip.cm-tooltip-info":{background:ea,border:"2px solid ".concat(et),boxShadow:"2px 2px 0 0 ".concat(et),color:Q,borderRadius:0,padding:"6px 6px",fontFamily:"monospace",fontSize:"14px",fontWeight:"bold",whiteSpace:"pre",zIndex:1001,maxWidth:"400px",maxHeight:"500px"},".cm-tooltip-below":{marginTop:"0.5rem"},".cm-completionInfo-right-narrow":{top:"100% !important"},".cm-tooltip-hover.cm-tooltip":{border:"none"},".cm-var-tooltip, .ml-preview-box":{overflow:"scroll",maxWidth:"400px",maxHeight:"490px"},".cm-tooltip-autocomplete ul":{maxHeight:"15rem !important",overflowY:"auto",margin:0,padding:0},".cm-tooltip-autocomplete li":{display:"flex",alignItems:"center",gap:"6px",padding:"6px 6px !important",borderBottom:"1px solid ".concat(et),whiteSpace:"nowrap",cursor:"pointer",justifyContent:"space-between"},'.cm-tooltip-autocomplete li[aria-selected="true"]':{background:et,color:ea},".cm-completionIcon":{display:"none !important"},".cm-completionDetail":{maxWidth:"250px"},".cm-tooltip.cm-completionInfo.cm-completionInfo-right":{marginLeft:"10px",marginTop:"-10px"},".ml-nest-1":{paddingLeft:"12px"},".ml-nest-2":{paddingLeft:"24px"}},{dark:!0}),er=U.tk.theme({"&":{maxHeight:"1.9em"},".cm-scroller":{overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","-ms-overflow-style":"none"},".cm-scroller::-webkit-scrollbar":{display:"none"},".cm-content":{whiteSpace:"pre"}});var en=a(2002);let ei={key:"ArrowRight",run:e=>"active"===(0,R.LR)(e.state)&&(0,R.dk)(e)},eo=U.tk.inputHandler.of((e,t,a,l)=>("$"===l&&queueMicrotask(()=>(0,R.WA)(e)),!1));function ec(e){let{value:t,onChange:a,vars:s,onKeyDown:r,placeholder:n,singleLine:i=!1,disabled:c=!1,className:d,fontFamily:u}=e,{theme:m}=(0,D.F)(),p=(0,o.useRef)(!1),x=(0,o.useRef)(null),h=(0,o.useRef)();(0,o.useRef)(s).current=s;let g=(0,o.useRef)([]);g.current=s.map(e=>{let{key:t,value:a}=e;return{key:t,value:(0,V.bj)(a)}});let f=(0,o.useRef)(new z.F6).current,b=(0,o.useRef)(new z.F6).current,v=(0,o.useRef)(new z.F6).current,y=(0,o.useRef)(new z.F6).current,j=(0,o.useRef)(new z.F6).current,N=(0,o.useRef)(new z.F6).current,k=(0,o.useRef)(new z.F6).current,w=(0,o.useRef)(new z.F6).current,_=[U.tk.inputHandler.of((e,t,a,l)=>l.includes("\n")),U.$f.of([{key:"Enter",preventDefault:!0,run:e=>(console.log("enter run"),"active"===(0,R.LR)(e.state))?(0,R.dk)(e):(e.dom.blur(),!0)}]),er],C=[U.tk.lineWrapping],I=e=>e?U.tk.theme({".cm-content, .cm-line":{fontFamily:e}}):[],T=e=>U.tk.domEventHandlers({keydown:(t,a)=>(null==e||e(t),t.defaultPrevented)});return(0,o.useLayoutEffect)(()=>{if(x.current&&!h.current)return h.current=new U.tk({parent:x.current,state:z.yy.create({doc:t,extensions:[v.of("dark"===m?es:el),k.of(I(u)),w.of(T(r)),U.$f.of([ei,K.oc]),N.of(i?_:C),U.$f.of(R.B1),U.$f.of(K.wQ),U.$f.of(K.f$),(0,K.m8)(),eo,f.of((0,R.ys)({override:[H(g)],activateOnTyping:!0,closeOnBlur:!1,icons:!1,optionClass(e){var t;let a=null!==(t=e.depth)&&void 0!==t?t:0;return"ml-nest-".concat(a)},compareCompletions:()=>0})),J,b.of(Y(g)),U.tk.updateListener.of(e=>{for(let t of(e.docChanged&&(p.current=!0),e.transactions))t.annotation(R.Jv)&&p.current&&(p.current=!1,a(e.state.doc.toString()))}),U.tk.domEventHandlers({blur(e,t){p.current&&(p.current=!1,a(t.state.doc.toString()))}}),y.of(U.tk.editable.of(!c)),j.of((0,U.W$)(null!=n?n:""))]})}),()=>{var e;null===(e=h.current)||void 0===e||e.destroy(),h.current=void 0}},[]),(0,o.useEffect)(()=>{let e=h.current;if(!e)return;let a=e.state.doc.toString();a!==t&&e.dispatch({changes:{from:0,to:a.length,insert:t}})},[t]),(0,o.useEffect)(()=>{let e=h.current;e&&e.dispatch({effects:[f.reconfigure((0,R.ys)({override:[H(g)],activateOnTyping:!0,closeOnBlur:!1,icons:!1,optionClass(e){var t;let a=null!==(t=e.depth)&&void 0!==t?t:0;return"ml-nest-".concat(a)},compareCompletions:()=>0})),b.reconfigure(Y(g))]})},[s]),(0,o.useEffect)(()=>{let e=h.current;e&&e.dispatch({effects:v.reconfigure("dark"===m?es:el)})},[m]),(0,o.useEffect)(()=>{let e=h.current;e&&e.dispatch({effects:y.reconfigure(U.tk.editable.of(!c))})},[c]),(0,o.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.dispatch({effects:j.reconfigure((0,U.W$)(null!=n?n:""))})},[n]),(0,o.useEffect)(()=>{let e=h.current;e&&e.dispatch({effects:k.reconfigure(I(u))})},[u]),(0,o.useEffect)(()=>{let e=h.current;e&&e.dispatch({effects:w.reconfigure(T(r))})},[r]),(0,l.jsx)("div",{ref:x,className:(0,en.cn)("border-2 border-black p-2 text-sm shadow-[2px_2px_0_0_rgba(0,0,0,1)]","bg-white dark:bg-[#212121]",c&&"cursor-not-allowed opacity-50",i&&"whitespace-nowrap",d)})}var ed=a(75334),eu=e=>{var t,a,s;let r,{block:n,exampleInput:i,loopId:c,onChange:d,onOutputChange:u,replaceableVars:m}=e,[p,x]=(0,o.useState)(n.includeFileUpload||!1),[h,g]=(0,o.useState)(null!==(a=null!==(t=n.exampleFiles)&&void 0!==t?t:n.files)&&void 0!==a?a:[]),[f,b]=(0,o.useState)(null),v=(0,o.useRef)(null),w=(0,o.useMemo)(()=>[{key:"EXAMPLE_FILES",value:h.map(e=>({url:e.url||"https://example.com/placeholder-".concat(e.fileName||"file"),fileName:e.fileName||"file",type:e.type||"application/octet-stream"}))}],[h]),_=e=>Array.isArray(e)?e.map(e=>{let{url:t,fileName:a,type:l,bytes:s}=e;return{url:t,fileName:a,type:l,bytes:s}}):[],C=(e,t)=>{d&&d({files:_(e),exampleFiles:_(e),includeFileUpload:t})};(0,o.useEffect)(()=>{var e,t;let a=null!==(t=null!==(e=n.exampleFiles)&&void 0!==e?e:n.files)&&void 0!==t?t:[];(null==a?void 0:a.length)===h.length&&(null==a?void 0:a.every((e,t)=>{var a;return e.url===(null===(a=h[t])||void 0===a?void 0:a.url)}))||g(a);let l=n.includeFileUpload||!1;p!==l&&x(l)},[n.files,n.exampleFiles,n.includeFileUpload]);let I=(0,o.useCallback)(()=>{if(p&&u&&h.some(e=>e.url)){let e=(()=>{try{return i?JSON.parse(i):{input:"Hello World"}}catch(e){return{input:"Hello World"}}})();u(n.id,JSON.stringify(e,null,2))}},[p,u,h,n.id,i]),T=async e=>{var t;if(!(null===(t=e.target.files)||void 0===t?void 0:t.length))return;if(!c){b("Loop ID is missing – cannot upload.");return}b(null);let a=Array.from(e.target.files),l=a.map(e=>({id:"".concat(e.name,"-").concat(e.size,"-").concat(Date.now()),fileName:e.name,type:e.type,bytes:e.size,uploading:!0}));for(let[e,t]of(g(e=>{let t=[...e,...l];return C(t,!0),t}),a.entries())){let a=l[e].id;try{let{url:e}=await M(t,c);g(t=>{let l=t.map(t=>t.id===a?{...t,url:e,uploading:!1}:t);return C(l,!0),setTimeout(()=>I(),0),l})}catch(t){let e=t instanceof Error?t.message:"Upload failed – try again.";g(t=>t.map(t=>t.id===a?{...t,uploading:!1,error:e}:t))}}e.target.value=""},S=e=>{let t=h.filter((t,a)=>a!==e);g(t),C(t,!0),setTimeout(()=>I(),0)},L=e=>e&&window.open(e,"_blank");return r=c?(0,B.kG)(c):(0,B.kG)("EXAMPLE_LOOP_ID"),(0,l.jsxs)("div",{className:"space-y-3 text-black/80 dark:text-white/80",children:[(0,l.jsxs)("div",{className:"mt-4 flex items-center ".concat("justify-between"),children:[p?(0,l.jsx)("div",{className:"flex items-center justify-between",children:(0,l.jsx)("h3",{className:"text-lg font-bold",children:"Step 1: Select example files to upload"})}):(0,l.jsx)("p",{className:"font-semibold",children:"Trigger this Magic Loop by calling its API:"}),(0,l.jsxs)(F.z,{variant:"outline",size:"sm",onClick:()=>{let e=!p;if(x(e),e||g([]),C(e?h:[],e),!e&&u){let e=(()=>{try{return i?JSON.parse(i):{input:"Hello World"}}catch(e){return{input:"Hello World"}}})();u(n.id,JSON.stringify(e,null,2))}else e&&h.some(e=>e.url)&&setTimeout(()=>I(),0)},className:"flex items-center gap-1 border-2 border-black bg-white text-black transition-all hover:bg-gray-100 dark:border-white dark:bg-black dark:text-white dark:hover:bg-gray-900 ".concat(p?"shadow-[2px_2px_0_0_rgba(220,38,38,1)] hover:shadow-[1px_1px_0_0_rgba(220,38,38,0.8)] dark:shadow-[2px_2px_0_0_rgba(248,113,113,0.8)]":"shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:shadow-[1px_1px_0_0_rgba(0,0,0,0.8)] dark:shadow-[2px_2px_0_0_rgba(255,255,255,0.8)]"),children:[p?(0,l.jsx)(k.Z,{size:16}):(0,l.jsx)(j.Z,{size:16}),p?"Remove file upload":"Add file upload"]})]}),p&&(0,l.jsxs)("div",{className:"mb-3 rounded-md",children:[(0,l.jsxs)("div",{className:"mb-3",children:[(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,l.jsx)("input",{type:"file",multiple:!0,ref:v,onChange:T,className:"hidden",id:"file-input"}),(0,l.jsxs)(F.z,{size:"sm",className:"border-2 border-black bg-white text-black shadow-[2px_2px_0_0_rgba(0,0,0,1)] transition-all hover:bg-gray-100 hover:shadow-[1px_1px_0_0_rgba(0,0,0,0.8)] dark:border-white dark:bg-black dark:text-white dark:shadow-[2px_2px_0_0_rgba(255,255,255,0.8)] dark:hover:bg-gray-900",onClick:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.click()},children:[(0,l.jsx)(j.Z,{size:16,className:"mr-1"}),"Upload"]}),(0,l.jsx)("span",{className:"rounded-md border border-gray-300 bg-gray-100 px-2 py-0.5 text-xs text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:"Test Mode"})]}),f&&(0,l.jsx)("p",{className:"mt-2 text-xs text-red-500",children:f}),h.length>0&&Array.isArray(h)&&(0,l.jsx)("ul",{className:"mt-4 space-y-2",children:h.map((e,t)=>{var a;return(0,l.jsxs)("li",{className:"flex flex-wrap items-center justify-between gap-2 rounded-md border-2 border-dashed border-slate-400 bg-white p-2 dark:border-white",children:[(0,l.jsx)(y(),{className:"w-[180px] flex-1 truncate overflow-ellipsis pl-2 font-medium text-blue-600 dark:text-blue-300",title:e.fileName,onClick:()=>L(e.url),href:e.url||"",target:"_blank",children:e.fileName}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("span",{className:"rounded-full bg-purple-100 px-2 py-0.5 text-xs text-purple-700 dark:bg-purple-800/30 dark:text-purple-300",children:null!==(a=e.type.split("/")[1]||e.type)&&void 0!==a?a:"unknown"}),(0,l.jsx)("span",{className:"rounded-full bg-amber-100 px-2 py-0.5 text-xs text-amber-700 dark:bg-amber-800/30 dark:text-amber-300",children:e.bytes?"".concat((e.bytes/1024).toFixed(1)," KB"):"—"}),e.uploading&&(0,l.jsx)("span",{className:"rounded-full bg-yellow-100 px-2 py-0.5 text-xs text-yellow-700 dark:bg-yellow-800/30 dark:text-yellow-300",children:"Uploading…"}),e.url&&(0,l.jsx)("span",{className:"rounded-full bg-green-100 px-2 py-0.5 text-xs text-green-700 dark:bg-green-800/30 dark:text-green-300",children:"Uploaded"}),e.error&&(0,l.jsx)("span",{className:"rounded-full bg-red-100 px-2 py-0.5 text-xs text-red-700 dark:bg-red-800/30 dark:text-red-300",children:"Failed"}),(0,l.jsx)(F.z,{size:"sm",variant:"ghost",className:"bg-white text-red-600 opacity-50 transition-all hover:bg-red-50 hover:text-red-600 hover:opacity-100 dark:bg-black dark:hover:bg-red-950",onClick:()=>S(t),children:(0,l.jsx)(N.Z,{size:14})})]})]},e.id)})}),(0,l.jsx)("p",{className:"mb-6 mt-3 text-xs text-gray-500",children:"This upload component is for testing only. In production, use API calls as shown in the code examples below."})]}),h.length>0&&(0,l.jsxs)("div",{className:"mb-4 space-y-2",children:[(0,l.jsx)(ed.Z,{className:"text-sm font-medium",children:"Example Input (for testing/dry-runs only)"}),(0,l.jsx)(ec,{value:null!==(s=n.exampleInput)&&void 0!==s?s:"",vars:w,onChange:e=>{n.exampleInput!==e&&(null==d||d({exampleInput:e}))},disabled:!1,placeholder:'{"message": "hello", "image": "$EXAMPLE_FILES[0].url"}'}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"This input will be used during testing and dry-runs only. Use $EXAMPLE_FILES[0].url for file references."})]})]}),(0,l.jsxs)("div",{children:[p&&(0,l.jsx)("h3",{className:"mb-2 font-bold",children:"Step 2: Trigger your loop with the file references"}),(0,l.jsx)(P,{reqUrl:r,exampleInput:(()=>{if(p&&n.exampleInput)try{return JSON.parse(n.exampleInput),n.exampleInput}catch(e){return JSON.stringify({input:"Hello World"},null,2)}try{let e=i?JSON.parse(i):{input:"Hello World"};return JSON.stringify(e,null,2)}catch(e){return JSON.stringify({input:"Hello World"},null,2)}})(),includeFileUpload:p,files:h,loopId:c}),Array.isArray(h)&&h.some(e=>e.url)&&p&&(0,l.jsxs)("div",{className:"mt-2 flex items-center gap-1 text-xs text-blue-600 dark:text-blue-300",children:[(0,l.jsx)("div",{className:"h-2 w-2 rounded-full bg-blue-500"}),(0,l.jsx)("span",{children:"Note: File references are included in request body"})]}),(0,l.jsx)("p",{className:"mb-4 pt-1 text-xs italic text-black/40 dark:text-white/40",children:"If this Loop is called when deactivated, it will not run, but the payload will be displayed below for testing."})]})]})},em=e=>{var t;let{block:a,onChange:s,disabled:r,replaceableVars:n}=e;return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 py-4",children:[(0,l.jsx)(ec,{value:null!==(t=a.response)&&void 0!==t?t:"",vars:n,onChange:e=>{a.response!==e&&s({response:e})},disabled:r}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables here"})]})},ep=a(80843),ex=a(4901),eh=a(46114),eg=e=>{var t,a;let{block:s,onChange:r,generating:n,readOnly:i,disabled:c,className:d=""}=e,u=(0,o.useRef)(!1),m=(0,o.useRef)(null!==(t=s.code)&&void 0!==t?t:"");(0,o.useEffect)(()=>{if(u.current!==n&&(u.current=n,!n)){var e;m.current=null!==(e=s.code)&&void 0!==e?e:""}},[s.code,n]);let p=(0,o.useCallback)(()=>{var e,t;let a=null!==(e=m.current)&&void 0!==e?e:"",l=null!==(t=s.code)&&void 0!==t?t:"";return n?l+"█"+a.slice(l.length+1,a.length):l},[s.code,n]),x=(0,o.useCallback)(e=>{p()!==e&&r({code:e})},[s,p,r]);return(0,l.jsxs)("div",{className:"space-y-4 pt-4 ".concat(d),children:[(0,l.jsx)(eh.Z,{className:"w-full",disabled:c,value:null!==(a=null==s?void 0:s.language)&&void 0!==a?a:ex.mF[0],onChange:e=>{var t,a;if(!ex.mF.includes(e.target.value))return;let l=null!==(a=null==s?void 0:s.language)&&void 0!==a?a:ex.mF[0];if(l===e.target.value)return;let n=e.target.value,i={language:n};(null===(t=s.code)||void 0===t?void 0:t.trim())===ex.fl[l].trim()&&(i.code=ex.fl[n]),r(i)},children:ex.mF.map(e=>(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,l.jsx)(ep.Z,{code:p(),language:s.language,onChange:n?void 0:x,disabled:c||n||i})]})},ef=a(15305),eb=e=>{var t;let{block:a,onChange:s,disabled:r}=e;return(0,l.jsxs)("div",{className:"my-4 flex flex-col space-y-2",children:[(0,l.jsxs)("div",{className:"flex flex-row items-center",children:[(0,l.jsx)("p",{className:"rounded-lg bg-transparent pr-1 text-black/80 focus:outline-none dark:text-white/80",children:"Find the difference between the current run's output and the last run's output"}),(0,l.jsx)(ef.Z,{color:"light",content:"Use this block to find any new changes since the last time this Loop ran. It works by comparing the lines from the previous run's output to the lines in the current run's output."})]}),(0,l.jsx)(ep.Z,{language:"python",disabled:r,code:null!==(t=a.code)&&void 0!==t?t:"",title:"Python Code:",note:"Print the diff between the previous run's input and the current input.",onChange:e=>{a.code!==e&&s({code:e})}})]})},ev=a(85891),ey=e=>{var t;let{block:a}=e;return(0,l.jsxs)("div",{className:"text-black/80 dark:text-white/80",children:[(0,l.jsx)("p",{className:"text-sm font-semibold sm:text-base",children:"Trigger this Magic Loop by emailing it at:"}),(0,l.jsx)(ev.Z,{text:null!==(t=a.emailAddress)&&void 0!==t?t:"",className:"text-base text-cyan-600 sm:text-lg"}),(0,l.jsx)("p",{className:"rounded-lg bg-transparent pt-2 text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:"Click link to copy to clipboard"}),(0,l.jsx)("p",{className:"rounded-lg bg-transparent text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:"Email body will be used as the Loop input"})]})},ej=a(31031),eN=a(48029),ek=e=>{var t,a,s,r;let{block:n,onChange:i,disabled:c}=e,d=(0,o.useRef)(null);return(0,o.useEffect)(()=>{d.current&&(0,ej.OJ)(d.current)},[n.inputMatch]),(0,l.jsxs)("div",{className:"my-4 flex flex-col space-y-2",children:[(0,l.jsxs)("div",{className:"flex flex-row items-center",children:[(0,l.jsx)("p",{className:"rounded-lg bg-transparent pr-1 text-black/80 focus:outline-none dark:text-white/80",children:"Exit if block input equals:"}),(0,l.jsx)(ef.Z,{color:"light",content:"Use this block to stop your Loop early under certain conditions.\n\n* EXACT MATCH: enter a string (case sensitive) and the Loop will stop if this block's input matches it exactly.\n\n* REGULAR EXPRESSION: The Loop will stop running if the block input matches this regexp (uses V8's implementation, which is ECMAScript compliant)\n\n* CODE: Python (v3.9) code that returns true if the Loop should stop, false otherwise."})]}),(0,l.jsx)(eh.Z,{className:"w-full ",disabled:c,value:null!==(t=n.mode)&&void 0!==t?t:ex.de[0],onChange:e=>{ex.de.includes(e.target.value)&&n.mode!==e.target.value&&i({mode:e.target.value})},children:ex.de.map(e=>(0,l.jsxs)("option",{value:e,className:"bg-[#262f34] text-white/80",children:["exact"===e&&"Exact Match","regExp"===e&&"Regular Expresson","code"===e&&"Code (Python)"]},e))}),"exact"===n.mode&&(0,l.jsx)(eN.Z,{ref:d,containerClassName:"min-h-[100px]",value:null!==(a=n.inputMatch)&&void 0!==a?a:"",disabled:c,placeholder:"Enter exit match here...",onChange:e=>{n.inputMatch!==e&&i({inputMatch:e})}}),"regExp"===n.mode&&(0,l.jsx)(eN.Z,{ref:d,containerClassName:"min-h-[100px]",value:null!==(s=n.regExp)&&void 0!==s?s:"",disabled:c,placeholder:"Enter Regular Expression here...",onChange:e=>{n.regExp!==e&&i({regExp:e})}}),"code"===n.mode&&(0,l.jsx)(ep.Z,{language:"python",disabled:c,code:null!==(r=n.code)&&void 0!==r?r:"",title:"Python Code:",note:"Return true if the Loop should stop running, false otherwise.",onChange:e=>{n.code!==e&&i({code:e})}})]})},ew=a(12957),e_=e=>{var t,a,s,r;let{block:n,onChange:i,disabled:o,replaceableVars:c}=e;return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 pb-4 pt-2",children:[(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Method:"}),(0,l.jsx)(eh.Z,{className:"w-full",disabled:o,value:null!==(t=n.method)&&void 0!==t?t:ex.AO[0],onChange:e=>{ex.AO.includes(e.target.value)&&n.method!==e.target.value&&i({method:e.target.value})},children:ex.AO.map(e=>(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:e},e))}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"URL:"}),(0,l.jsx)(ec,{value:null!==(a=n.url)&&void 0!==a?a:"",vars:c,onChange:e=>{if(n.url===e)return;let t=e.trim();!t||t.startsWith("http")||t.startsWith("$")||(t="https://".concat(e)),i({url:t})},disabled:o,singleLine:!0,placeholder:"https://news.ycombinator.com...",className:"w-full"}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Headers (JSON):"}),(0,l.jsx)(ec,{value:null!==(s=n.headers)&&void 0!==s?s:"",vars:c,disabled:o,placeholder:'{ "Authorization": "foo..." }',onChange:e=>{n.headers!==e&&i({headers:e})}}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Body (JSON):"}),(0,l.jsx)(ec,{value:null!==(r=n.body)&&void 0!==r?r:"",vars:c,disabled:o,placeholder:'{ "input": "I love Magic Loops..." }',onChange:e=>{n.body!==e&&i({body:e})}}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Options:"}),(0,l.jsxs)("div",{className:"ml-1 flex flex-row items-center space-x-2",children:[(0,l.jsx)(ew.Z,{checked:!!n.retryCount,disabled:o,alt:"Retry?",onChange:e=>{!!n.retryCount!==e.target.checked&&i({retryCount:e.target.checked?2:0})}}),(0,l.jsx)(ed.Z,{className:"text-sm text-black/40 dark:text-white/40",children:"Retry on fail?"}),(0,l.jsx)(ef.Z,{color:"light",content:"This will retry the request up to 2 times (ie 3 times total) with exponential back-off if it fails with no response or a 5xx error. Make sure the service you're calling is able to handle being called multiple times!"})]}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables in any field"})]})},eC=a(7988),eI=e=>{var t;let{block:a,onChange:s,disabled:r,exampleInput:n}=e;return(0,l.jsxs)("div",{className:"space-y-3 text-black/80 dark:text-white/80",children:[(0,l.jsx)("p",{className:"font-semibold",children:"Trigger this Magic Loop by calling it's webhook:"}),(0,l.jsxs)("div",{children:[(0,l.jsx)(P,{reqUrl:a.hookUrl,exampleInput:n}),(0,l.jsx)("p",{className:"pt-1 text-xs italic text-black/40 dark:text-white/40 ",children:"If this Loop is called when deactivated, it will not run, but the payload will be displayed below for testing."})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)(eC.Z,{type:"text",value:null!==(t=a.redirectUrl)&&void 0!==t?t:"",disabled:r,placeholder:"(Optional) URL to redirect to...",onBlur:e=>{let t=e.target.value;!t||t.startsWith("http")||t.startsWith("$")||s({redirectUrl:"https://".concat(e.target.value)})},onChange:e=>{a.redirectUrl!==e.target.value&&s({redirectUrl:e.target.value})}}),(0,l.jsx)("p",{className:"rounded-lg bg-transparent text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:"To redirect the user dynamically instead, add a 'redirectUrl' URL parameter to the webhook URL. If there is a failure or there is nowhere to redirect the caller, a JSON response will be sent back"})]})]})},eT=a(81173),eS=e=>{let{block:t,onChange:a,disabled:s,replaceableVars:r}=e,[n,i]=(0,o.useState)(""),c=(()=>{if(!t.inputImages)return[];if(Array.isArray(t.inputImages))return t.inputImages;if("string"==typeof t.inputImages)try{let e=JSON.parse(t.inputImages);return Array.isArray(e)?e:[]}catch(e){}return[]})(),d=e=>{let t=[...c];t.splice(e,1),a({inputImages:t})};return(0,l.jsxs)("div",{className:"space-y-4 py-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium",children:"Prompt"}),(0,l.jsx)(ec,{value:t.prompt,vars:r,onChange:e=>a({prompt:e}),disabled:s,placeholder:"Describe the image you want to generate..."})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"Input Images (Optional)"}),(0,l.jsxs)("div",{className:"mb-2 flex space-x-2",children:[(0,l.jsx)(ec,{value:n,vars:r,onChange:i,disabled:s||c.length>=16,placeholder:"Enter image URL/variable",singleLine:!0,className:"w-full break-all"}),(0,l.jsx)(eT.Z,{onClick:()=>{n&&(a({inputImages:[...c,n]}),i(""))},disabled:s||!n||c.length>=16,className:"px-3 py-1",children:"Add"})]}),(0,l.jsx)("p",{className:"mb-4 text-xs text-gray-500 dark:text-gray-400",children:"Add up to 16 image URLs as reference images for generation. These images will guide the AI model to create a composite result. Supported formats: JPG, PNG, and WebP. Each image must be less than 25MB and total size cannot exceed 30MB. Only public HTTP/HTTPS URLs are supported."}),c.length>0&&(0,l.jsx)("div",{className:"mt-2 space-y-2",children:c.map((e,t)=>(0,l.jsxs)("div",{className:"flex items-center rounded border bg-gray-50 p-2 dark:bg-gray-800",children:[(0,l.jsx)("div",{className:"min-w-0 flex-1",children:(0,l.jsx)(ec,{value:e,vars:r,onChange:e=>{let l=[...c];l[t]=e,a({inputImages:l})},disabled:s,singleLine:!0,className:"break-all border-0 bg-transparent p-0 shadow-none"})}),(0,l.jsx)("button",{onClick:()=>d(t),className:"ml-2 flex-shrink-0 text-red-500 hover:text-red-700",disabled:s,children:"✕"})]},t))}),c.length>=16&&(0,l.jsx)("p",{className:"mt-1 text-xs text-amber-500",children:"Maximum of 16 input images reached."})]}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(ed.Z,{className:"block text-sm font-medium",children:"Model"}),(0,l.jsx)(eh.Z,{value:t.model,onChange:e=>a({model:e.target.value}),disabled:s,className:"mt-1 w-full p-2",children:(0,l.jsx)("option",{value:"gpt-image-1",children:"GPT Image 1"})})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(ed.Z,{className:"block text-sm font-medium",children:"Size"}),(0,l.jsxs)(eh.Z,{value:t.size,onChange:e=>a({size:e.target.value}),disabled:s,className:"mt-1 w-full p-2",children:[(0,l.jsx)("option",{value:"1024x1024",children:"1024x1024"}),(0,l.jsx)("option",{value:"1536x1024",children:"1536x1024"}),(0,l.jsx)("option",{value:"1024x1536",children:"1024x1536"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(ed.Z,{className:"block text-sm font-medium",children:"Quality"}),(0,l.jsxs)(eh.Z,{value:t.quality,onChange:e=>a({quality:e.target.value}),disabled:s,className:"mt-1 w-full p-2",children:[(0,l.jsx)("option",{value:"low",children:"Low"}),(0,l.jsx)("option",{value:"medium",children:"Medium"}),(0,l.jsx)("option",{value:"high",children:"High"}),(0,l.jsx)("option",{value:"auto",children:"Auto"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)(ed.Z,{className:"block text-sm font-medium",children:"Number of Images"}),(0,l.jsx)(eC.Z,{type:"number",min:"1",max:"10",value:t.n,onChange:e=>a({n:parseInt(e.target.value)}),disabled:s,className:"mt-1 w-full p-2"})]})]})]})};let eL={GPT_4_TURBO:"gpt-4-turbo",GPT_4o:"gpt-4o",GPT_4o_MINI:"gpt-4o-mini",o1_preview:"o1-preview",o1_mini:"o1-mini",o3_mini:"o3-mini",o4_mini:"o4-mini",gpt_4_1:"gpt-4.1",gpt_4_1_mini:"gpt-4.1-mini",gpt_4_1_nano:"gpt-4.1-nano",gpt_5:"gpt-5",gpt_5_mini:"gpt-5-mini",gpt_5_nano:"gpt-5-nano"};eL.o4_mini;let eO=eL.GPT_4o_MINI;eL.gpt_4_1;let eE=[eL.GPT_4o_MINI,eL.GPT_4o],eZ=[eL.GPT_4o_MINI,eL.GPT_4o,eL.gpt_4_1_nano,eL.gpt_4_1_mini,eL.gpt_4_1,eL.gpt_5_nano,eL.gpt_5_mini,eL.gpt_5],eA={TOKEN_LIMIT_8K:"8k",TOKEN_LIMIT_32K:"32k",TOKEN_LIMIT_64K:"64k"},eP={[eA.TOKEN_LIMIT_8K]:{name:eA.TOKEN_LIMIT_8K,description:"6,000 words",tokenLimit:8e3},[eA.TOKEN_LIMIT_32K]:{name:eA.TOKEN_LIMIT_32K,description:"24,000 words",tokenLimit:32e3},[eA.TOKEN_LIMIT_64K]:{name:eA.TOKEN_LIMIT_64K,description:"48,000 words",tokenLimit:64e3}},eF={[eL.GPT_4_TURBO]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K],[eL.GPT_4o]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K],[eL.GPT_4o_MINI]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K],[eL.gpt_4_1_nano]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K],[eL.gpt_4_1_mini]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K],[eL.gpt_4_1]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K],[eL.gpt_5_nano]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K],[eL.gpt_5_mini]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K],[eL.gpt_5]:[eA.TOKEN_LIMIT_8K,eA.TOKEN_LIMIT_32K,eA.TOKEN_LIMIT_64K]},eM={[eL.GPT_4_TURBO]:{id:eL.GPT_4_TURBO,shortName:"GPT-4-TURBO",name:"OpenAI: GPT-4 Turbo",maker:"OpenAI",inputTokenLimit:11e4,responseTokenLimit:4e3,tokenLimit:114e3,temperature:0,version:"gpt-4-turbo"},[eL.GPT_4o]:{id:eL.GPT_4o,shortName:"GPT-4o",name:"OpenAI: GPT-4o",maker:"OpenAI",inputTokenLimit:106e3,responseTokenLimit:8e3,tokenLimit:114e3,temperature:0,version:"gpt-4o-2024-08-06"},[eL.GPT_4o_MINI]:{id:eL.GPT_4o_MINI,shortName:"GPT-4o-mini",name:"OpenAI: GPT-4o mini",maker:"OpenAI",inputTokenLimit:11e4,responseTokenLimit:4e3,tokenLimit:114e3,temperature:0,version:"gpt-4o-mini"},[eL.o1_preview]:{id:eL.o1_preview,shortName:"o1-preview",name:"OpenAI: o1 preview",maker:"OpenAI",inputTokenLimit:9e4,responseTokenLimit:3e4,tokenLimit:12e4,temperature:0,version:"o1-preview-2024-09-12"},[eL.o1_mini]:{id:eL.o1_mini,shortName:"o1-mini",name:"OpenAI: o1 mini",maker:"OpenAI",inputTokenLimit:6e4,responseTokenLimit:6e4,tokenLimit:12e4,temperature:0,version:"o1-mini-2024-09-12"},[eL.o3_mini]:{id:eL.o3_mini,shortName:"o3-mini",name:"OpenAI: o3-mini",maker:"OpenAI",inputTokenLimit:1e5,responseTokenLimit:8e4,tokenLimit:18e4,temperature:0,version:"o3-mini-2025-01-31"},[eL.o4_mini]:{id:eL.o4_mini,shortName:"o4-mini",name:"OpenAI: o4-mini",maker:"OpenAI",inputTokenLimit:1e5,responseTokenLimit:8e4,tokenLimit:18e4,temperature:0,version:"o4-mini-2025-04-16"},[eL.gpt_4_1]:{id:eL.gpt_4_1,shortName:"gpt-4.1",name:"OpenAI: GPT-4.1",maker:"OpenAI",inputTokenLimit:95e4,responseTokenLimit:32e3,tokenLimit:982e3,temperature:0,version:"gpt-4.1-2025-04-14"},[eL.gpt_4_1_mini]:{id:eL.gpt_4_1_mini,shortName:"gpt-4.1-mini",name:"OpenAI: GPT-4.1 mini",maker:"OpenAI",inputTokenLimit:95e4,responseTokenLimit:32e3,tokenLimit:982e3,temperature:0,version:"gpt-4.1-mini-2025-04-14"},[eL.gpt_4_1_nano]:{id:eL.gpt_4_1_nano,shortName:"gpt-4.1-nano",name:"OpenAI: GPT-4.1 nano",maker:"OpenAI",inputTokenLimit:95e4,responseTokenLimit:32e3,tokenLimit:982e3,temperature:0,version:"gpt-4.1-nano-2025-04-14"},[eL.gpt_5]:{id:eL.gpt_5,shortName:"GPT-5",name:"OpenAI: GPT-5",maker:"OpenAI",inputTokenLimit:22e4,responseTokenLimit:128e3,tokenLimit:348e3,temperature:0,version:"gpt-5-2025-08-07"},[eL.gpt_5_mini]:{id:eL.gpt_5_mini,shortName:"GPT-5 mini",name:"OpenAI: GPT-5 mini",maker:"OpenAI",inputTokenLimit:22e4,responseTokenLimit:128e3,tokenLimit:348e3,temperature:0,version:"gpt-5-mini-2025-08-07"},[eL.gpt_5_nano]:{id:eL.gpt_5_nano,shortName:"GPT-5 nano",name:"OpenAI: GPT-5 nano",maker:"OpenAI",inputTokenLimit:22e4,responseTokenLimit:128e3,tokenLimit:348e3,temperature:0,version:"gpt-5-nano-2025-08-07"}};var eB=e=>{var t;let{block:a,onChange:s,disabled:r}=e,{user:n}=(0,b.a)(),i=n?eZ:eE,o=a.model||eO;return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 py-4",children:[(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Example Output:"}),(0,l.jsx)(eN.Z,{containerClassName:"pl-2 min-h-[100px]",disabled:r,value:null!==(t=a.example)&&void 0!==t?t:"",placeholder:"Write a haiku about the above...",onChange:e=>{a.example!==e&&s({example:e})}}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Model:"}),(0,l.jsx)(eh.Z,{className:"w-full",disabled:r,value:o||eO,onChange:e=>{i.includes(e.target.value)&&o!==e.target.value&&s({model:e.target.value})},children:eZ.map(e=>(0,l.jsxs)("option",{value:e,disabled:!eZ.includes(e),className:"bg-[#262f34] text-black dark:text-white/80",children:[eM[e].name," ",eZ.includes(e)?"":"Please login to access"]},e))}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Options:"}),(0,l.jsxs)("div",{className:"ml-1 flex flex-row items-center space-x-1",children:[(0,l.jsx)(ew.Z,{id:"historyCheckbox",checked:!!a.history,disabled:r,alt:"Chat History",onChange:e=>{!!a.history!==e.target.checked&&s({history:!!e.target.checked})}}),(0,l.jsx)(ed.Z,{htmlFor:"historyCheckbox",className:"cursor-pointer select-none pl-1 text-sm text-black dark:text-white/40",children:"Chat History"}),(0,l.jsx)(ef.Z,{color:"light",content:"Saves the $BLOCK_INPUT, prompt, and response into a chat history that's sent on all invocations. \n\nThis is useful for making sure the LLM doesn't repeat itself between Loop runs. \n\nPlease note: the history is counted towards your credits!"})]}),a.history&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"ml-1 flex flex-row items-center space-x-1 py-1",children:(0,l.jsxs)("div",{className:"flex flex-row",children:[(0,l.jsx)(eh.Z,{className:"mr-1",disabled:r,value:a.historyTokenLimit||eP[eA.TOKEN_LIMIT_8K].tokenLimit,onChange:e=>{let t=Number(e.target.value);a.historyTokenLimit!==t&&s({historyTokenLimit:t})},children:eF[o].map(e=>(0,l.jsx)("option",{value:eP[e].tokenLimit,disabled:!eF[o].includes(e),className:"bg-[#262f34] text-black dark:text-white/80",children:eP[e].description},e))}),(0,l.jsx)(ef.Z,{className:"pl-1 pt-3",color:"light",content:"6,000 words is approximately:\n- 1-3 credits w/nano and mini\n- 40-50 credits w/GPT-4.1 and 4o \n\n24,000 words is approximately:\n- 3-12 credits w/nano and mini\n- 160-200 credits w/GPT-4.1 and 4o \n\n48,000 words is approximately:\n- 6-24 credits w/nano and mini\n- 320-400 credits w/GPT-4.1 and 4o\n"})]})}),(0,l.jsx)("div",{className:"flex flex-row",children:(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"(To clear history: create a new LLM Block)"})})]}),(!o||o===eL.gpt_5||o===eL.gpt_5_mini||o===eL.gpt_5_nano||o===eL.gpt_4_1||o===eL.gpt_4_1_mini||o===eL.gpt_4_1_nano||o===eL.GPT_4o_MINI||o===eL.GPT_4o||o===eL.GPT_4_TURBO)&&(0,l.jsxs)("div",{className:"ml-1 flex flex-row items-center space-x-1",children:[(0,l.jsx)(ew.Z,{id:"jsonModeCheckbox",checked:!!a.jsonMode,disabled:r,alt:"JSON Mode",className:"h-4 w-4 cursor-pointer rounded-none border-2 border-black bg-white p-2 shadow-[2px_2px_0_0_rgba(0,0,0,1)] outline-none transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)] enabled:hover:outline-none",onChange:e=>{!!a.jsonMode!==e.target.checked&&s({jsonMode:!!e.target.checked})}}),(0,l.jsx)(ed.Z,{htmlFor:"jsonModeCheckbox",className:"cursor-pointer select-none pl-1 text-sm text-black dark:text-white/40",children:"JSON Mode"}),(0,l.jsx)(ef.Z,{color:"light",content:'Sets the response_format to { type: "json_object" } to enable JSON mode. \n\nPlease note: always instruct the model to produce JSON via some message in the prompt.'})]}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"You can use previous Block Outputs, & Loop Variables in the prompt"}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"This block uses ".concat(eM[o].shortName," from ").concat(eM[o].maker,". Input truncated to ").concat((0,ej.ER)(eM[o].inputTokenLimit)," tokens")})]})},eR=e=>{var t;let{block:a,onChange:s,disabled:r,replaceableVars:n}=e,i=ex.ih,o=a.model||ex.ih[0];return(0,l.jsxs)("div",{className:"mt-2 flex flex-col space-y-2",children:[(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Prompt:"}),(0,l.jsx)(ec,{value:null!==(t=a.prompt)&&void 0!==t?t:"",vars:n,disabled:r,placeholder:"What is the latest news in biotech?",onChange:e=>{a.prompt!==e&&s({prompt:e})}}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Model:"}),(0,l.jsx)(eh.Z,{className:"w-full",disabled:r,value:o||ex.ih[0],onChange:e=>{i.includes(e.target.value)&&o!==e.target.value&&s({model:e.target.value})},children:ex.ih.map(e=>(0,l.jsxs)("option",{value:e,disabled:!ex.ih.includes(e),className:"bg-[#262f34] text-white/80",children:[0===e.length?e:e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()," "]},e))}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-orange-600 dark:text-orange-400",children:"NOTE: This Block does not receive the previous Block's output automatically. You must specify $BLOCK_INPUT within the prompt."}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables in the prompt"}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:'This block uses an "online" model from Perplexity that can search the internet. Input truncated to '.concat(12e4," tokens")})]})},eK=e=>{var t,a,s;let{block:r,onChange:n,disabled:i,replaceableVars:o}=e;return(0,l.jsxs)("div",{className:"my-2 flex flex-col space-y-2",children:[(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"URL"}),(0,l.jsx)(ec,{value:null!==(t=r.url)&&void 0!==t?t:"",vars:o,onChange:e=>{if(r.url===e)return;let t=e.trim();!t||t.startsWith("http")||t.startsWith("$")||(t="https://".concat(e)),n({url:t})},disabled:i,singleLine:!0,placeholder:"https://your-custom-webhook.com/api/trigger...",className:"w-full"}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Headers (JSON):"}),(0,l.jsx)(ec,{value:null!==(a=r.headers)&&void 0!==a?a:"",vars:o,disabled:i,placeholder:'{ "Authorization": "foo..." }',onChange:e=>{r.headers!==e&&n({headers:e})}}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Body (JSON):"}),(0,l.jsx)(ec,{value:null!==(s=r.body)&&void 0!==s?s:"",vars:o,disabled:i,placeholder:'{ "input": "I love Magic Loops..." }',onChange:e=>{r.body!==e&&n({body:e})}}),(0,l.jsx)("label",{className:"text-xs italic text-white/40",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables in any field"})]})},ez=e=>{var t,a,s;let{block:r,onChange:n,disabled:i,replaceableVars:c}=e,[d,u]=(0,o.useState)(null);return(0,l.jsxs)("div",{className:"my-4 flex flex-col space-y-2",children:[(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"To:"}),(0,l.jsx)(ec,{value:null!==(t=r.to)&&void 0!==t?t:"",vars:c,onChange:e=>{u((0,ej.vV)(e)?null:"Invalid email!"),r.to!==e&&n({to:e})},disabled:i,singleLine:!0,placeholder:"Your Email..."}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Subject:"}),(0,l.jsx)(ec,{value:null!==(a=r.subject)&&void 0!==a?a:"",vars:c,onChange:e=>{r.subject!==e&&n({subject:e})},disabled:i,singleLine:!0,placeholder:"Your Magic Loop just ran..."}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Body:"}),(0,l.jsx)(ec,{value:null!==(s=r.content)&&void 0!==s?s:"",vars:c,onChange:e=>{r.content!==e&&n({content:e})},disabled:i,placeholder:"Magic Loop Result: $BLOCK_INPUT...",className:"min-h-[100px]"}),(0,l.jsxs)("div",{className:"ml-1 flex flex-row items-center space-x-2",children:[(0,l.jsx)(ew.Z,{id:"markdownCheckbox",checked:!!r.markdown,disabled:i,alt:"Use Markdown",onChange:e=>{!!r.markdown!==e.target.checked&&n({markdown:!!e.target.checked})}}),(0,l.jsx)(ed.Z,{htmlFor:"markdownCheckbox",className:"cursor-pointer select-none text-sm font-semibold",children:"Use Markdown"}),(0,l.jsx)(ef.Z,{color:"light",content:"Sends this email with markdown formatting, otherwise sends as plain text"})]}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables in any field"}),d&&(0,l.jsx)("p",{className:"px-1 text-xs text-red-600",children:d})]})},eU=a(34712),eD=a(33279),eV=a(17442);let eq=o.forwardRef((e,t)=>{let{className:a,containerClassName:s,...r}=e;return(0,l.jsx)(eD.uZ,{ref:t,containerClassName:(0,en.cn)("flex items-center gap-2 has-[:disabled]:opacity-50",s),className:(0,en.cn)("disabled:cursor-not-allowed",a),...r})});eq.displayName="InputOTP";let e$=o.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)("div",{ref:t,className:(0,en.cn)("flex items-center",a),...s})});e$.displayName="InputOTPGroup";let eG=o.forwardRef((e,t)=>{let{index:a,className:s,...r}=e,{char:n,hasFakeCaret:i,isActive:c}=o.useContext(eD.VM).slots[a];return(0,l.jsxs)("div",{ref:t,className:(0,en.cn)("relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",c&&"z-10 ring-2 ring-ring ring-offset-background",s),...r,children:[n,i&&(0,l.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center",children:(0,l.jsx)("div",{className:"h-4 w-px animate-caret-blink bg-foreground duration-1000"})})]})});eG.displayName="InputOTPSlot",o.forwardRef((e,t)=>{let{...a}=e;return(0,l.jsx)("div",{ref:t,role:"separator",...a,children:(0,l.jsx)(eV.Z,{})})}).displayName="InputOTPSeparator";var eJ=a(74870),eW=e=>{let{handleVerifiedNumber:t,isOpen:a,onClose:s}=e,[r,n]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[d,u]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!1),[x,h]=(0,o.useState)(""),[g,f]=(0,o.useState)(!1),b=async()=>{u(!0),h(""),f(!1);try{let e=await (0,eJ.ei)(r),t=await fetch("/api/phone/startVerification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:e})});if(!t.ok){if(401===t.status)throw Error("Please sign up to validate a phone number.");throw Error("Error initiating verification.")}p(!0)}catch(e){e instanceof Error?h(e.message):h("An unexpected error occurred")}u(!1)},v=(0,o.useCallback)(async()=>{u(!0),h(""),f(!1);try{if(!(await fetch("/api/phone/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:r,verificationCode:i})})).ok)throw Error("Error verifying code. Please try again.");f(!0),N(!1),setTimeout(()=>{t(r),s(),f(!1)},2e3)}catch(e){p(!1),f(!1),c(""),e instanceof Error?h(e.message):h("An unexpected error occurred. Please try again."),setTimeout(()=>{N(!0)},3e3)}u(!1)},[r,i,t,s]);(0,o.useEffect)(()=>{i&&6===i.length&&!d&&v()},[i,v,d]);let y=(0,o.useCallback)(e=>{h(""),f(!1),n(e)},[]),j=(0,o.useCallback)(async e=>{h("");let t=await (0,eJ.ei)(e);t?y(t):h("'".concat(e,"' is an invalid or fake phone number! Format: '+[country code] [number]'"))},[y]),N=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];p(!1),u(!1),h(""),n(""),c(""),e&&f(!1)};return a?(0,l.jsx)("div",{className:"fixed inset-0 z-[500] h-full w-full overflow-y-auto bg-gray-600 bg-opacity-75",children:(0,l.jsxs)("div",{className:"relative top-[35%] mx-auto min-h-[150px] w-96 rounded-md border bg-white px-5 pb-3 pt-8 shadow-lg",children:[(0,l.jsx)("div",{className:"absolute right-0 top-0 m-3 cursor-pointer",onClick:()=>{N(),s()},children:(0,l.jsx)("svg",{className:"fill-current text-black",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 18 18",children:(0,l.jsx)("path",{d:"M18 1.41L16.59 0L9 7.58L1.41 0L0 1.41L7.58 9L0 16.59L1.41 18L9 10.42L16.59 18L18 16.59L10.42 9L18 1.41z"})})}),x&&(0,l.jsx)("div",{className:"my-3 rounded bg-red-200 p-3 text-red-700",children:x}),!m&&!d&&!g&&(0,l.jsxs)("div",{className:"flex flex-col items-stretch",children:[(0,l.jsx)("label",{htmlFor:"phone_number",className:"text-sm font-bold text-gray-700",children:"Phone Number:"}),(0,l.jsx)("input",{type:"tel",id:"phone_number",autoComplete:"tel",placeholder:"Your Phone Number...",className:"mb-4 mt-2 rounded-md border p-2 text-black",value:r,onChange:e=>y(e.target.value),onBlur:e=>j(e.target.value)}),(0,l.jsx)("button",{onClick:b,className:"rounded-lg bg-blue-500 px-3 py-2 text-white transition duration-300 hover:bg-blue-700",disabled:d,children:d?"Sending...":"Send Verification Code"})]}),d&&!g&&(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)("svg",{className:"h-5 w-5 animate-spin text-blue-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.964 7.964 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),m&&!d&&(0,l.jsxs)("div",{className:"flex flex-col items-stretch",children:[(0,l.jsx)("label",{htmlFor:"verification_code",className:"text-sm font-bold text-gray-700",children:"Enter the code sent to your phone:"}),(0,l.jsx)("div",{id:"verification_code",className:"align-center mb-4 mt-2 flex flex-row justify-center p-2 text-lg text-black",children:(0,l.jsx)(eq,{autoFocus:!0,maxLength:6,pattern:eD.K2,value:i,onChange:e=>c(e),children:(0,l.jsxs)(e$,{children:[(0,l.jsx)(eG,{index:0,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:1,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:2,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:3,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:4,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:5,className:"text-xl font-bold"})]})})})]}),g&&!d&&(0,l.jsx)("div",{className:"mt-7 rounded bg-green-200 p-3 text-green-700",children:"Phone number verified successfully!"})]})}):null},eH=e=>{var t;let{block:a,loop:s,onChange:r,replaceableVars:n,disabled:i,streaming:c=!1}=e,[d,u]=(0,o.useState)(!1),[m,p]=(0,o.useState)([]),{supabase:x}=(0,b.a)(),h=async()=>{if(!s)return;let{data:e,error:t}=await x.from("phoneNumbers").select("*").eq("verificationState",!0).eq("userId",s.ownerId);t&&console.error("Error fetching verified phone numbers:",t);let a=[];e&&(a=e.map(e=>null==e?void 0:e.phoneNumber)),p(a)};(0,o.useEffect)(()=>{h()},[]),(0,o.useEffect)(()=>{c||a.to||!(m.length>0)||r({to:m[0]})},[c,a,m,r]);let g=(0,o.useCallback)(async e=>{u(!1),await h(),r({to:e})},[a,r]),f=(0,o.useCallback)(e=>{let t=e.target.value;"add-new"===t?u(!0):r({to:t})},[r,a]);return(0,l.jsxs)("div",{className:"my-4 flex flex-col space-y-2 text-black/80 dark:text-white/80",children:[(0,l.jsx)("p",{className:"mt-2 font-semibold",children:"From:"}),(0,l.jsx)(eh.Z,{className:"mt-1 w-full",disabled:i,value:a.from||V.HL,onChange:e=>{V.Sb.some(t=>t.e164===e.target.value)&&a.from!==e.target.value&&r({from:e.target.value})},children:V.Sb.map(e=>(0,l.jsx)("option",{value:e.e164,className:"bg-[#262f34] text-white/80",children:e.pretty},e.e164))}),(0,l.jsx)(ev.Z,{text:a.from,displayText:"Click here to copy number to clipboard",className:"pointer-events-auto rounded-lg text-xs italic text-black/40 focus:outline-none dark:text-white/40"}),(0,l.jsx)("p",{className:"mt-2 font-semibold",children:"To:"}),m.length>0?(0,l.jsxs)(eh.Z,{className:"mt-1",disabled:i,value:a.to||"",onChange:f,children:[(0,l.jsx)("option",{value:"",disabled:!0,className:"bg-[#262f34] text-white/80",children:"Select a number..."}),m.map(e=>{let t=e;try{t=(0,eU.h)(e).format("E.164")}catch(e){console.error(e)}return(0,l.jsxs)("option",{value:e,className:"bg-[#262f34] text-white/80",children:[t," "]},e)}),(0,l.jsx)("option",{value:"add-new",className:"bg-[#262f34] text-white/80",children:"Add New Number..."})]}):(0,l.jsx)("div",{children:(0,l.jsx)(eT.Z,{onClick:()=>u(!0),className:"mr-2 flex min-w-[10rem] bg-orange-500 text-white hover:text-white enabled:hover:bg-orange-400 disabled:opacity-50",children:"Verify a new number"})}),(0,l.jsx)("p",{className:"mt-2 font-semibold",children:"Body:"}),(0,l.jsx)(ec,{value:null!==(t=a.content)&&void 0!==t?t:"",vars:n,onChange:e=>{a.content!==e&&r({content:e})},disabled:i,placeholder:"Magic Loop Result: $BLOCK_INPUT...",className:"min-h-[100px]"}),(0,l.jsx)(ed.Z,{className:"pt-2 text-xs italic text-black/40 dark:text-white/40",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables in any field"}),(0,l.jsx)(eW,{isOpen:d,handleVerifiedNumber:g,onClose:()=>u(!1)})]})},eY=e=>{let{handleVerifiedNumber:t,isOpen:a,onClose:s}=e,[r,n]=(0,o.useState)(""),[i,c]=(0,o.useState)(""),[d,u]=(0,o.useState)(!1),[m,p]=(0,o.useState)(!1),[x,h]=(0,o.useState)(""),[g,f]=(0,o.useState)(!1),b=async()=>{u(!0),h(""),f(!1);try{let e=await (0,eJ.ei)(r),t=await fetch("/api/whatsapp/startWhatsAppVerification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({whatsappNumber:e})});if(!t.ok){if(401===t.status)throw Error("Please sign up to validate a WhatsApp number.");if(400===t.status)throw Error("This number is not registered with WhatsApp.");throw Error("Error initiating WhatsApp verification.")}p(!0)}catch(e){e instanceof Error?h(e.message):h("An unexpected error occurred")}u(!1)},v=(0,o.useCallback)(async()=>{u(!0),h(""),f(!1);try{if(!(await fetch("/api/whatsapp/verifyWhatsApp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({whatsappNumber:r,verificationCode:i})})).ok)throw Error("Error verifying WhatsApp code. Please try again.");f(!0),N(!1),setTimeout(()=>{t(r),s(),f(!1)},2e3)}catch(e){p(!1),f(!1),c(""),e instanceof Error?h(e.message):h("An unexpected error occurred. Please try again."),setTimeout(()=>{N(!0)},3e3)}u(!1)},[r,i,t,s]);(0,o.useEffect)(()=>{i&&6===i.length&&!d&&v()},[i,v,d]);let y=(0,o.useCallback)(e=>{h(""),f(!1),n(e)},[]),j=(0,o.useCallback)(async e=>{h("");let t=await (0,eJ.ei)(e);t?y(t):h("'".concat(e,"' is an invalid or fake phone number! Format: '+[country code] [number]'"))},[y]),N=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];p(!1),u(!1),h(""),n(""),c(""),e&&f(!1)};return a?(0,l.jsx)("div",{className:"fixed inset-0 z-[500] h-full w-full overflow-y-auto bg-gray-600 bg-opacity-75",children:(0,l.jsxs)("div",{className:"relative top-[35%] mx-auto min-h-[150px] w-96 rounded-md border bg-white px-5 pb-3 pt-8 shadow-lg",children:[(0,l.jsx)("div",{className:"absolute right-0 top-0 m-3 cursor-pointer",onClick:()=>{N(),s()},children:(0,l.jsx)("svg",{className:"fill-current text-black",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 18 18",children:(0,l.jsx)("path",{d:"M18 1.41L16.59 0L9 7.58L1.41 0L0 1.41L7.58 9L0 16.59L1.41 18L9 10.42L16.59 18L18 16.59L10.42 9L18 1.41z"})})}),x&&(0,l.jsx)("div",{className:"my-3 rounded bg-red-200 p-3 text-red-700",children:x}),!m&&!d&&!g&&(0,l.jsxs)("div",{className:"flex flex-col items-stretch",children:[(0,l.jsx)("label",{htmlFor:"whatsapp_number",className:"text-sm font-bold text-gray-700",children:"WhatsApp Number:"}),(0,l.jsx)("input",{type:"tel",id:"whatsapp_number",autoComplete:"tel",placeholder:"Your WhatsApp Number...",className:"mb-4 mt-2 rounded-md border p-2 text-black",value:r,onChange:e=>y(e.target.value),onBlur:e=>j(e.target.value)}),(0,l.jsx)("button",{onClick:b,className:"rounded-lg bg-green-500 px-3 py-2 text-white transition duration-300 hover:bg-green-600",disabled:d,children:d?"Sending...":"Send WhatsApp Code"}),(0,l.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"You will receive a verification code via WhatsApp message"})]}),d&&!g&&(0,l.jsx)("div",{className:"flex justify-center",children:(0,l.jsxs)("svg",{className:"h-5 w-5 animate-spin text-green-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.964 7.964 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),m&&!d&&(0,l.jsxs)("div",{className:"flex flex-col items-stretch",children:[(0,l.jsx)("label",{htmlFor:"verification_code",className:"text-sm font-bold text-gray-700",children:"Enter the code sent to your WhatsApp:"}),(0,l.jsx)("div",{id:"verification_code",className:"align-center mb-4 mt-2 flex flex-row justify-center p-2 text-lg text-black",children:(0,l.jsx)(eq,{autoFocus:!0,maxLength:6,pattern:eD.K2,value:i,onChange:e=>c(e),children:(0,l.jsxs)(e$,{children:[(0,l.jsx)(eG,{index:0,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:1,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:2,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:3,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:4,className:"text-xl font-bold"}),(0,l.jsx)(eG,{index:5,className:"text-xl font-bold"})]})})}),(0,l.jsxs)("p",{className:"text-center text-xs text-gray-500",children:["Didn't receive the code?"," ",(0,l.jsx)("button",{onClick:()=>{p(!1),c("")},className:"text-green-600 hover:text-green-700",children:"Try again"})]})]}),g&&!d&&(0,l.jsx)("div",{className:"mt-7 rounded bg-green-200 p-3 text-green-700",children:"WhatsApp number verified successfully!"})]})}):null},eX=e=>{let{block:t,loop:a,onChange:s,disabled:r}=e,[n,i]=(0,o.useState)(!1),[c,d]=(0,o.useState)([]),{supabase:u}=(0,b.a)(),m=async()=>{if(!a)return;let{data:e,error:l}=await u.from("whatsappNumbers").select("*").eq("verificationState",!0).eq("userId",a.ownerId);if(l){console.error("Error fetching verified WhatsApp numbers:",l);return}let r=(null==e?void 0:e.map(e=>null==e?void 0:e.whatsappNumber))||[];!t.fromNumber&&r.length&&s({fromNumber:r[0]}),d(r)};(0,o.useEffect)(()=>{m()},[]);let p=(0,o.useCallback)(async e=>{i(!1),await m(),s({fromNumber:e})},[t,s]),x=(0,o.useCallback)(e=>{let t=e.target.value;"add-new"===t?i(!0):s({fromNumber:t})},[s,t]);return(0,l.jsxs)("div",{className:"text-black/80 dark:text-white/80",children:[(0,l.jsx)("p",{className:"font-semibold",children:"Trigger this Loop by messaging this WhatsApp number:"}),(0,l.jsx)(eh.Z,{className:"mt-1 w-full",disabled:r,value:t.toNumber||V.mR,onChange:e=>{V.nF.some(t=>t.e164===e.target.value)&&t.toNumber!==e.target.value&&s({toNumber:e.target.value})},children:V.nF.map(e=>(0,l.jsx)("option",{value:e.e164,className:"bg-[#262f34] text-white/80",children:e.pretty},e.e164))}),(0,l.jsx)(ev.Z,{text:t.toNumber,displayText:"Click here to copy number to clipboard",className:"pointer-events-auto rounded-lg pt-2 text-xs italic text-black/40 focus:outline-none dark:text-white/40"}),(0,l.jsx)("p",{className:"mt-2 font-semibold",children:"From:"}),c.length>0?(0,l.jsxs)(eh.Z,{className:"mt-1 w-full",disabled:r,value:t.fromNumber||"",onChange:x,children:[(0,l.jsx)("option",{value:"",disabled:!0,className:"bg-[#262f34] text-white/80",children:"Select a WhatsApp number..."}),c.map(e=>{let t=(0,eU.h)(e);return(0,l.jsxs)("option",{value:e,className:"bg-[#262f34] text-white/80",children:[t.format("E.164")," "]},e)}),(0,l.jsx)("option",{value:"add-new",className:"bg-[#262f34] text-white/80",children:"Add New WhatsApp Number..."})]}):(0,l.jsx)("div",{children:(0,l.jsx)(eT.Z,{onClick:()=>i(!0),className:"m-2 mr-2 flex min-w-[8rem] bg-orange-500 px-3 py-2 font-bold text-white enabled:hover:bg-orange-400 disabled:opacity-50",children:"Add a WhatsApp number"})}),(0,l.jsx)("p",{className:"bg-transparent pt-2 text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:"WhatsApp message contents will be used as the Loop input"}),(0,l.jsx)(eY,{isOpen:n,handleVerifiedNumber:p,onClose:()=>i(!1)})]})},eQ=e=>{var t;let{block:a,loop:s,onChange:r,replaceableVars:n,disabled:i,streaming:c=!1}=e,[d,u]=(0,o.useState)(null),[m,p]=(0,o.useState)(!1),[x,h]=(0,o.useState)([]),{supabase:g}=(0,b.a)(),f=async()=>{if(!s)return;let{data:e,error:t}=await g.from("whatsappNumbers").select("*").eq("verificationState",!0).eq("userId",s.ownerId);if(t){console.error("Error fetching verified WhatsApp numbers:",t);return}h((null==e?void 0:e.map(e=>e.whatsappNumber))||[])};(0,o.useEffect)(()=>{f()},[]),(0,o.useEffect)(()=>{c||a.to||!(x.length>0)||r({to:x[0]})},[c,a,x,r]);let v=(0,o.useCallback)(async e=>{p(!1),await f(),r({to:e})},[a,r]),y=(0,o.useCallback)(e=>{let t=e.target.value;"add-new"===t?p(!0):r({to:t})},[r,a]);return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 py-2 text-black/80 dark:text-white/80",children:[(0,l.jsx)("p",{className:"mt-2 font-semibold",children:"From:"}),(0,l.jsx)(eh.Z,{className:"mt-1 w-full",disabled:i,value:a.from||V.mR,onChange:e=>{V.nF.some(t=>t.e164===e.target.value)&&a.from!==e.target.value&&r({from:e.target.value})},children:V.nF.map(e=>(0,l.jsx)("option",{value:e.e164,className:"bg-[#262f34] text-white/80",children:e.pretty},e.e164))}),(0,l.jsx)(ev.Z,{text:a.from,displayText:"Click here to copy number to clipboard",className:"pointer-events-auto rounded-lg text-xs italic text-black/40 focus:outline-none dark:text-white/40"}),(0,l.jsx)("p",{className:"mt-2 font-semibold",children:"To:"}),x.length>0?(0,l.jsxs)(eh.Z,{className:"mt-1 w-full",disabled:i,value:a.to||"",onChange:y,children:[(0,l.jsx)("option",{value:"",disabled:!0,className:"bg-[#262f34] text-white/80",children:"Select a WhatsApp number..."}),x.map(e=>{let t=e;try{t=(0,eU.h)(e).format("E.164")}catch(e){console.error(e)}return(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:t},e)}),(0,l.jsx)("option",{value:"add-new",className:"bg-[#262f34] text-white/80",children:"Add New WhatsApp Number..."})]}):(0,l.jsx)("div",{children:(0,l.jsx)(eT.Z,{onClick:()=>p(!0),className:"mr-2 flex min-w-[8rem] bg-orange-500 font-bold text-white enabled:hover:bg-orange-400 disabled:opacity-50",children:"Verify WhatsApp Number"})}),(0,l.jsx)("p",{className:"mt-2 font-semibold",children:"Body:"}),(0,l.jsx)(ec,{value:null!==(t=a.content)&&void 0!==t?t:"",vars:n,onChange:e=>{a.content!==e&&r({content:e})},disabled:i,placeholder:"Magic Loop Result: $BLOCK_INPUT...",className:"min-h-[100px]"}),(0,l.jsx)("label",{className:"text-xs italic text-black/40 dark:text-white/40",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables in any field"}),d&&(0,l.jsx)("p",{className:"px-1 text-xs text-red-600",children:d}),(0,l.jsx)(eY,{isOpen:m,onClose:()=>p(!1),handleVerifiedNumber:v})]})},e0=a(78301),e1=e=>{var t,a;let{block:s,onChange:r,disabled:n,replaceableVars:i}=e,o="fast"===s.mode?ex.c_.filter(e=>"html"===e||"markdown"===e):ex.c_;return(0,l.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,l.jsx)(ed.Z,{className:"mt-4 font-semibold italic",children:"Website:"}),(0,l.jsx)(ec,{value:null!==(t=s.url)&&void 0!==t?t:"",vars:i,onChange:e=>{if(s.url===e)return;let t=e.trim();!t||t.startsWith("http")||t.startsWith("$")||(t="https://".concat(e)),r({url:t})},disabled:n,singleLine:!0,placeholder:"https://news.ycombinator.com...",className:"w-full"}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Mode:"}),(0,l.jsx)(eh.Z,{className:"w-full",disabled:n,value:null!==(a=s.mode)&&void 0!==a?a:ex.Am[0],onChange:e=>{ex.Am.includes(e.target.value)&&s.mode!==e.target.value&&r({mode:e.target.value})},children:ex.Am.map(e=>(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:(0,e0.fm)(e)},e))}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Format:"}),(0,l.jsx)(eh.Z,{className:"w-full",disabled:n,value:s.format,onChange:e=>{o.includes(e.target.value)&&s.format!==e.target.value&&r({format:e.target.value})},children:o.map(e=>(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:(0,e0.fm)(e)},e))}),"fast"!==s.mode&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"HTML Transformer:"}),(0,l.jsx)(eh.Z,{className:"w-full",disabled:n,value:s.htmlTransformer,onChange:e=>{ex.GK.includes(e.target.value)&&s.htmlTransformer!==e.target.value&&r({htmlTransformer:e.target.value})},children:ex.GK.map(e=>(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:(0,e0.fm)((0,e0.Jh)(e))},e))})]}),"fast"!==s.mode&&(0,l.jsxs)("div",{className:"ml-1 flex flex-row items-center space-x-1",children:[(0,l.jsx)(ew.Z,{checked:!!s.retryCount,disabled:n,alt:"Retry?",onChange:e=>{!!s.retryCount!==e.target.checked&&r({retryCount:e.target.checked?1:0})}}),(0,l.jsx)(ed.Z,{className:"text-sm text-black/40 dark:text-white/40",children:"Retry on fail?"}),(0,l.jsx)(ef.Z,{color:"light",content:"This will retry the request if it times out"})]}),(0,l.jsx)(ed.Z,{className:"text-xs italic",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables part of or as the whole URL"}),(0,l.jsx)(ed.Z,{className:"text-xs italic",children:"advanced"===s.mode?"This block typically takes ~20-50s to run (timeout after 3 min)":"fast"===s.mode?"This block typically takes ~5-20s to run (timeout after 1 min)":"This block typically takes ~10-30s to run (timeout after 90s)"})]})},e2=e=>{let{block:t,loop:a,onChange:s,disabled:r}=e,[n,i]=(0,o.useState)(!1),[c,d]=(0,o.useState)([]),{supabase:u}=(0,b.a)(),m=async()=>{if(!a)return;let{data:e,error:l}=await u.from("phoneNumbers").select("*").eq("verificationState",!0).eq("userId",a.ownerId);if(l){console.error("Error fetching verified phone numbers:",l);return}let r=e.map(e=>null==e?void 0:e.phoneNumber);!t.fromNumber&&r.length&&s({fromNumber:r[0]}),d(r)};(0,o.useEffect)(()=>{m()},[]);let p=(0,o.useCallback)(async e=>{i(!1),await m(),s({fromNumber:e})},[t,s]),x=(0,o.useCallback)(e=>{let t=e.target.value;"add-new"===t?i(!0):s({fromNumber:t})},[s,t]);return(0,l.jsxs)("div",{className:"text-black/80 dark:text-white/80",children:[(0,l.jsxs)("p",{className:"font-semibold italic",children:["To:",(0,l.jsx)("span",{className:"text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:" (trigger this Loop by texting this number:)"})]}),(0,l.jsx)(eh.Z,{className:"mb-2 mt-1 w-full text-base",disabled:r,value:t.toNumber||V.HL,onChange:e=>{V.Sb.some(t=>t.e164===e.target.value)&&t.toNumber!==e.target.value&&s({toNumber:e.target.value})},children:V.Sb.map(e=>(0,l.jsx)("option",{value:e.e164,className:"bg-[#262f34] text-black/80 dark:text-white/80",children:e.pretty},e.e164))}),(0,l.jsx)(ev.Z,{text:t.toNumber,displayText:"Click here to copy number to clipboard",className:"pointer-events-auto rounded-lg text-xs italic text-black/40 focus:outline-none dark:text-white/40"}),(0,l.jsx)("p",{className:"mt-2 font-semibold italic",children:"From:"}),c.length>0?(0,l.jsxs)(eh.Z,{className:"mb-2 mt-1 w-full text-base",disabled:r,value:t.fromNumber||"",onChange:x,children:[(0,l.jsx)("option",{value:"",disabled:!0,className:"bg-[#262f34] text-black/80 dark:text-white/80",children:"Select a number..."}),c.map(e=>{let t=(0,eU.h)(e);return(0,l.jsxs)("option",{value:e,className:"bg-[#262f34] text-black/80 dark:text-white/80",children:[t.format("E.164")," "]},e)}),(0,l.jsx)("option",{value:"add-new",className:"text-dark/80 bg-[#262f34] dark:text-white/80",children:"Add New Number..."})]}):(0,l.jsx)("div",{children:(0,l.jsx)("button",{onClick:()=>i(!0),className:"m-2 mr-2 flex min-w-[8rem] items-center justify-center rounded-lg bg-orange-500 px-3 py-2 font-bold text-black enabled:hover:border-white/20 enabled:hover:bg-orange-400 disabled:opacity-50 dark:text-white",children:"Add a phone number"})}),(0,l.jsx)("p",{className:"rounded-lg bg-transparent text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:"Text message contents will be used as the Loop input"}),(0,l.jsx)(eW,{isOpen:n,handleVerifiedNumber:p,onClose:()=>i(!1)})]})},e4=a(30836);function e5(){return/Mobi|Android/i.test(window.navigator.userAgent)}var e3=e=>{let{block:t,readOnly:a,disabled:s,streaming:r}=e,[n,i]=(0,o.useState)("idle"),[c,d]=(0,o.useState)(void 0),[u,m]=(0,o.useState)(e5()?1:3),[p,x]=(0,o.useState)([]);(0,o.useEffect)(()=>{i("idle")},[t.id]),(0,o.useEffect)(()=>{if(r)return;let e=(0,e4.Uy)(u,t);d(e.length>0?void 0:'Unable to parse your description (try something like "7pm daily")'),x(e)},[r,t,u]);let h=e5()?2:3;return(0,l.jsx)("div",{className:"flex flex-col justify-between pt-4 sm:flex-row ".concat("loading"===n?"text-black/10 dark:text-white/10":"text-black/40 dark:text-white/40"),children:c?(0,l.jsx)("p",{className:"text-s rounded-lg bg-transparent px-1.5 italic text-red-500 focus:outline-none",children:c}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"min-h-[100px]",children:[(0,l.jsx)("p",{className:"text-s rounded-lg bg-transparent px-1.5 italic underline focus:outline-none",children:"Loop scheduled to run at:"}),p.map((e,t)=>(0,l.jsx)("p",{className:"text-s rounded-lg bg-transparent px-1.5 pl-3 italic focus:outline-none",children:"* ".concat(e)},t)),(0,l.jsx)("p",{className:"text-s cursor-pointer rounded-lg bg-transparent px-1.5 pl-3 italic focus:outline-none",onClick:()=>{m(e=>e+h)},children:"...click to see more"})]}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsxs)("div",{className:"text-s flex flex-row space-x-2 px-1.5 pb-0 italic focus:outline-none",children:[(0,l.jsx)("span",{className:"underline",children:"Timezone:"}),(0,l.jsx)("span",{children:t.timezone})]}),(0,l.jsxs)("div",{className:"text-s flex flex-row space-x-2 px-1.5 pb-0 italic focus:outline-none",children:[(0,l.jsx)("span",{className:"underline",children:"Cron:"}),(0,l.jsx)("span",{children:t.cron}),!a&&(0,l.jsx)(ef.Z,{color:"light",className:"mt-1",content:"Under the hood we convert '".concat(t.description,"' into something called a cron string [1] and we use that for scheduling your Loop. We're showing it here in case you're curious!\n\n[1] A cron string describes when a task should run using the following 5 space-separated fields:\n1. Minute (0-59)\n2. Hour (0-23)\n3. Day of the month (1-31)\n4. Month (1-12)\n5. Day of the week (0-6, 0=Sunday)\n\nFor example: '15 8 * * 1' means 'at 8:15 AM, every Monday'")})]})]})]})})},e8=e=>{var t,a;let{block:s,onChange:r,disabled:n}=e,i=(0,o.useCallback)(e=>{let t=e.replace("$","").replaceAll(" ","_").toUpperCase();t!==s.key&&r({key:t})},[s,r]);return(0,l.jsxs)("div",{className:"my-4 flex flex-col space-y-2",children:[(0,l.jsxs)("div",{className:"flex flex-row items-center",children:[(0,l.jsx)("p",{className:"rounded-lg bg-transparent pr-1 font-semibold text-black/80 focus:outline-none dark:text-white/80",children:"Update one of the Loop's Variables"}),(0,l.jsx)(ef.Z,{color:"light",content:"Use this block to update the Loop Variables. The variable must already exist; if it doesn't, create a new Variable at the top of the Loop."})]}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Name:"}),(0,l.jsx)(eC.Z,{type:"text",className:"w-full",value:null!==(t=s.key)&&void 0!==t?t:"",disabled:n,placeholder:"USER_PHONE_NUMBER...",onBlur:e=>{i(e.target.value)},onChange:e=>{i(e.target.value)}}),(0,l.jsx)(ed.Z,{className:"mt-2 font-semibold italic",children:"Value:"}),(0,l.jsx)(eC.Z,{type:"text",className:"w-full",value:null!==(a=s.newVal)&&void 0!==a?a:"",disabled:n,placeholder:"+1 555 555 5555...",onBlur:e=>{e.target.value!==s.newVal&&r({newVal:e.target.value})},onChange:e=>{e.target.value!==s.newVal&&r({newVal:e.target.value})}})]})},e6=e=>{let{tabs:t,activeTab:a,onTabChange:s}=e;return(0,l.jsx)("div",{className:"flex items-center space-x-1",children:t.map(e=>(0,l.jsx)("button",{className:(0,en.cn)("rounded-none border-2 border-black px-3 py-1.5 text-sm font-medium transition-all",a===e.id?"bg-blue-500 text-white shadow-[2px_2px_0_0_rgba(0,0,0,1)]":"bg-slate-300 text-black shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:translate-x-[1px] hover:translate-y-[1px] hover:bg-slate-200 hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)]","dark:border-white/80",a===e.id?"dark:bg-blue-600 dark:text-white":"dark:bg-gray-700 dark:text-white/80 dark:hover:bg-gray-600"),onClick:()=>s(e.id),children:e.label},e.id))})},e7=a(2586);let e9=["string","number","boolean","select","multiselect","textarea"],te={string:"String",number:"Number",boolean:"Boolean",select:"Select",multiselect:"Multi-select",textarea:"Textarea"};var tt=e=>{let{schema:t,onChange:a,disabled:s}=e,r=()=>Object.entries(t.fields||{}).map(e=>{let[t,a]=e;return{key:t,...a}}),n=e=>{let t={};return e.forEach(e=>{e.key&&(t[e.key]={type:e.type||"string",label:e.label||e.key,description:e.description||"",required:!!e.required,default:e.default,validation:e.validation||{}})}),{fields:t}},i=(0,o.useCallback)((e,t,l)=>{let s=r();if("key"===t){if(l=(0,e0.s9)(l),s[e].key===l)return;let t=[...s];t[e]={...s[e],key:l},a(n(t))}else{let r=[...s];r[e]={...s[e],[t]:l},a(n(r))}},[t,a]),c=e=>{switch(e){case"string":case"textarea":return{maxLength:1e3};case"number":return{min:0,max:100};case"select":case"multiselect":return{options:["option1","option2","option3"]};default:return{}}},d=(0,o.useCallback)(()=>{let e=r(),t={key:"field_".concat(e.length+1),type:"string",label:"Field ".concat(e.length+1),description:"",required:!1,validation:{maxLength:1e3}};a(n([...e,t]))},[t,a]),u=(0,o.useCallback)(e=>{a(n(r().filter((t,a)=>a!==e)))},[t,a]),m=r();return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 py-4",children:[(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"Define the input fields your block expects"}),(0,l.jsxs)("div",{className:"flex w-full flex-col space-y-2",children:[(0,l.jsxs)("div",{className:"grid grid-cols-5 gap-2 border-b border-gray-200 pb-2 text-xs font-medium text-gray-700 dark:border-gray-700 dark:text-gray-300",children:[(0,l.jsx)("div",{children:"Key"}),(0,l.jsx)("div",{children:"Label"}),(0,l.jsx)("div",{children:"Type"}),(0,l.jsx)("div",{className:"text-center",children:"Required"}),(0,l.jsx)("div",{className:"text-center",children:"Actions"})]}),m.length>0&&(0,l.jsx)("div",{className:"space-y-1",children:m.map((e,t)=>(0,l.jsxs)("div",{className:"grid grid-cols-5 items-center gap-2 rounded border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-800/50",children:[(0,l.jsx)("div",{className:"flex flex-col space-y-1",children:(0,l.jsx)(eC.Z,{type:"text",className:"h-[34px] w-full border border-gray-300 bg-white px-2 text-sm focus:border-blue-500 focus:outline-none disabled:opacity-50 dark:border-gray-600 dark:bg-[#2a2a2a] dark:text-gray-200",value:e.key||"",placeholder:"field_name",disabled:s,onChange:e=>{i(t,"key",e.target.value)}})}),(0,l.jsx)("div",{className:"flex flex-col space-y-1",children:(0,l.jsx)(eC.Z,{type:"text",className:"h-[34px] w-full border border-gray-300 bg-white px-2 text-sm focus:border-blue-500 focus:outline-none disabled:opacity-50 dark:border-gray-600 dark:bg-[#2a2a2a] dark:text-gray-200",value:e.label||"",placeholder:"Display Name",disabled:s,onChange:e=>{i(t,"label",e.target.value)}})}),(0,l.jsx)("div",{className:"flex flex-col space-y-1",children:(0,l.jsx)(eh.Z,{className:"h-[34px] w-full border border-gray-300 bg-white text-sm focus:border-blue-500 focus:outline-none dark:border-gray-600 dark:bg-[#2a2a2a] dark:text-gray-200",disabled:s,value:e.type||"string",onChange:l=>{let s=l.target.value;if(e.type===s)return;i(t,"type",s);let o=c(s),d=[...r()];d[t]={...e,type:s,validation:o},a(n(d))},children:e9.map(e=>(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:te[e]},e))})}),(0,l.jsx)("div",{className:"flex items-center justify-center",children:(0,l.jsx)(ew.Z,{checked:!!e.required,disabled:s,alt:"Required field",onChange:e=>{i(t,"required",e.target.checked)}})}),(0,l.jsx)("div",{className:"flex items-center justify-center",children:!s&&(0,l.jsx)("button",{className:"rounded-md p-2 text-red-500 transition-colors hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20",onClick:()=>u(t),title:"Remove field",children:(0,l.jsx)(h.Z,{size:16})})})]},t))}),!s&&(0,l.jsxs)(eT.Z,{onClick:d,className:"mt-2",type:"button",children:[(0,l.jsx)(e7.Z,{size:16,className:"mr-1"})," Add Field"]}),0===m.length&&(0,l.jsx)(ed.Z,{className:"w-full p-2 text-center text-xs italic text-black/40 dark:text-white/40",children:"No input fields defined yet"})]})]})},ta=e=>{let{config:t,onChange:a,disabled:s}=e,r=(0,o.useCallback)(()=>Object.entries(t.variables||{}).map(e=>{let[t,a]=e;return{key:t,...a}}),[t.variables]),n=e=>{let t={};return e.forEach(e=>{e.key&&(t[e.key]={value:e.value||"",label:e.label||e.key,description:e.description||"",required:!!e.required,public:!!e.public})}),{variables:t}},i=(0,o.useCallback)((e,t,l)=>{let s=r();if("key"===t){if(l=(0,e0.Dk)(l),s[e].key===l)return;let t=[...s];t[e]={...s[e],key:l},a(n(t))}else{let r=[...s];r[e]={...s[e],[t]:l},a(n(r))}},[a,r]),c=(0,o.useCallback)(()=>{let e=r(),t={key:"VAR_".concat(e.length+1),value:"",label:"Variable ".concat(e.length+1),description:"",required:!1,public:!0};a(n([...e,t]))},[a,r]),d=(0,o.useCallback)(e=>{a(n(r().filter((t,a)=>a!==e)))},[a,r]),u=r();return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 py-4",children:[(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"Configure environment variables, API keys, and packages"}),(0,l.jsxs)("div",{className:"flex w-full flex-col space-y-2",children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 gap-2 border-b border-gray-200 pb-2 text-xs font-medium text-gray-700 dark:border-gray-700 dark:text-gray-300",children:[(0,l.jsx)("div",{children:"Key"}),(0,l.jsx)("div",{children:"Label"}),(0,l.jsx)("div",{children:"Value"}),(0,l.jsx)("div",{className:"text-center",children:"Req/Pub"})]}),u.length>0&&(0,l.jsx)("div",{className:"w-full",children:u.map((e,t)=>(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsxs)("div",{className:"grid grid-cols-4 items-center gap-2 rounded border border-gray-200 bg-gray-50 p-3 dark:border-gray-700 dark:bg-gray-800/50",children:[(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)(eC.Z,{type:"text",className:"h-[34px] w-full border border-gray-300 bg-white px-2 text-sm focus:border-blue-500 focus:outline-none disabled:opacity-50 dark:border-gray-600 dark:bg-[#2a2a2a] dark:text-gray-200",value:e.key||"",placeholder:"VARIABLE_NAME",disabled:s,onChange:e=>{i(t,"key",e.target.value)}}),(0,l.jsx)("div",{className:"h-4"})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)(eC.Z,{type:"text",className:"h-[34px] w-full border border-gray-300 bg-white px-2 text-sm focus:border-blue-500 focus:outline-none disabled:opacity-50 dark:border-gray-600 dark:bg-[#2a2a2a] dark:text-gray-200",value:e.label||"",placeholder:"Display Name",disabled:s,onChange:e=>{i(t,"label",e.target.value)}}),(0,l.jsx)("div",{className:"h-4"})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsx)(eC.Z,{type:e.public?"text":"password",className:"h-[34px] w-full border border-gray-300 bg-white px-2 text-sm focus:border-blue-500 focus:outline-none disabled:opacity-50 dark:border-gray-600 dark:bg-[#2a2a2a] dark:text-gray-200",value:e.value||"",placeholder:e.public?"Default value":"••••••••••",disabled:s,onChange:e=>{i(t,"value",e.target.value)}}),(0,l.jsx)("div",{className:"flex h-4 items-center",children:!e.public&&(0,l.jsx)("div",{className:"text-xs text-red-600 dark:text-red-400",children:"Private"})})]}),(0,l.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,l.jsxs)("div",{className:"relative flex h-[34px] items-start justify-center space-x-4 pt-1",children:[(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)(ew.Z,{checked:!!e.required,disabled:s,alt:"Required",onChange:e=>{i(t,"required",e.target.checked)}}),(0,l.jsx)("span",{className:"mt-1 text-xs text-gray-500",children:"Req"})]}),(0,l.jsxs)("div",{className:"flex flex-col items-center",children:[(0,l.jsx)(ew.Z,{checked:!!e.public,disabled:s,alt:"Public",onChange:e=>{i(t,"public",e.target.checked)}}),(0,l.jsx)("span",{className:"mt-1 text-xs text-gray-500",children:"Pub"})]}),!s&&(0,l.jsx)("button",{className:"absolute right-0 top-0 rounded-md p-2 text-red-500 transition-colors hover:bg-red-50 dark:text-red-400 dark:hover:bg-red-900/20",onClick:()=>d(t),title:"Remove variable",children:(0,l.jsx)(h.Z,{size:16})})]}),(0,l.jsx)("div",{className:"h-4"})]})]}),e.description&&(0,l.jsx)("div",{className:"mt-1 pl-2 text-xs text-gray-500 dark:text-gray-400",children:e.description})]},t))}),0===u.length&&!s&&(0,l.jsx)(ed.Z,{className:"w-full p-2 text-center text-xs italic text-black/40 dark:text-white/40",children:"No configuration variables defined yet"}),!s&&(0,l.jsxs)(eT.Z,{onClick:c,className:"mt-2",type:"button",children:[(0,l.jsx)(e7.Z,{size:16,className:"mr-1"})," Add Variable"]})]}),(0,l.jsxs)(ed.Z,{className:"mt-2 font-semibold italic",children:["Package Management"," ",(0,l.jsx)("span",{className:"font-normal text-orange-600 dark:text-orange-400",children:"(Coming Soon)"})]}),(0,l.jsxs)("div",{className:"space-y-1 text-xs text-black/40 dark:text-white/40",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Current JavaScript packages:"})," axios, lodash, jest"]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("strong",{children:"Current Python packages:"})," requests, standard library"]}),(0,l.jsx)("div",{className:"text-orange-600 dark:text-orange-400",children:(0,l.jsx)("em",{children:"Custom package installation will be available soon"})})]}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"Mark sensitive variables (API keys, passwords) as private for security"})]})},tl=e=>{let{schema:t,block:a,onInputValuesChange:s}=e,[r,n]=(0,o.useState)({}),i=(0,o.useRef)(!0),c=(0,o.useRef)(t),d=(0,o.useRef)(!1),u=(0,o.useCallback)((e,t)=>{if((null==a?void 0:a.exampleInputValues)&&void 0!==a.exampleInputValues[t])return a.exampleInputValues[t];if(void 0!==e.default)return e.default;switch(e.type){case"string":case"textarea":default:return"";case"number":return 0;case"boolean":return!1;case"select":var l,s;return(null===(s=e.validation)||void 0===s?void 0:null===(l=s.options)||void 0===l?void 0:l[0])||"";case"multiselect":return[]}},[null==a?void 0:a.exampleInputValues]);(0,o.useEffect)(()=>{var e;let a=Object.keys((null==t?void 0:t.fields)||{}).sort().join(","),l=Object.keys((null===(e=c.current)||void 0===e?void 0:e.fields)||{}).sort().join(",");if(i.current||a!==l){let e={};Object.entries((null==t?void 0:t.fields)||{}).forEach(t=>{let[a,l]=t;e[a]=u(l,a)}),n(e),s&&s(e),c.current=t,i.current&&(i.current=!1)}},[t,s,u,null==a?void 0:a.exampleInputValues]),(0,o.useEffect)(()=>{if(!d.current&&(null==a?void 0:a.exampleInputValues)&&Object.keys(a.exampleInputValues).length>0){let e=Object.keys((null==t?void 0:t.fields)||{});if(e.some(e=>{var t;let l=null===(t=a.exampleInputValues)||void 0===t?void 0:t[e],s=r[e];return void 0!==l&&l!==s})){let t={...r};e.forEach(e=>{var l;let s=null===(l=a.exampleInputValues)||void 0===l?void 0:l[e];void 0!==s&&(t[e]=s)}),n(t),s&&s(t)}}},[null==a?void 0:a.exampleInputValues,null==t?void 0:t.fields,s]);let m=(e,t)=>{d.current=!0;let a={...r};a[e]=t,n(a),s&&s(a)},p=(e,t)=>{var a,s,n,i,o,c,d,u;let p="preview-".concat(e),x=r[e],h=t=>{m(e,t)};switch(t.type){case"string":return(0,l.jsx)(eC.Z,{id:p,type:"text",value:void 0!==x?x:"",placeholder:"Enter ".concat(t.label),className:"w-full",onChange:e=>h(e.target.value),maxLength:null===(a=t.validation)||void 0===a?void 0:a.maxLength});case"number":return(0,l.jsx)(eC.Z,{id:p,type:"number",value:void 0!==x?x:0,placeholder:"Enter ".concat(t.label),className:"w-full",onChange:e=>{h(""===e.target.value?"":Number(e.target.value))},min:null===(s=t.validation)||void 0===s?void 0:s.min,max:null===(n=t.validation)||void 0===n?void 0:n.max});case"boolean":return(0,l.jsx)(ew.Z,{id:p,checked:!!x,onChange:e=>h(e.target.checked)});case"select":return(0,l.jsx)(eh.Z,{id:p,value:void 0!==x?x:"",className:"w-full",onChange:e=>h(e.target.value),children:(null===(o=t.validation)||void 0===o?void 0:null===(i=o.options)||void 0===i?void 0:i.map(e=>(0,l.jsx)("option",{value:e,children:e},e)))||(0,l.jsx)("option",{value:"",children:"No options available"})});case"multiselect":return(0,l.jsx)("div",{className:"rounded-lg",children:(null===(d=t.validation)||void 0===d?void 0:null===(c=d.options)||void 0===c?void 0:c.map(e=>{let t=!!Array.isArray(x)&&x.includes(e);return(0,l.jsxs)("div",{className:"mb-1 flex items-center",children:[(0,l.jsx)(ew.Z,{id:"".concat(p,"-").concat(e),checked:t,onChange:t=>{let a=Array.isArray(x)?[...x]:[];h(t.target.checked?a.includes(e)?a:[...a,e]:a.filter(t=>t!==e))}}),(0,l.jsx)("label",{htmlFor:"".concat(p,"-").concat(e),className:"ml-2 text-sm dark:text-gray-300",children:e})]},e)}))||(0,l.jsx)("div",{className:"text-sm italic",children:"No options available"})});case"textarea":return(0,l.jsx)("textarea",{id:p,value:void 0!==x?x:"",placeholder:"Enter ".concat(t.label),className:"w-full rounded-md border-2 border-black bg-white/50 px-3 py-2 focus:outline-none disabled:opacity-50 dark:bg-[#2a2a2a] dark:text-gray-200",onChange:e=>h(e.target.value),maxLength:null===(u=t.validation)||void 0===u?void 0:u.maxLength,rows:4});default:return(0,l.jsxs)("div",{className:"text-sm italic text-red-600",children:["Unknown field type: ",t.type]})}},x=Object.entries((null==t?void 0:t.fields)||{});return 0===x.length?(0,l.jsxs)("div",{className:"rounded-md border-2 border-gray-300 bg-gray-50 p-8 text-center text-gray-500 dark:border-gray-700 dark:bg-gray-900 dark:text-gray-400",children:[(0,l.jsx)("p",{className:"text-lg",children:"No input fields defined"}),(0,l.jsx)("p",{className:"mt-2 text-sm",children:"Go to the Input Schema tab to define fields for your block."})]}):(0,l.jsx)("div",{className:"space-y-6",children:(0,l.jsx)("div",{className:"my-4 space-y-4",children:x.map(e=>{let[t,a]=e;return(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("label",{htmlFor:"preview-".concat(t),className:"flex items-center text-sm font-medium text-gray-900 dark:text-gray-200",children:[a.label||t,a.required&&(0,l.jsx)("span",{className:"ml-1 text-red-500",children:"*"})]}),p(t,a)]},t)})})})};let ts={id:"fibonacci-calculator-example",type:"user-block",outputName:"FIBONACCI_BLOCK_OUTPUT",description:"Calculates the Fibonacci sequence",language:"javascript",code:'// Parse inputs from schema\nconsole.log("Block Input:", BLOCK_INPUT)\nconsole.log("Inputs", INPUTS)\nconsole.log("Config", CONFIG)\nconst inputs = JSON.parse(INPUTS);\nconst config = JSON.parse(CONFIG);\n\n// Get the number of Fibonacci terms to calculate\nconst numberOfTerms = parseInt(inputs.number) || 10;\n\n// Limit to a reasonable range\nconst terms = Math.min(Math.max(numberOfTerms, 1), 100);\n\n// Function to calculate Fibonacci sequence\nfunction calculateFibonacciSequence(n) {\n  const sequence = [0, 1];\n  \n  if (n <= 0) return [];\n  if (n === 1) return [0];\n  \n  for (let i = 2; i < n; i++) {\n    const nextValue = sequence[i-1] + sequence[i-2];\n    sequence.push(nextValue);\n  }\n  \n  return sequence;\n}\n\n// Calculate the Fibonacci sequence\nconst fibonacciSequence = calculateFibonacciSequence(terms);\n\n// Prepare the result\nconst result = {\n  sequence: fibonacciSequence,\n  count: fibonacciSequence.length,\n  input: terms,\n  timestamp: new Date().toISOString(),\n};\n\n// Log API key status for demonstration\nif (config.API_KEY && config.API_KEY.trim() !== \'\') {\n  console.log("API Key provided:", config.API_KEY.substring(0, 3) + "..." + config.API_KEY.substring(config.API_KEY.length - 3));\n  result.api_key_provided = true;\n} else {\n  console.log("No API Key provided");\n  result.api_key_provided = false;\n}\n\n// Output the result as JSON\nconsole.log(JSON.stringify(result, null, 2));',inputSchema:{fields:{number:{type:"number",label:"Number of Terms",description:"Enter how many Fibonacci numbers to calculate",required:!0,validation:{min:1,max:100},default:10}}},config:{variables:{API_KEY:{value:"",label:"API Key",description:"Secret API key (for demonstration purposes only)",required:!1,public:!1}}},version:"1.0.0",author:"Magic Loops",tags:["math","sequence","calculator"]},tr={id:"dalle-generator-example",type:"user-block",outputName:"DALLE_BLOCK_OUTPUT",description:"Generates images using DALL-E",language:"javascript",code:"// Parse inputs from schema\nconst axios = require('axios');\n\nconst inputs = JSON.parse(INPUTS);\nconst config = JSON.parse(CONFIG);\n\n// Validate required configuration\nif (!config.API_KEY) {\n  throw new Error(\"OpenAI API Key is required\");\n}\n\n// Handle model-specific limitations\nconst isDallE3 = inputs.model === 'dall-e-3';\nconst requestedImages = parseInt(inputs.numberOfImages) || 1;\nconst actualImages = isDallE3 ? 1 : requestedImages;\n\nif (isDallE3 && requestedImages > 1) {\n  console.log(\"⚠️ Note: DALL-E 3 only supports generating 1 image at a time. Generating 1 image instead of \" + requestedImages);\n}\n\n// Calculate costs based on size and model\nconst getCostPerImage = (size, model) => {\n  if (model === 'dall-e-3') {\n    return size === '1024x1024' ? 0.040 : 0.080;\n  }\n  switch (size) {\n    case '256x256': return 0.016;\n    case '512x512': return 0.018;\n    case '1024x1024': return 0.020;\n    default: return 0.020;\n  }\n};\n\nconst costPerImage = getCostPerImage(inputs.imageSize, inputs.model);\nconst estimatedCost = costPerImage * actualImages;\n\n// Prepare the API request\nconst requestData = {\n  prompt: inputs.prompt,\n  n: actualImages,\n  size: inputs.imageSize,\n  model: inputs.model,\n};\n\nconsole.log(\"### Generating Images\");\nconsole.log(`- **Prompt**: \\`${requestData.prompt}\\``);\nconsole.log(`- **Model**: ${inputs.model}`);\nconsole.log(`- **Number of Images**: ${actualImages}${isDallE3 && requestedImages > 1 ? ' (limited by DALL-E 3)' : ''}`);\nconsole.log(`- **Size**: ${requestData.size}`);\nconsole.log(`- **Cost per Image**: $${costPerImage.toFixed(3)}`);\nconsole.log(`- **Total Estimated Cost**: $${estimatedCost.toFixed(3)}`);\n\ntry {\n  const response = await axios({\n    method: 'post',\n    url: config.API_URL,\n    headers: {\n      'Content-Type': 'application/json',\n      'Authorization': `Bearer ${config.API_KEY}`,\n    },\n    data: requestData,\n  });\n\n  const images = response.data.data;\n\n  console.log(\"\\n### ✅ Image Generation Successful\");\n  console.log(`**Prompt**: \\`${inputs.prompt}\\``);\n  console.log(`**Model**: ${inputs.model}`);\n  console.log(`**Timestamp**: ${new Date().toISOString()}`);\n  console.log(`**Total Cost**: $${estimatedCost.toFixed(3)}`);\n  console.log(`**Generated Images (${images.length})**:`);\n\n  images.forEach((img, index) => {\n    console.log(\"\\n**Image \" + (index + 1) + \"**:\");\n    console.log(\"![Generated Image \" + (index + 1) + \"](\" + img.url + \")\");\n  });\n\n} catch (error) {\n  const errorMessage = error.response?.data?.error?.message || error.message;\n\n  console.log(\"\\n### ❌ Error Generating Images\");\n  console.log(`**Prompt**: \\`${inputs.prompt}\\``);\n  console.log(`**Model**: ${inputs.model}`);\n  console.log(`**Error**: \\`${errorMessage}\\``);\n  console.log(`**Timestamp**: ${new Date().toISOString()}`);\n  throw error;\n}",inputSchema:{fields:{prompt:{type:"textarea",label:"Image Description",description:"Describe the image you want to generate",required:!0,validation:{minLength:10,maxLength:1e3},default:"A serene landscape with mountains and a lake at sunset"},model:{type:"select",label:"DALL-E Model",description:"Select DALL-E model version (DALL-E 3 only supports 1 image at a time)",required:!0,validation:{options:["dall-e-2","dall-e-3"]},default:"dall-e-2"},numberOfImages:{type:"number",label:"Number of Images",description:"How many images to generate (1-10 for DALL-E 2, always 1 for DALL-E 3)",required:!0,validation:{min:1,max:10},default:1},imageSize:{type:"select",label:"Image Size",description:"Select the size of the generated images",required:!0,validation:{options:["256x256","512x512","1024x1024","1024x1792","1792x1024"]},default:"1024x1024"}}},config:{variables:{API_KEY:{value:"",label:"OpenAI API Key",description:"Your OpenAI API key for DALL-E image generation",required:!0,public:!1},API_URL:{value:"https://api.openai.com/v1/images/generations",label:"API Endpoint",description:"DALL-E API endpoint",required:!0,public:!0}}},version:"1.0.0",author:"Magic Loops",tags:["ai","image-generation","dall-e"]},tn=()=>[{id:"fibonacci-calculator",name:"Fibonacci Calculator",description:"Calculates the Fibonacci sequence up to a specified number",language:"javascript",tags:["math","sequence","calculator"],implementation:ts},{id:"dalle-generator",name:"DALL-E Image Generator",description:"Generates images using OpenAI DALL-E",language:"javascript",tags:["ai","image-generation","dall-e"],implementation:tr}],ti=[{id:"preview",label:"Preview"},{id:"code",label:"Code"},{id:"schema",label:"Input Schema"},{id:"config",label:"Configuration"}],to=e=>{var t,a;let l={code:"",language:"javascript",inputSchema:{fields:{}},config:{variables:{}}};if(e.code&&(l.code=e.code),e.language&&ex.mF.includes(e.language)&&(l.language=e.language),null===(t=e.inputSchema)||void 0===t?void 0:t.fields)try{let t={};Object.entries(e.inputSchema.fields).forEach(e=>{let[a,l]=e,s=l.type;("string"===s||"number"===s||"boolean"===s||"select"===s||"multiselect"===s||"textarea"===s)&&(t[a]={type:s,label:l.label||a,description:l.description||"",required:!!l.required,default:l.default,validation:l.validation||{}})}),l.inputSchema={fields:t}}catch(e){console.error("Error processing example input schema:",e)}if(null===(a=e.config)||void 0===a?void 0:a.variables)try{let t={};Object.entries(e.config.variables).forEach(e=>{let[a,l]=e;t[a]={value:l.value||"",label:l.label||a,description:l.description||"",required:!!l.required,public:!!l.public}}),l.config={variables:t}}catch(e){console.error("Error processing example config:",e)}return l};var tc=e=>{var t;let{block:a,onChange:s,generating:r,readOnly:n,disabled:i,className:c=""}=e,[d,u]=(0,o.useState)("preview"),[m,p]=(0,o.useState)(!1),[x,h]=(0,o.useState)(!1),g=(0,o.useRef)(a);(0,o.useEffect)(()=>{a.description!==g.current.description&&(g.current={...a},s(a))},[a.description,a.outputName,s,a]),(0,o.useEffect)(()=>{u("preview"),h(!1)},[a.id]),(0,o.useEffect)(()=>{r&&h(!1)},[r]),(0,o.useEffect)(()=>{if(x)return;if(!r){u("preview");return}let e=a.inputSchema&&"object"==typeof a.inputSchema&&a.inputSchema.fields&&Object.keys(a.inputSchema.fields).length>0,t=a.config&&"object"==typeof a.config&&a.config.variables&&Object.keys(a.config.variables).length>0,l=a.code&&a.code.trim().length>50&&!a.code.includes("Generated code here");a.exampleInputValues&&Object.keys(a.exampleInputValues).length>0&&l&&e&&t?u("preview"):l&&e&&t?u("preview"):l?u("code"):t?u("config"):u("schema")},[r,a.inputSchema,a.config,a.code,a.description,a.exampleInputValues,d,x]);let f=(0,o.useCallback)(e=>{u(e),h(!0)},[]),b=(0,o.useCallback)(e=>{s({...a,code:e})},[a,s]),v=(0,o.useCallback)(e=>{let t={...a,inputSchema:e,testInputValues:void 0};s(t),g.current=t},[a,s]),y=(0,o.useCallback)(e=>{s({...a,config:e})},[a,s]),j=(0,o.useCallback)(e=>{if(JSON.stringify(a.testInputValues)===JSON.stringify(e))return;let t={...a,testInputValues:e};s(t),g.current=t},[a,s]),N=e=>{let t=tn().find(t=>t.id===e);if(t&&t.implementation){let e=to(t.implementation),l={...a,...e,testInputValues:void 0};s(l),g.current=l,p(!1)}};return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 py-4 ".concat(c),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"flex items-center space-x-3",children:(0,l.jsx)(e6,{tabs:ti,activeTab:d,onTabChange:f})}),"preview"!==d&&(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(eT.Z,{size:"sm",onClick:()=>p(!m),disabled:i||r||n,className:"text-xs",children:"Load Example"}),m&&(0,l.jsxs)("div",{className:"absolute right-0 top-10 z-10 w-64 rounded-md border-2 border-black bg-white p-2 shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] dark:bg-gray-800",children:[(0,l.jsx)("div",{className:"mb-2 text-xs font-semibold",children:"Select an example:"}),tn().map(e=>(0,l.jsxs)("button",{className:"mb-1 block w-full rounded px-2 py-1 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700",onClick:()=>N(e.id),children:[e.name,(0,l.jsx)("div",{className:"text-xs opacity-70",children:e.description})]},e.id))]})]})]}),"code"===d&&(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(eh.Z,{className:"w-full",disabled:i,value:null!==(t=null==a?void 0:a.language)&&void 0!==t?t:ex.mF[0],onChange:e=>{var t,l,r;if(!ex.mF.includes(e.target.value))return;let n=null!==(r=null==a?void 0:a.language)&&void 0!==r?r:ex.mF[0];if(n===e.target.value)return;let i={...a,language:e.target.value};(null===(t=a.code)||void 0===t?void 0:t.trim())===(null===(l=ex.fl[n])||void 0===l?void 0:l.trim())&&(i.code=ex.fl[i.language]),s(i)},children:ex.mF.map(e=>(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,l.jsx)(ep.Z,{code:a.code||"",language:a.language,onChange:r?void 0:b,disabled:i||r||n,title:"Block Code",note:"This code will run when the block is executed. Access input data via the INPUTS variable and configuration via CONFIG."}),(0,l.jsx)("div",{className:"text-xs italic text-black/40 dark:text-white/40",children:"Variables available: INPUTS (your schema), CONFIG (your variables), BLOCK_INPUT (previous block)"}),a.testInputValues&&Object.keys(a.testInputValues).length>0&&(0,l.jsx)("div",{className:"text-xs italic text-green-600 dark:text-green-400",children:"✓ Using test values from Preview tab"})]}),"schema"===d&&(0,l.jsx)(tt,{schema:"string"==typeof a.inputSchema?JSON.parse(a.inputSchema):a.inputSchema||{fields:{}},onChange:v,disabled:i||n}),"config"===d&&(0,l.jsx)(ta,{config:"string"==typeof a.config?JSON.parse(a.config):a.config||{variables:{}},onChange:y,disabled:i||n}),"preview"===d&&(0,l.jsx)("div",{children:tl?(0,l.jsx)(tl,{schema:"string"==typeof a.inputSchema?JSON.parse(a.inputSchema):a.inputSchema||{fields:{}},block:a,onInputValuesChange:j}):(0,l.jsx)("div",{className:"rounded-md border-2 border-red-500 bg-red-100 p-4 text-red-800",children:"Error loading preview component. Please try again."})})]})},td=a(59264),tu=a(253),tm=e=>{var t,a,s,r;let{block:n,onChange:i,disabled:o,replaceableVars:c}=e,d="create"!==n.operation,u="read"===n.operation||"update"===n.operation||"clear"===n.operation,m="update"===n.operation||"append"===n.operation,p="create"===n.operation;return(0,l.jsxs)("div",{className:"flex flex-col space-y-2 pb-4 pt-2",children:[(0,l.jsx)("div",{className:"mb-4",children:(0,l.jsx)(td.D,{})}),d&&(0,l.jsx)("div",{className:"w-full",children:(0,l.jsx)(tu.q,{value:n.spreadsheetId||"",onChange:e=>{n.spreadsheetId!==e&&i({spreadsheetId:e,worksheet:""})},worksheet:n.worksheet||"",onWorksheetChange:e=>{n.worksheet!==e&&i({worksheet:e})},showWorksheetSelector:!0,disabled:o,label:"Spreadsheet",description:"Select a saved spreadsheet or create a new one"})}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(ed.Z,{className:"font-semibold italic",children:"Operation:"}),(0,l.jsx)(eh.Z,{className:"h-[42px] w-full",disabled:o,value:null!==(t=n.operation)&&void 0!==t?t:"read",onChange:e=>{let t=e.target.value;ex.m2.includes(t)&&n.operation!==t&&i({operation:t})},children:ex.m2.map(e=>(0,l.jsx)("option",{value:e,className:"bg-[#262f34] text-white/80",children:e.charAt(0).toUpperCase()+e.slice(1)},e))}),(0,l.jsx)("div",{className:"text-xs text-gray-600",children:(e=>{switch(e){case"read":return"Read data from a Google Sheet";case"update":return"Update existing data in a Google Sheet";case"append":return"Add new rows to the end of a Google Sheet";case"clear":return"Clear data from a range in a Google Sheet";case"create":return"Create a new Google Sheet";default:return"Google Sheets operation"}})(n.operation)})]}),u&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(ed.Z,{className:"font-semibold italic",children:"Range:"}),(0,l.jsx)(ec,{value:null!==(a=n.range)&&void 0!==a?a:"",vars:c,onChange:e=>{n.range!==e&&i({range:e})},disabled:o,singleLine:!0,placeholder:"A1:E10",className:"h-[42px] w-full"}),(0,l.jsxs)("div",{className:"text-xs text-gray-500",children:["Specify the range to ",n.operation," (e.g., A1:E10, Sheet1!A:Z, or leave empty for entire sheet)"]})]}),p&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)(ed.Z,{className:"font-semibold italic",children:"Sheet Title:"}),(0,l.jsx)(ec,{value:null!==(s=n.sheetTitle)&&void 0!==s?s:"",vars:c,onChange:e=>{n.sheetTitle!==e&&i({sheetTitle:e})},disabled:o,singleLine:!0,placeholder:"My New Spreadsheet",className:"h-[42px] w-full"}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:"Enter a name for your new spreadsheet"})]})]}),m&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(ed.Z,{className:"mt-2 font-semibold italic",children:["Data"," ","update"===n.operation?"(JSON Array)":"(CSV or JSON Array)",":"]}),(0,l.jsx)(ec,{value:null!==(r=n.values)&&void 0!==r?r:"",vars:c,disabled:o,placeholder:"update"===n.operation?'[["Name", "Age"], ["John", "25"], ["Jane", "30"]]':"Name,Age\nJohn,25\nJane,30",onChange:e=>{n.values!==e&&i({values:e})}}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:"update"===n.operation?'Provide data as a JSON array of arrays: [["row1col1", "row1col2"], ["row2col1", "row2col2"]]':"Provide data as CSV text or JSON array. For CSV: each line is a row, comma-separated values"})]}),(0,l.jsx)(ed.Z,{className:"text-xs italic text-black/40 dark:text-white/40",children:"You can use '$BLOCK_INPUT', '$LOOP_INPUT', previous Block Outputs, & Loop Variables in any field"})]})},tp=a(37942),tx=a(1019),th=a(62965),tg=a(94620),tf=a(36767),tb=a(36771),tv=a(28321),ty=a(72515);function tj(e){let{blockId:t,loopId:a,supabaseClient:s,onRestore:r,onClose:n}=e,{t:i}=(0,f.Z)("blocks"),[c,d]=(0,o.useState)([]),[u,m]=(0,o.useState)(!0),[p,x]=(0,o.useState)([]),[h,g]=(0,o.useState)([]),[b,v]=(0,o.useState)(null);(0,o.useEffect)(()=>{!async function(){m(!0);try{let e=await (0,tp.M)(t,a,s);d(e),e.length>0&&(x([e[0].id]),g([e[0].id]))}catch(e){console.error("Error fetching block history:",e)}finally{m(!1)}}()},[t,a,s]);let y=e=>{x(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])},j=e=>{g(t=>!t.includes(e)&&t.length>=2?[t[1],e]:t.includes(e)?t.filter(t=>t!==e):[...t,e])},N=e=>{switch(e.generation_type){case"create":return"copy"===e.generation_mode?i("history.copied"):i("history.created");case"update":var t;return(null===(t=e.generation_mode)||void 0===t?void 0:t.startsWith("ai"))?i("history.aiGenerated"):i("history.updated");default:return"".concat(e.generation_type).concat(e.generation_mode?" (".concat(e.generation_mode,")"):"")}},k=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text";try{await navigator.clipboard.writeText(e),v(t),setTimeout(()=>{v(null)},2e3)}catch(e){console.error("Failed to copy text: ",e)}},w=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return(0,l.jsxs)("div",{className:"mt-4 max-h-80 overflow-auto ".concat(t?"rounded-lg border-2 border-black":""," bg-white p-4 dark:bg-gray-900"),children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsx)("div",{children:e.outputName&&(0,l.jsxs)("p",{className:"text-sm",children:[(0,l.jsxs)("span",{className:"font-bold",children:[i("history.outputName"),":"]})," ",e.outputName]})}),(0,l.jsx)("div",{children:e.description&&(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsxs)("p",{className:"text-sm font-bold",children:[i("history.description"),":"]}),(0,l.jsxs)("div",{className:"relative mt-1",children:[(0,l.jsx)("button",{onClick:()=>k(e.description||"","description"),className:"absolute -right-3 -top-3 z-10 rounded-lg border-2 border-black bg-blue-200 p-1.5 text-xs shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:bg-blue-300",title:i("history.copyText"),children:"description"===b?(0,l.jsx)(tx.Z,{className:"h-4 w-4"}):(0,l.jsx)(th.Z,{className:"h-4 w-4"})}),(0,l.jsx)("pre",{className:"whitespace-pre-wrap border-2 border-black bg-gray-100 p-4 text-xs shadow-[2px_2px_0_0_rgba(0,0,0,1)] dark:bg-gray-800",children:e.description})]})]})})]}),"llm"===e.type&&e.description&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("h4",{className:"mb-2 text-sm font-bold",children:i("history.prompt")}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("button",{onClick:()=>k(e.description||"","prompt"),className:"absolute -right-3 -top-3 z-10 rounded-lg border-2 border-black bg-blue-200 p-1.5 text-xs shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:bg-blue-300",title:i("history.copyText"),children:"prompt"===b?(0,l.jsx)(tx.Z,{className:"h-4 w-4"}):(0,l.jsx)(th.Z,{className:"h-4 w-4"})}),(0,l.jsx)("pre",{className:"whitespace-pre-wrap border-2 border-black bg-gray-100 p-4 text-xs shadow-[2px_2px_0_0_rgba(0,0,0,1)] dark:bg-gray-800",children:e.description})]})]}),"code"===e.type&&e.code&&(0,l.jsxs)("div",{className:"mt-4",children:[(0,l.jsx)("h4",{className:"mb-2 text-sm font-bold",children:i("history.code")}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("button",{onClick:()=>k(e.code||"","code"),className:"absolute -right-3 -top-3 z-10 rounded-lg border-2 border-black bg-blue-200 p-1.5 text-xs shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:bg-blue-300",title:i("history.copyCode"),children:"code"===b?(0,l.jsx)(tx.Z,{className:"h-4 w-4"}):(0,l.jsx)(th.Z,{className:"h-4 w-4"})}),(0,l.jsx)("pre",{className:"whitespace-pre-wrap border-2 border-black bg-gray-100 p-4 text-xs shadow-[2px_2px_0_0_rgba(0,0,0,1)] dark:bg-gray-800",children:e.code})]})]})]})};return(0,l.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center overflow-y-auto bg-black/50 p-4",children:[(0,l.jsxs)("div",{className:"max-h-[90vh] w-full max-w-4xl overflow-y-auto border-4 border-black bg-white shadow-[4px_4px_0_0_rgba(0,0,0,1)] dark:bg-gray-800",style:{backgroundImage:"radial-gradient(circle, #00000022 1px, transparent 1px)",backgroundSize:"20px 20px"},children:[(0,l.jsxs)("div",{className:"sticky top-0 z-[100] flex items-center justify-between border-b-4 border-black bg-white p-4 dark:bg-gray-800",children:[(0,l.jsx)("h2",{className:"text-xl font-bold",children:i("history.blockHistory")}),(0,l.jsx)("button",{onClick:n,className:"rounded-none border-2 border-black bg-red-400 p-1 transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)] dark:hover:bg-gray-700",children:(0,l.jsx)(tg.Z,{className:"h-5 w-5"})})]}),(0,l.jsx)("div",{className:"p-6",children:u?(0,l.jsx)("div",{className:"flex items-center justify-center py-16",children:(0,l.jsx)("div",{className:"h-10 w-10 animate-spin rounded-none border-4 border-black border-b-blue-500"})}):0===c.length?(0,l.jsx)("div",{className:"py-10 text-center",children:(0,l.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:i("history.noHistoryFound")})}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"mb-6 space-y-4",children:[(0,l.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-lg font-bold",children:i("history.versions")}),(0,l.jsx)("p",{className:"text-sm text-gray-500",children:2===h.length?i("history.comparingVersions"):i("history.selectToCompare")})]}),c.map((e,t)=>{let a=0===t;return(0,l.jsxs)("div",{className:"overflow-hidden transition-all duration-200\n                        ".concat(h.includes(e.id)?"border-2 border-blue-500 shadow-[2px_2px_0_0_rgba(0,0,0,1)]":"border-2 shadow-[2px_2px_0_0_rgba(0,0,0,1)]","\n                      "),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 \n                          ".concat(a?"bg-[#fdf6e9] hover:bg-[#f5edd4]":"bg-gray-50 hover:bg-gray-100 dark:bg-gray-700 dark:hover:bg-gray-600","\n                          ").concat(p.includes(e.id)?"border-b-0":"","\n                        "),children:[(0,l.jsx)("div",{className:"flex-1",children:(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",checked:h.includes(e.id),onChange:t=>{t.stopPropagation(),j(e.id)},className:"mr-3 h-4 w-4 border-2 border-black text-blue-600 focus:ring-blue-500",onClick:e=>e.stopPropagation()}),(0,l.jsxs)("div",{className:"flex-1 cursor-pointer",onClick:()=>y(e.id),children:[(0,l.jsxs)("h4",{className:"font-bold",children:[a&&(0,l.jsx)("span",{className:"mr-2 rounded border border-black bg-green-200 px-1.5 py-0.5 text-xs",children:i("history.current")}),i("history.version")," ",e.version]}),(0,l.jsxs)("p",{className:"text-sm text-gray-500",children:[(0,ty.Q)(new Date(e.created_at))," ",i("history.ago")," - ",N(e)]})]})]})}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[r&&!a&&(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),r(e.block_content)},className:"rounded-none border-2 border-black bg-blue-400 px-3 py-1.5 text-sm text-black shadow-[2px_2px_0_0_rgba(0,0,0,1)] hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)] focus:outline-none",children:(0,l.jsx)(tf.Z,{className:"h-4 w-4"})}),(0,l.jsx)("button",{onClick:t=>{t.stopPropagation(),y(e.id)},className:"p-1",children:p.includes(e.id)?(0,l.jsx)(tb.Z,{className:"h-5 w-5 text-gray-400"}):(0,l.jsx)(tv.Z,{className:"h-5 w-5 text-gray-400"})})]})]}),p.includes(e.id)&&(0,l.jsx)("div",{className:" border-black bg-white dark:bg-gray-800",children:w(e.block_content,!1)})]},e.id)})]}),(()=>{if(2!==h.length)return null;let e=c.find(e=>e.id===h[0]),t=c.find(e=>e.id===h[1]);return e&&t?(0,l.jsxs)("div",{className:"mt-6 border-t-2 border-black pt-4 dark:border-gray-700",children:[(0,l.jsx)("h3",{className:"mb-4 text-lg font-bold",children:i("history.comparison")}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)("h4",{className:"text-md mb-2 font-bold",children:[i("history.version")," ",e.version,(0,l.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",(0,ty.Q)(new Date(e.created_at))," ",i("history.ago"),")"]})]}),w(e.block_content)]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h4",{className:"text-md mb-2 font-bold",children:[i("history.version")," ",t.version,(0,l.jsxs)("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",(0,ty.Q)(new Date(t.created_at))," ",i("history.ago"),")"]})]}),w(t.block_content)]})]})]}):null})()]})})]}),b&&(0,l.jsx)("div",{className:"fixed bottom-4 right-4 z-50 rounded-lg bg-black/80 px-4 py-2 text-white shadow-lg",children:"Content copied to clipboard"})]})}var tN=a(37539),tk=a(28923);function tw(e){let{isOpen:t,currentName:a,onConfirm:s,onClose:r}=e,{t:c}=(0,f.Z)("blocks"),[d,u]=(0,o.useState)(a),[m,p]=(0,o.useState)(),x=(0,o.useRef)(null);(0,o.useEffect)(()=>{t&&(u(a),p(void 0),setTimeout(()=>{var e;return null===(e=x.current)||void 0===e?void 0:e.focus()},0))},[t,a]);let h=()=>{if(!tk.R.test(d)){p(c("magicBlock.renameOutputModal.error"));return}s(d)};return(0,l.jsx)(n.u,{appear:!0,show:t,as:o.Fragment,children:(0,l.jsx)(i.V,{as:"div",className:"fixed inset-0 z-[60] overflow-y-auto",onClose:r,children:(0,l.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,l.jsx)(i.V.Overlay,{className:"fixed inset-0 bg-black opacity-50 transition-opacity"}),(0,l.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,l.jsx)(n.u.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,l.jsx)("div",{className:"inline-block transform overflow-hidden bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",children:(0,l.jsxs)("form",{onSubmit:e=>{e.preventDefault(),h()},children:[(0,l.jsx)("div",{className:"sm:flex sm:items-start",children:(0,l.jsxs)("div",{className:"mt-3 w-full sm:mt-0 sm:text-left",children:[(0,l.jsx)(i.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:c("magicBlock.renameOutputModal.title")}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)("input",{ref:x,value:d,onChange:e=>{let t=e.target.value;u(t),m&&tk.R.test(t)&&p(void 0)},className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500"})}),m&&(0,l.jsx)("p",{className:"mt-2 text-sm text-red-500",children:m})]})}),(0,l.jsxs)("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[(0,l.jsx)(F.z,{type:"submit",className:"w-full bg-green-600 text-white hover:bg-green-700 focus:ring-green-500 sm:ml-3 sm:w-auto",children:c("magicBlock.renameOutputModal.save")}),(0,l.jsx)(F.z,{variant:"outline",onClick:r,className:"mt-3 w-full border-gray-300 text-gray-700 hover:bg-gray-50 sm:mt-0 sm:w-auto",children:c("magicBlock.renameOutputModal.cancel")})]})]})})})]})})})}var t_=a(91835),tC=a(34880),tI=a(20117),tT=a(19760);let tS=(0,o.memo)(e=>{var t;let{block:a,blockIndex:v,blockResult:y,exampleInput:j,dirtyStatus:N,blockRef:k,outputRef:w,onDirtyChange:_,onAiUpdateBlock:C,onBlockChange:I=()=>{},onBlockCopy:T,onBlockTemplateAdd:S,onBlockDelete:L,onRunBlock:O,onOutputChange:E,outputPlaceholder:Z,className:A="",deleteable:P,readOnly:M,disabled:B,isTemplateEditing:R,hideOutput:K=!1,hideGenerate:z=!1,showCost:U=!1,showDetails:D=!1,loopRunning:q=!1,loopId:$,loop:G,highlight:J,genState:W,runType:H}=e,{supabase:Y}=(0,b.a)(),{t:X}=(0,f.Z)("blocks"),Q=(0,o.useRef)(!1),[ee,et]=(0,o.useState)("idle"),[ea,el]=(0,o.useState)(void 0),[es,er]=(0,o.useState)(!1),[ei,eo]=(0,o.useState)(!1),[ed,ep]=(0,o.useState)(!1),[ex,eh]=(0,o.useState)(!1),[ef,ev]=(0,o.useState)(!1),[ej,eN]=(0,o.useState)(!1),[ew,eC]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=()=>eC(window.innerWidth<980);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let eL=(0,o.useCallback)(async(e,t,a)=>{G&&("changed"===ee||t)&&C&&(Q.current=!0,et("loading"),await C(v,e,G,a),Q.current=!1,et("idle"))},[ee,C,v,G]),eO=(0,o.useCallback)(()=>{T&&(T(),eo(!1))},[T]),eE=(0,o.useCallback)(e=>{e.preventDefault();let t=new FormData(e.target).get("blockTemplateName"),l="string"==typeof t?t.trim():"",s={...a,blockName:l};S&&(S(s),eh(!1))},[a,S]),eZ=(0,o.useCallback)(()=>{L&&(L(a.id),ep(!1))},[a.id,L]),eA=(0,o.useCallback)(e=>{I({...a,outputName:e}),eN(!1)},[a,I]),eP="bg-emerald-400 enabled:hover:bg-emerald-500",eF=X("magicBlock.runButton.default");q&&((null==y?void 0:y.status)==="running"?(eP="bg-red-600 text-white",eF=X("magicBlock.runButton.running")):(null==y?void 0:y.status)==="not-ran"?(eP="bg-yellow-400 text-black/90",eF=X("magicBlock.runButton.pending")):(null==y?void 0:y.status)==="error"?(eP="bg-red-600 text-white",eF=X("magicBlock.runButton.error")):(null==y?void 0:y.status)==="success"&&(eP="bg-emerald-700 text-white",eF=X("magicBlock.runButton.success"))),((null==N?void 0:N.impl)||(null==N?void 0:N.output))&&(eP+=" border-2 border-yellow-500 ");let eM=(0,o.useCallback)(e=>(0,l.jsx)(t_.Z,{content:e.toolTip,children:(0,l.jsx)(eT.Z,{variant:"outline",disabled:!e.onClick||B||"loading"===ee,onClick:e.onClick,className:"\n              mr-2 flex min-w-[8rem] \n              ".concat(null==e?void 0:e.className,"\n              ").concat((null==N?void 0:N.description)?"border-yellow-500":"","\n            "),children:e.label})}),[null==N?void 0:N.description,B,ee]),eU=(0,o.useMemo)(()=>{let e;return(0,tT.Iu)(a)?"api-trigger"===a.type&&((null==N?void 0:N.description)||(null==N?void 0:N.impl)||(null==N?void 0:N.output))&&!(0,tT.N3)(a)?e="This block must be regenerated before running due to file or configuration changes":(null==N?void 0:N.description)&&!(0,tT.N3)(a)&&(e="This block must be regenerated before running due to description changes"):e=X("magicBlock.tooltips.incompleteBlock"),(0,l.jsx)("div",{className:"relative flex justify-end",children:!M&&(0,V.Jz)(a)&&!R&&(0,l.jsx)(t_.Z,{content:e,children:(0,l.jsx)(eT.Z,{variant:"outline",onClick:()=>{null==O||O(v)},disabled:B||!(0,tT.Iu)(a)||("api-trigger"===a.type?((null==N?void 0:N.description)||(null==N?void 0:N.impl)||(null==N?void 0:N.output))&&!(0,tT.N3)(a):(null==N?void 0:N.description)&&!(0,tT.N3)(a)),className:"\n                  min-w-[8rem] \n                  ".concat(eP,"\n                  enabled:hover:brightness-90\n                  disabled:opacity-50\n                "),children:eF})})})},[a,v,B,N,R,O,M,eP,eF,X]),eD=(0,o.useMemo)(()=>{if(z||M)return(0,l.jsx)(l.Fragment,{});if((null==W?void 0:W.blockStatus)&&(null==W?void 0:W.curBlockIndex)===v&&(0,tI.lU)(W)){let e=tI.qm[W.blockStatus];if(e)return eM({label:"".concat(e,"...")})}return a.description?"perplexity"!==a.type&&((null==N?void 0:N.description)||"api-trigger"===a.type&&a.includeFileUpload&&((null==N?void 0:N.impl)||(null==N?void 0:N.output)))?eM({label:X("magicBlock.aiButton.regenerate"),onClick:()=>{eL("gen",!0)},className:"bg-cyan-300 enabled:hover:bg-cyan-400"}):eM({label:X("magicBlock.aiButton.generate"),onClick:()=>{eL("gen",!0)},className:"bg-cyan-300 enabled:hover:bg-cyan-400"}):eM({label:X("magicBlock.aiButton.generate"),toolTip:X("magicBlock.tooltips.enterDescription"),className:"bg-cyan-300 enabled:hover:bg-cyan-400"})},[a,v,eM,null==N?void 0:N.description,null==N?void 0:N.impl,null==N?void 0:N.output,W,eL,M,G,X]),eV=(0,o.useCallback)(e=>{E&&E(a.id,e)},[a.id,E]),eq=(0,o.useCallback)(()=>!!W&&W.curBlockIndex===v&&(0,tI.lU)(W),[v,W]);D||eq()||(0,V.ZH)(a.type)||M&&!a.description&&(0,V.Jd)(a);let e$=(0,o.useMemo)(()=>!M||a.description?(0,V.sz)(a.type):(0,tT.Iu)(a)?X("magicBlock.placeholders.noDescription"):X("magicBlock.placeholders.emptyBlock"),[a,M,X]),eG=(0,o.useMemo)(()=>{let e=null==G?void 0:G.blocks.findIndex(e=>{let{id:t}=e;return t===a.id}),t=null==G?void 0:G.exampleInput;if(e&&e>0){let a=null==G?void 0:G.blocks[e-1];if(a){var l,s,r;t=null==G?void 0:null===(r=G.testRunResult)||void 0===r?void 0:null===(s=r.blockResults)||void 0===s?void 0:null===(l=s[a.id])||void 0===l?void 0:l.stdout}}return t},[null==G?void 0:G.blocks,null==G?void 0:G.exampleInput,null==G?void 0:G.testRunResult,a.id]),eJ=(0,o.useMemo)(()=>{if(!(null==G?void 0:G.blocks))return[];let e=[];for(let n of G.blocks){var t,l,s,r;if(n.id===a.id)break;let i=n.outputName,o=null!==(r=null===(s=G.testRunResult)||void 0===s?void 0:null===(l=s.blockResults)||void 0===l?void 0:null===(t=l[n.id])||void 0===t?void 0:t.stdout)&&void 0!==r?r:"";e.push({name:i,output:o})}return e},[null==G?void 0:G.blocks,null==G?void 0:G.testRunResult,a.id]),eW=(0,o.useMemo)(()=>{var e,t,a,l,s;if(!G)return"";let r=G.blocks[0].id,n=null!==(l=null===(a=G.testRunResult)||void 0===a?void 0:null===(t=a.blockResults)||void 0===t?void 0:null===(e=t[r])||void 0===e?void 0:e.stdout)&&void 0!==l?l:"";return n||(n=null!==(s=null==G?void 0:G.exampleInput)&&void 0!==s?s:""),n},[null==G?void 0:G.blocks,null==G?void 0:G.testRunResult,null==G?void 0:G.exampleInput]),eY=(0,o.useMemo)(()=>(0,V.ig)({loopInput:eW,blockInput:eG,loopVariables:null==G?void 0:G.variables,otherVars:eJ.map(e=>({key:e.name,value:e.output}))}),[eW,eG,null==G?void 0:G.variables,eJ]);return(0,l.jsxs)("div",{className:"relative w-full ",children:[(0,l.jsxs)(tC.Zb,{className:(0,en.cn)("relative w-full overflow-hidden bg-[#fdf6e9] p-4 shadow-[2px_2px_0_0_rgba(0,0,0,1)] dark:bg-[#374151] sm:p-6","block"===J?"border-[3px] border-dashed border-sky-400 shadow-none":"border-2 border-black",A),ref:k,children:[(0,l.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"flex items-center gap-2",children:(0,l.jsx)("h2",{className:"text-xl font-semibold",children:a.blockName?a.blockName:(0,V.jS)(a.type)})}),(P||!(0,V.Jd)(a))&&(0,l.jsx)("div",{className:"flex",children:(0,l.jsxs)(s.v,{children:[(0,l.jsx)(s.v.Button,{className:"h-6 w-6 rounded-lg text-black/50 transition duration-200 ease-in-out hover:bg-black/10",children:(0,l.jsx)(c.Z,{color:"currentColor",size:24})}),(0,l.jsx)(s.v.Items,{className:"absolute right-1 top-5 z-[120] mt-2 w-36 origin-top-right divide-y divide-gray-100 rounded-md bg-white shadow-lg ring-1 ring-black/5 focus:outline-none",children:(0,l.jsxs)("div",{className:"px-1 py-1 ",children:[P&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.v.Item,{children:e=>{let{active:t}=e;return(0,l.jsxs)("button",{className:(0,en.cn)("group flex w-full items-center rounded-md px-2 py-2 text-sm",t?"bg-violet-500 text-white":"text-gray-900"),onClick:()=>eo(!0),children:[t?(0,l.jsx)(d.Z,{className:"mr-2 h-5 w-5 text-white","aria-hidden":"true"}):(0,l.jsx)(d.Z,{className:"mr-2 h-5 w-5 text-violet-500","aria-hidden":"true"}),X("magicBlock.menu.duplicate")]})}}),!B&&!M&&(0,l.jsx)(s.v.Item,{children:e=>{let{active:t}=e;return(0,l.jsxs)("button",{className:(0,en.cn)("group flex w-full items-center rounded-md px-2 py-2 text-sm",t?"bg-red-500 text-white":"text-gray-900"),disabled:B,onClick:()=>ep(!0),children:[t?(0,l.jsx)(u.Z,{className:"mr-2 h-5 w-5 text-white","aria-hidden":"true"}):(0,l.jsx)(u.Z,{className:"mr-2 h-5 w-5 text-red-500","aria-hidden":"true"}),X("magicBlock.menu.delete")]})}})]}),!(0,V.Jd)(a)&&(0,l.jsx)(s.v.Item,{children:e=>{let{active:t}=e;return(0,l.jsxs)("button",{className:(0,en.cn)("group flex w-full items-center rounded-md px-2 py-2 text-sm",t?"bg-sky-600 text-white":"text-gray-900"),onClick:()=>eh(!0),children:[t?(0,l.jsx)(m.Z,{className:"mr-2 h-5 w-5 text-white","aria-hidden":"true"}):(0,l.jsx)(m.Z,{className:"mr-2 h-5 w-5 text-sky-600","aria-hidden":"true"}),X("magicBlock.menu.save")]})}}),(0,l.jsx)(s.v.Item,{children:e=>{let{active:t}=e;return(0,l.jsxs)("button",{className:(0,en.cn)("group flex w-full items-center rounded-md px-2 py-2 text-sm",t?"bg-green-500 text-white":"text-gray-900"),onClick:()=>eN(!0),children:[t?(0,l.jsx)(p.Z,{className:"mr-2 h-5 w-5 text-white","aria-hidden":"true"}):(0,l.jsx)(p.Z,{className:"mr-2 h-5 w-5 text-green-500","aria-hidden":"true"}),X("magicBlock.menu.renameOutput")]})}}),(0,l.jsx)(s.v.Item,{children:e=>{let{active:t}=e;return(0,l.jsxs)("button",{className:(0,en.cn)("group flex w-full items-center rounded-md px-2 py-2 text-sm",t?"bg-gray-500 text-white":"text-gray-900"),onClick:()=>ev(!0),children:[t?(0,l.jsx)(x.Z,{className:"mr-2 h-5 w-5 text-white","aria-hidden":"true"}):(0,l.jsx)(x.Z,{className:"mr-2 h-5 w-5 text-gray-500","aria-hidden":"true"}),X("magicBlock.menu.history")]})}})]})})]})})]}),(0,V.Af)(a.type)&&(0,l.jsxs)("div",{className:"mb-2",children:[(0,l.jsx)(ec,{value:null!==(t=a.description)&&void 0!==t?t:"",placeholder:e$,vars:eY,className:(0,en.cn)("text-md mb-2 p-2 font-system text-black antialiased dark:text-white/80",M?"":"focus-visible:ring-0"),onChange:e=>{a.description!==e&&(et("changed"),el(void 0),I({...a,description:e}))},onKeyDown:e=>{(navigator.userAgent.includes("Mac")?e.metaKey&&"Enter"===e.key:e.ctrlKey&&"Enter"===e.key)&&(e.preventDefault(),eL("gen",!0))},disabled:B,fontFamily:"var(--ml-system-font)"}),!M&&ea&&(0,l.jsx)("p",{className:"rounded-lg bg-transparent px-1.5 pt-1 text-xs italic text-red-500 focus:outline-none",children:ea})]}),(0,l.jsx)(r.p,{defaultOpen:D||eq()||(0,V.ZH)(a.type)||M&&!a.description&&(0,tT.Iu)(a),children:e=>{let{open:t}=e;return es!==t&&er(t),(0,l.jsxs)(l.Fragment,{children:[(0,V.Af)(a.type)&&(0,l.jsxs)("div",{className:"flex flex-col space-y-2",children:[(null==N?void 0:N.description)&&(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"inline-flex cursor-pointer select-none flex-row items-center space-x-1 rounded-lg border border-yellow-500 p-1 font-medium text-yellow-500",onClick:()=>{null==_||_({...N,description:!1})},children:[(0,l.jsx)("p",{className:"text-xs italic",children:X("magicBlock.dirtyStatus.implementationOutdated")}),(0,l.jsx)(h.Z,{size:"18",className:"rounded-full bg-yellow-500/20 pl-[1px]"})]})}),((null==N?void 0:N.impl)||(null==N?void 0:N.output))&&(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"inline-flex cursor-pointer select-none flex-row items-center space-x-1 rounded-lg border border-yellow-500 p-1 font-medium text-yellow-500",onClick:()=>{null==_||_({...N,impl:!1,output:!1})},children:[(0,l.jsx)("p",{className:"text-xs italic",children:X("magicBlock.dirtyStatus.outputOutdated")}),(0,l.jsx)(h.Z,{size:"18",className:"rounded-full bg-yellow-500/20"})]})}),!M&&(0,l.jsx)("p",{className:"rounded-lg bg-transparent py-1 text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:X("magicBlock.descriptionNote")}),(0,l.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,l.jsxs)("div",{className:"flex flex-row",children:[eD,(0,l.jsxs)(r.p.Button,{className:"flex items-center rounded-none border-2 border-black bg-slate-300 px-4 py-1 text-start text-sm text-sm font-medium text-black shadow-[2px_2px_0_0_rgba(0,0,0,1)] transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:bg-slate-400 hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)]",children:[(0,l.jsx)("span",{children:t?X("magicBlock.detailsButton.hide"):X("magicBlock.detailsButton.show")}),(0,l.jsx)(g.Z,{size:16,className:"".concat(t?"rotate-90 transform":"")})]})]}),!M&&!es&&!ew&&eU]})]}),(0,l.jsxs)(r.p.Panel,{children:["time"===a.type&&(0,l.jsx)(e3,{block:a,readOnly:M,disabled:B,onChange:I,streaming:"block"===J}),"hook"===a.type&&(0,l.jsx)(eI,{block:a,onChange:I,disabled:B,exampleInput:j}),"email-trigger"===a.type&&(0,l.jsx)(ey,{block:a}),"sms-trigger"===a.type&&(0,l.jsx)(e2,{block:a,loop:G,onChange:I,disabled:B}),"whatsapp-trigger"===a.type&&(0,l.jsx)(eX,{block:a,loop:G,onChange:I,disabled:B}),"api-trigger"===a.type&&(0,l.jsx)(eu,{block:a,exampleInput:eG||j,loopId:$,onChange:I,onOutputChange:E,replaceableVars:eY}),"api-notify"===a.type&&(0,l.jsx)(em,{block:a,onChange:I,disabled:B,replaceableVars:eY}),"scrape"===a.type&&(0,l.jsx)(e1,{block:a,onChange:I,disabled:B,replaceableVars:eY}),"fetch"===a.type&&(0,l.jsx)(e_,{block:a,onChange:I,disabled:B,replaceableVars:eY}),"code"===a.type&&(0,l.jsx)(eg,{block:a,readOnly:M,disabled:B,onChange:I,generating:Q.current}),"llm"===a.type&&(0,l.jsx)(eB,{block:a,onChange:I,disabled:B}),"perplexity"===a.type&&(0,l.jsx)(eR,{block:a,onChange:I,disabled:B,replaceableVars:eY}),"exit-if"===a.type&&(0,l.jsx)(ek,{block:a,onChange:I,disabled:B}),"diff"===a.type&&(0,l.jsx)(eb,{block:a,onChange:I,disabled:B}),"update-var"===a.type&&(0,l.jsx)(e8,{block:a,onChange:I,disabled:B}),"sms"===a.type&&(0,l.jsx)(eH,{block:a,loop:G,onChange:I,replaceableVars:eY,disabled:B,streaming:"block"===J}),"whatsapp"===a.type&&(0,l.jsx)(eQ,{block:a,loop:G,onChange:I,replaceableVars:eY,disabled:B,streaming:"block"===J}),"email"===a.type&&(0,l.jsx)(ez,{block:a,onChange:I,disabled:B,replaceableVars:eY}),"hook-notify"===a.type&&(0,l.jsx)(eK,{block:a,onChange:I,disabled:B,replaceableVars:eY}),"image-generation"===a.type&&(0,l.jsx)(eS,{block:a,onChange:I,disabled:B,replaceableVars:eY}),"user-block"===a.type&&(0,l.jsx)(tc,{block:a,onChange:I,generating:Q.current,readOnly:M,disabled:B}),"google-sheets"===a.type&&(0,l.jsx)(tm,{block:a,onChange:I,disabled:B,replaceableVars:eY})]})]})}},eq()?"yes":"no"),ew&&(0,l.jsx)("div",{className:"w-full py-2"}),(es||ew)&&eU]}),!K&&(0,l.jsx)(tC.Zb,{ref:w,className:(0,en.cn)("mt-6 border-2 border-black bg-white p-4 shadow-[2px_2px_0_0_rgba(0,0,0,1)] dark:bg-[#1f1f1f]","output"===J&&"border-[4px] border-dashed border-sky-400 shadow-none dark:border-sky-400"),children:(0,l.jsx)(tN.Z,{className:"w-full",block:a,disabled:B||"loading"===ee,readOnly:M||z,onChange:eV,onAiFixBlock:e=>eL("fix",!0,e),outputName:a.outputName,blockResult:y,placeholder:Z,running:q&&(null==y?void 0:y.status)==="running",highlight:"output"===J,disableMarkdown:!(0,V.x3)(a),runType:H})}),(0,l.jsx)(n.u,{appear:!0,show:ei,as:o.Fragment,children:(0,l.jsx)(i.V,{as:"div",className:"fixed inset-0 z-[60] overflow-y-auto",onClose:()=>eo(!1),children:(0,l.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,l.jsx)(i.V.Overlay,{className:"fixed inset-0 bg-black opacity-50 transition-opacity"}),(0,l.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,l.jsx)(n.u.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,l.jsxs)("div",{className:"inline-block transform overflow-hidden bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",children:[(0,l.jsx)("div",{className:"sm:flex sm:items-start",children:(0,l.jsxs)("div",{className:"mt-3 sm:mt-0 sm:text-left",children:[(0,l.jsx)(i.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:X("magicBlock.copyModal.title")}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)("p",{className:"text-sm text-gray-500",children:X("magicBlock.copyModal.text")})})]})}),(0,l.jsxs)("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[(0,l.jsx)(F.z,{onClick:eO,className:"w-full bg-sky-500 text-white hover:bg-sky-600 sm:ml-3 sm:w-auto",children:X("magicBlock.copyModal.copy")}),(0,l.jsx)(F.z,{variant:"outline",onClick:()=>eo(!1),className:"mt-3 w-full sm:mt-0 sm:w-auto",children:X("magicBlock.copyModal.cancel")})]})]})})]})})}),(0,l.jsx)(n.u,{appear:!0,show:ed,as:o.Fragment,children:(0,l.jsx)(i.V,{as:"div",className:"fixed inset-0 z-[60] overflow-y-auto",onClose:()=>ep(!1),children:(0,l.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,l.jsx)(i.V.Overlay,{className:"fixed inset-0 bg-black opacity-50 transition-opacity"}),(0,l.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,l.jsx)(n.u.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,l.jsxs)("div",{className:"inline-block transform overflow-hidden bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",children:[(0,l.jsx)("div",{className:"sm:flex sm:items-start",children:(0,l.jsxs)("div",{className:"mt-3 sm:mt-0 sm:text-left",children:[(0,l.jsx)(i.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:X("magicBlock.deleteModal.title")}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)("p",{className:"text-sm text-gray-500",children:X("magicBlock.deleteModal.text")})})]})}),(0,l.jsxs)("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[(0,l.jsx)(F.z,{onClick:eZ,className:"w-full bg-red-600 text-white hover:bg-red-700 sm:ml-3 sm:w-auto",children:X("magicBlock.deleteModal.delete")}),(0,l.jsx)(F.z,{variant:"outline",onClick:()=>ep(!1),className:"mt-3 w-full sm:mt-0 sm:w-auto",children:X("magicBlock.deleteModal.cancel")})]})]})})]})})}),(0,l.jsx)(n.u,{appear:!0,show:ex,as:o.Fragment,children:(0,l.jsx)(i.V,{as:"div",className:"fixed inset-0 z-[60] overflow-y-auto",onClose:()=>eh(!1),children:(0,l.jsxs)("div",{className:"flex min-h-screen items-end justify-center px-4 pb-20 pt-4 text-center sm:block sm:p-0",children:[(0,l.jsx)(i.V.Overlay,{className:"fixed inset-0 bg-black opacity-50 transition-opacity"}),(0,l.jsx)("span",{className:"hidden sm:inline-block sm:h-screen sm:align-middle","aria-hidden":"true",children:"​"}),(0,l.jsx)(n.u.Child,{as:o.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",enterTo:"opacity-100 translate-y-0 sm:scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 translate-y-0 sm:scale-100",leaveTo:"opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95",children:(0,l.jsx)("div",{className:"inline-block transform overflow-hidden bg-white px-4 pb-4 pt-5 text-left align-bottom shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg sm:p-6 sm:align-middle",children:(0,l.jsxs)("form",{onSubmit:eE,children:[(0,l.jsx)("div",{className:"sm:flex sm:items-start",children:(0,l.jsxs)("div",{className:"mt-3 sm:mt-0 sm:text-left",children:[(0,l.jsx)(i.V.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900",children:X("magicBlock.templateModal.title")}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)("p",{className:"text-sm text-gray-500",children:X("magicBlock.templateModal.text")})}),(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)("input",{name:"blockTemplateName",placeholder:X("magicBlock.templateModal.placeholder")||"",maxLength:20,className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm text-gray-700 focus:outline-none focus:ring-2 focus:ring-sky-500"})})]})}),(0,l.jsxs)("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[(0,l.jsx)(F.z,{type:"submit",className:"w-full sm:ml-3 sm:w-auto",children:X("magicBlock.templateModal.save")}),(0,l.jsx)(F.z,{variant:"outline",onClick:()=>eh(!1),className:"mt-3 w-full sm:mt-0 sm:w-auto",children:X("magicBlock.templateModal.cancel")})]})]})})})]})})}),(0,l.jsx)(tw,{isOpen:ej,currentName:a.outputName,onConfirm:eA,onClose:()=>eN(!1)}),ef&&(0,l.jsx)(tj,{blockId:a.id,loopId:$||"",supabaseClient:Y,onRestore:e=>{I(e),ev(!1)},onClose:()=>ev(!1)})]})});tS.displayName="Block";var tL=tS},253:function(e,t,a){a.d(t,{q:function(){return y}});var l=a(74817),s=a(71248),r=a(45512),n=a(23489),i=a(45968),o=a(88593),c=a(44016),d=a(40111),u=a(46114),m=a(81173),p=a(7988),x=a(28702);let h=(e,t,a)=>{if(!t&&e.length>0){let t=e[0].title;return a(t),t}if(t&&!e.some(e=>e.title===t)){let t=e.length>0?e[0].title:"";return a(t),t}return t},g=async(e,t,a,l)=>e?h(await l(e),t,a):"",f=e=>{let t=e.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);return t?t[1]:e};var b=a(86774),v=a(89970);let y=e=>{let{value:t,onChange:a,disabled:h=!1,placeholder:y="Select a spreadsheet...",showSaveToCollection:j=!0,label:N="Spreadsheet",description:k,suggestedName:w,autoTriggerCreate:_=!1,worksheet:C,onWorksheetChange:I,showWorksheetSelector:T=!1,onCreateCanceled:S}=e,{savedSpreadsheets:L,isLoading:O,worksheets:E,isLoadingWorksheets:Z,loadSavedSpreadsheets:A,addToCollection:P,createNewSpreadsheet:F,updateLastAccessed:M,loadWorksheets:B}=(0,x.j)(),[R,K]=(0,s.useState)(!1),[z,U]=(0,s.useState)(""),[D,V]=(0,s.useState)(!1),[q,$]=(0,s.useState)(!1),[G,J]=(0,s.useState)(""),[W,H]=(0,s.useState)(!1),[Y,X]=(0,s.useState)(""),[Q,ee]=(0,s.useState)(!1),[et,ea]=(0,s.useState)(!1),el=(0,b.e)(),es=(0,s.useRef)(I);es.current=I;let er=(0,s.useCallback)(async()=>{T&&t&&void 0!==C&&es.current&&t!==Y&&(await g(t,C,es.current,B),X(t))},[t,C,B,T,Y]),en=async e=>{if(!e.trim())return!1;try{return V(!0),await P(e)}finally{V(!1)}},ei=async()=>{if(!G.trim())return!1;try{$(!0);let e=await F(G.trim());if(e)return a(e),ea(!0),H(!1),J(""),K(!1),!0;return!1}finally{$(!1)}},eo=e=>{let t=f(e);U(e),a(t)},ec=e=>{"__manual__"===e?(K(!0),U(t||"")):e&&"__placeholder__"!==e&&"__loading__"!==e&&"__create__"!==e?(a(e),K(!1),M(e)):"__create__"===e&&(J(w||""),H(!0))},ed=t&&L.some(e=>e.spreadsheetId===t),eu=L.find(e=>e.spreadsheetId===t),em=R||0===L.length;return(0,s.useEffect)(()=>{A()},[A]),(0,s.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await el.auth.getUser();ee((0,v.G)(null==e?void 0:e.id))}catch(e){console.error("Error checking admin status:",e),ee(!1)}})()},[el]),(0,s.useEffect)(()=>{T&&er()},[er,T]),(0,s.useEffect)(()=>{t!==Y&&""!==Y&&X("")},[t,Y]),(0,s.useEffect)(()=>{!_||W||O||(J(w||""),H(!0))},[_,w,W,O]),(0,l.jsxs)("div",{className:"w-full space-y-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(r._,{className:"text-sm font-medium",children:N}),k&&(0,l.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:k})]}),!O&&L.length>0&&!R&&(0,l.jsx)("div",{className:"w-full space-y-2",children:(0,l.jsxs)("div",{className:"flex w-full gap-2",children:[(0,l.jsx)("div",{className:T&&t?"flex-1":"min-w-0 flex-1",children:(0,l.jsxs)(u.Z,{id:"spreadsheet-select",value:ed?t:"",onChange:e=>ec(e.target.value),disabled:h,className:"w-full",children:[(0,l.jsx)("option",{value:"",disabled:!0,children:y}),_&&(0,l.jsx)("option",{value:"__create__",children:"➕ Create New Spreadsheet"}),L.map(e=>(0,l.jsxs)("option",{value:e.spreadsheetId,children:["\uD83D\uDCCA ",e.title]},e.spreadsheetId)),!_&&(0,l.jsx)("option",{value:"__create__",children:"➕ Create New Spreadsheet"}),Q&&(0,l.jsx)("option",{value:"__manual__",children:"✏️ Enter Custom ID... (Admin Only)"})]})}),T&&t&&(0,l.jsx)("div",{className:"w-48",children:Z?(0,l.jsx)("div",{className:"flex h-10 items-center justify-center rounded-md border bg-gray-50 p-2",children:(0,l.jsx)(i.Z,{className:"h-4 w-4 animate-spin"})}):(0,l.jsx)(u.Z,{value:C||"",onChange:e=>null==I?void 0:I(e.target.value),disabled:h||0===E.length,className:"w-full",children:E.map(e=>(0,l.jsxs)("option",{value:e.title,children:[e.title,e.gridProperties&&" (".concat(e.gridProperties.rowCount,"\xd7").concat(e.gridProperties.columnCount,")")]},e.sheetId))})}),eu&&(0,l.jsx)(m.Z,{onClick:()=>window.open(eu.spreadsheetUrl,"_blank"),className:"h-10 w-10 flex-shrink-0 p-0",title:"Open ".concat(eu.title," in Google Sheets"),children:(0,l.jsx)(o.Z,{className:"h-4 w-4"})})]})}),em&&(0,l.jsxs)("div",{className:"w-full space-y-2",children:[(0,l.jsxs)("div",{className:"flex w-full gap-2",children:[Q&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p.Z,{value:z,onChange:e=>eo(e.target.value),placeholder:"Paste spreadsheet ID or URL... (Admin Only)",disabled:h,className:"min-w-0 flex-1"}),L.length>0&&(0,l.jsx)(m.Z,{onClick:()=>{K(!1),U("")},disabled:h,className:"whitespace-nowrap",children:"Select Saved"})]}),(0,l.jsxs)(m.Z,{onClick:()=>{J(w||""),H(!0)},disabled:h,className:"whitespace-nowrap",children:[(0,l.jsx)(c.Z,{className:"mr-1 h-4 w-4"}),"Create New"]})]}),(0,l.jsx)("div",{className:"text-xs text-gray-500",children:Q?"Create a new Google Sheet or enter an existing spreadsheet ID (Admin)":"Create a new Google Sheet to get started"}),Q&&j&&t&&!ed&&(0,l.jsx)(m.Z,{onClick:()=>en(t),disabled:D||h,className:"w-full",children:D?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Adding to Collection..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(d.Z,{className:"mr-2 h-4 w-4"}),"Save to Collection (Admin Only)"]})})]}),O&&(0,l.jsxs)("div",{className:"flex items-center justify-center p-4 text-gray-500",children:[(0,l.jsx)(i.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Loading your spreadsheets..."]}),(0,l.jsx)(n.Vq,{open:W,onOpenChange:e=>{H(e),e||et||null==S||S(),e||ea(!1)},children:(0,l.jsxs)(n.cZ,{className:"sm:max-w-md",children:[(0,l.jsx)(n.fK,{children:(0,l.jsx)(n.$N,{children:"Create New Spreadsheet"})}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)(r._,{htmlFor:"sheet-title",children:"Spreadsheet Title"}),(0,l.jsx)(p.Z,{id:"sheet-title",value:G,onChange:e=>J(e.target.value),placeholder:"Enter a title for your new spreadsheet",disabled:q,className:"mt-1 w-full",onKeyDown:e=>{"Enter"===e.key&&G.trim()&&ei()}})]}),(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,l.jsx)(m.Z,{onClick:()=>{ea(!0),H(!1),J(""),null==S||S()},disabled:q,className:"bg-gray-300 hover:bg-gray-400",children:"Cancel"}),(0,l.jsx)(m.Z,{onClick:ei,disabled:!G.trim()||q,className:"min-w-[100px] bg-green-400 hover:bg-green-500 disabled:bg-green-300",children:q?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(c.Z,{className:"mr-2 h-4 w-4"}),"Create"]})})]})]})]})})]})}},37539:function(e,t,a){a.d(t,{Z:function(){return L}});var l=a(74817),s=a(71248),r=a(31521),n=a(73853);let i={displayName:"Default",fragments:{edit:"rgb(42, 161, 152)"},styles:{container:{backgroundColor:"#fff",fontFamily:"monospace"},collection:{},collectionInner:{},collectionElement:{},dropZone:{},property:"#292929",bracket:{color:"rgb(0, 43, 54)",fontWeight:"bold"},itemCount:{color:"rgba(0, 0, 0, 0.3)",fontStyle:"italic"},string:"rgb(203, 75, 22)",number:"rgb(38, 139, 210)",boolean:"green",null:{color:"rgb(220, 50, 47)",fontVariant:"small-caps",fontWeight:"bold"},input:["#292929",{fontSize:"90%"}],inputHighlight:"#b3d8ff",error:{fontSize:"0.8em",color:"red",fontWeight:"bold"},iconCollection:"rgb(0, 43, 54)",iconEdit:"edit",iconDelete:"rgb(203, 75, 22)",iconAdd:"edit",iconCopy:"rgb(38, 139, 210)",iconOk:"green",iconCancel:"rgb(203, 75, 22)"}},o={displayName:"Default Dark",styles:{container:{backgroundColor:"#1f1f1f",color:"white"},dropZone:"rgba(165, 214, 255, 0.17)",property:"#E6EDF3",bracket:"#56d364",itemCount:"#8B949E",string:"#A5D6FF",number:"#D2A8FF",boolean:{color:"#FF7B72",fontSize:"90%",fontWeight:"bold"},null:"green",iconCollection:"#D2A8FF",iconEdit:"#D2A8FF",iconDelete:"rgb(203, 75, 22)",iconAdd:"rgb(203, 75, 22)",iconCopy:"#A5D6FF",iconOk:"#56d364",iconCancel:"rgb(203, 75, 22)"}},c=e=>"object"==typeof e&&null!==e&&!Array.isArray(e)&&"styles"in e,d=(e,t)=>({...e,...t,styles:{...e.styles,...t.styles}}),u=(e,t)=>c(e)&&c(t)?d(e,t):e,m=(0,s.memo)(e=>{let{theme:t,rootFontSize:a="14px",collapse:c=3,...d}=e,{theme:m}=(0,n.F)(),p=(0,s.useMemo)(()=>{if(null===t)return;let e=null!=t?t:i;return"dark"===m?u(e,o):e},[t,m]);return(0,l.jsx)(r.Ad,{theme:p,rootFontSize:a,collapse:c,showArrayIndices:!1,showCollectionCount:"when-closed",stringTruncate:30,rootName:"",...d})});m.displayName="JsonEditor";var p=a(51254),x=a(51827),h=a(99507),g=a(80335),f=a(98312),b=a(77797),v=a(19249),y=a(33657),j=a(64884),N=e=>{let{outputName:t}=e,[a,r]=(0,s.useState)(!1),n=e=>{navigator.clipboard.writeText(e).then(()=>{r(!0),setTimeout(()=>r(!1),3e3)}).catch(e=>{console.error("Could not copy text: ",e)})};return(0,l.jsx)(l.Fragment,{children:t&&(0,l.jsxs)("div",{className:"relative mx-1 inline-flex items-center",children:[(0,l.jsxs)("label",{className:"inline-flex cursor-pointer",onClick:()=>n("$".concat(t)),children:["Output Variable: $".concat(null!=t?t:"—"),!a&&(0,l.jsx)("span",{className:"ml-1",children:(0,l.jsx)(y.Z,{className:"h-4 w-4"})})]}),a&&(0,l.jsxs)("span",{className:"ml-2 flex items-center text-green-600",children:[(0,l.jsx)(j.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"ml-1",children:"Copied"})]})]})})},k=a(91835),w=a(81173),_=a(31031),C=a(30836),I=e=>{let{outputName:t,characterCount:a,characterLimit:r,displayStdErr:n,duration:i,creditsUsed:o,readOnly:c,canEdit:d,isEditing:u,disabled:m,onEditToggle:p,onAiFixBlock:h,canFix:y}=e,{t:j}=(0,v.Z)("blocks"),I=(0,s.useRef)(null),[T,S]=(0,s.useState)(!1),[L,O]=(0,s.useState)();(0,s.useEffect)(()=>{if(T){var e;null===(e=I.current)||void 0===e||e.focus()}},[T]);let E=(0,s.useCallback)(async()=>{if(!n){O(void 0),S(e=>!e);return}await h()},[n,h]),Z=(0,s.useCallback)(async()=>{S(!1),await h(L)},[L,h]),A=(0,s.useCallback)(e=>{T&&("Enter"!==e.key||e.shiftKey?"Escape"===e.key&&(e.preventDefault(),S(!1)):(e.preventDefault(),Z()))},[T,Z]);return(0,l.jsxs)("div",{className:"flex w-full flex-col items-center justify-between px-1 pb-1 pt-3 dark:bg-[#1f1f1f] dark:text-gray-300 sm:flex-row",children:[(0,l.jsxs)("div",{className:"flex w-full flex-col justify-center gap-1 text-xs text-slate-400 dark:text-gray-400",children:[t&&(0,l.jsx)(N,{outputName:t}),(0,l.jsx)("label",{className:"mx-1",children:j("magicBlock.footer.characters",{characterCount:(0,_.ER)(a),characterLimit:(0,_.ER)(r)})}),i&&(0,l.jsx)("label",{className:"mx-1",children:j("magicBlock.footer.duration",{duration:(0,C.LU)(i)})}),void 0!==o&&(0,l.jsx)("label",{className:"mx-1",children:j("magicBlock.footer.creditsUsed",{credits:Math.round(o)})})]}),!c&&(0,l.jsxs)("div",{className:"flex w-full flex-row justify-end gap-2 pt-4 sm:w-auto sm:pt-0",children:[d&&(0,l.jsx)("button",{className:"rounded-lg pl-2.5 pr-2 enabled:hover:bg-gray-100 disabled:opacity-50 dark:enabled:hover:bg-[#2a2a2a] ".concat(u?"bg-gray-100 text-sky-600 dark:bg-[#2a2a2a] dark:text-sky-500":"text-gray-400 dark:text-gray-500"),disabled:m||!d,onClick:p,children:u?(0,l.jsx)(g.Z,{size:22}):(0,l.jsx)(f.Z,{size:22})}),(0,l.jsxs)("div",{className:"relative text-base",children:[(0,l.jsx)(k.Z,{content:T?void 0:j(y?"magicBlock.footer.fixButton.tooltip.fix":"magicBlock.footer.fixButton.tooltip.runFirst"),children:(0,l.jsx)(w.Z,{variant:"outline",disabled:m||!y,onClick:E,className:"\n                  flex min-w-[4rem] items-center justify-center\n                  bg-orange-300 \n                  enabled:hover:bg-orange-400 \n                  disabled:opacity-50 \n                  dark:bg-orange-300 \n                  dark:enabled:hover:bg-orange-400\n                ",children:j("magicBlock.footer.fixButton.label")})}),T&&(0,l.jsxs)("div",{className:"border-1 absolute right-0 z-[50] mt-1.5 flex w-[300px] flex-row rounded-lg border border-neutral-200 bg-white pr-1 pt-1 shadow-md dark:border-[#2a2a2a] dark:bg-[#1f1f1f]",children:[(0,l.jsx)(x.Z,{ref:I,disabled:m,includeBorders:!1,minRowCount:1,maxRowCount:4,placeholder:j("magicBlock.footer.hintPlaceholder"),textClassName:"p-2 dark:text-gray-300",onChange:e=>O(e),onKeyDown:A,value:L}),(0,l.jsx)("button",{className:"my-1 rounded-lg px-1 text-gray-400 enabled:hover:bg-gray-100 dark:text-gray-500 dark:enabled:hover:bg-[#2a2a2a]",onClick:()=>Z(),children:(0,l.jsx)(g.Z,{size:22})}),(0,l.jsx)("button",{className:"my-1 rounded-lg px-1 text-gray-400 enabled:hover:bg-gray-100 dark:text-gray-500 dark:enabled:hover:bg-[#2a2a2a]",onClick:()=>S(!1),children:(0,l.jsx)(b.Z,{size:22})})]})]})]})]})},T=a(50547);let S=(0,s.memo)(e=>{var t,a;let{outputName:r,block:n,blockResult:i,onChange:o,onAiFixBlock:c,running:d,disabled:u,readOnly:g,placeholder:f,className:b="",highlight:v=!1,disableJson:y=!1,disableMarkdown:j=!1,runType:N}=e,[k,w]=(0,s.useState)(),[_,C]=(0,s.useState)(!1),[S,L]=(0,s.useState)(""),O=(0,s.useRef)(!1),E=(0,s.useRef)(null),Z=void 0!==k;(0,s.useEffect)(()=>{if(!_||Z){let e=setTimeout(()=>{let e;try{if(!y&&(null==i?void 0:i.stdout)&&i.stdout.length<5e4){let t=JSON.parse(i.stdout);("object"==typeof t||Array.isArray(t))&&(e=t)}}catch(e){}w(e)},500);return()=>clearTimeout(e)}},[null==i?void 0:i.stdout,y,_,Z]);let A=(0,s.useMemo)(()=>{var e;return null==i?void 0:null===(e=i.stdout)||void 0===e?void 0:e.slice(0,5e4)},[null==i?void 0:i.stdout]),P=(0,s.useMemo)(()=>{var e;return null==i?void 0:null===(e=i.stderr)||void 0===e?void 0:e.slice(0,5e4)},[null==i?void 0:i.stderr]),F=(0,s.useMemo)(()=>{var e;return(null!==(e=null==i?void 0:i.stdout)&&void 0!==e?e:"").length<5e4},[null==i?void 0:i.stdout,Z,n.type]),M=(0,s.useMemo)(()=>!!(A||P),[P,A]);(0,s.useEffect)(()=>{if(_){Z?L(JSON.stringify(JSON.parse(A||""),null,2)||""):L(A||""),O.current=!0;let e=E.current;if(e){let t=e.value.length;e.setSelectionRange(t,t),e.scrollTop=e.scrollHeight,e.scrollIntoView({behavior:"smooth",block:"nearest"})}}},[_,A,Z]);let B=(0,s.useCallback)(()=>{if(_){if(C(!1),Z){let e=JSON.stringify(k,null,2);null==o||o(e)}else null==o||o(S)}else C(!0),Z||L(A||"")},[_,S,o,A,k,Z]),R=(null==i?void 0:i.durationMs)||null;return(0,l.jsxs)("div",{className:"bg-white dark:bg-[#1f1f1f] ".concat(b," "),children:[P&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(x.Z,{disabled:!0,includeBorders:!1,minRowCount:1,textClassName:"pl-4 pt-3 pb-2 text-red-600 text-sm dark:text-red-400",value:P}),(0,l.jsx)("div",{className:"h-[1px] bg-gray-200 dark:bg-gray-700",style:{width:"calc(100% - 2rem)",marginLeft:"1rem",marginRight:"1rem"}})]}),_||A||!P?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"min-h-[48px] pl-2",children:[(0,l.jsx)(h.Z,{text:(null==i?void 0:i.stdout)||"",className:"absolute right-1 top-1 z-10 mr-1 mt-1"}),(!Z||["image-generation","email-trigger","email","sms"].includes(n.type))&&!_&&A&&(0,l.jsx)("div",{className:"overflow-hidden pr-8 md:rounded-t-lg",children:(0,l.jsx)(T.Z,{type:n.type,displayStdOut:A,disableMarkdown:j,json:k,editMode:_,runType:N})}),!Z||_||["image-generation","email-trigger","email","sms"].includes(n.type)?_?(0,l.jsx)("div",{className:"m-3 ml-0 pr-8",children:(0,l.jsx)(x.Z,{ref:E,placeholder:f,disabled:u,includeBorders:!0,containerClassName:"bg-white/50 dark:bg-[#2a2a2a]",textClassName:"text-black/90 disabled:opacity-50 dark:text-gray-200",value:S,onChange:e=>L(e),onBlur:()=>{C(!1),null==o||o(S)}})}):!A&&(0,l.jsx)("p",{className:"py-1 text-gray-400 dark:text-gray-500",children:f||""}):(0,l.jsx)("div",{className:"max-h-[525px] overflow-scroll pb-2 pr-8",children:(0,l.jsx)(m,{data:k,onUpdate:e=>{w(e.newData),null==o||o(JSON.stringify(e.newData,null,2))},rootFontSize:"14px",collapse:5})})]}),d&&(0,l.jsx)(p.Z,{size:"20px",className:"mb-4 mt-1 w-full dark:text-gray-400"}),(0,l.jsx)("div",{className:"h-[1px] bg-gray-200 dark:bg-gray-700",style:{width:"calc(100% - 1rem)",marginLeft:"0.5rem",marginRight:"1rem"}})]}):(0,l.jsx)(l.Fragment,{}),c&&(0,l.jsx)(I,{outputName:r,characterCount:null!==(a=null==i?void 0:null===(t=i.stdout)||void 0===t?void 0:t.length)&&void 0!==a?a:0,characterLimit:5e4,displayStdErr:P,duration:R,creditsUsed:null==i?void 0:i.creditsUsed,readOnly:g,canEdit:F,isEditing:_,disabled:u,onEditToggle:B,onAiFixBlock:c,canFix:M})]})});S.displayName="OutputComponent";var L=S},50547:function(e,t,a){a.d(t,{Z:function(){return v}});var l=a(74817),s=a(71248),r=a(72904),n=a(94308),i=a(50141),o=a(34880),c=a(81928),d=a(63957),u=a(30836);function m(e){let{subject:t,sendDate:a,sendTo:r,replyTo:n,emailBody:m,markdown:p}=e,x=new Date;return a&&(x=new Date(a)),(0,l.jsx)(o.Zb,{className:"group my-4 dark:border-[#2a2a2a] dark:bg-[#1f1f1f]",children:(0,l.jsxs)(o.aY,{className:"flex flex-col gap-4 whitespace-pre-wrap p-4 dark:text-gray-300 sm:p-6",children:[(0,l.jsxs)("div",{className:"flex items-start gap-4",children:[(0,l.jsxs)(c.qE,{className:"border dark:border-[#2a2a2a]",children:[(0,l.jsx)(c.F$,{src:"/images/logo-gravatar.png"}),(0,l.jsx)(c.Q5,{className:"dark:text-gray-400",children:"ML"})]}),(0,l.jsxs)("div",{className:"grid flex-1 gap-1",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"font-medium dark:text-gray-100",children:"Magic Loops"}),(0,l.jsx)("div",{className:"text-xs text-muted-foreground dark:text-gray-400",children:(0,u._5)(x)})]}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground dark:text-gray-400",children:[(0,l.jsx)("span",{className:"font-medium dark:text-gray-300",children:"To:"})," ",r]}),(0,l.jsx)("div",{className:"prose overflow-hidden whitespace-pre-wrap break-words text-sm font-medium dark:text-gray-100",children:t})]})]}),(0,l.jsx)(d.Z,{className:"dark:border-[#2a2a2a]"}),(0,l.jsx)("div",{className:"prose prose-sm dark:prose-invert prose-p:leading-normal",children:p?(0,l.jsx)("div",{className:"prose max-w-none overflow-y-auto whitespace-pre-wrap break-words dark:prose-invert",children:(0,l.jsx)(i.s,{children:"".concat(null==m?void 0:m.replace(/\n/g,"  \n"))})}):(0,l.jsx)("p",{className:"prose whitespace-pre-wrap break-words dark:text-gray-300",children:m.split("\n").map((e,t)=>(0,l.jsxs)(s.Fragment,{children:[e,(0,l.jsx)("br",{})]},t))})})]})})}function p(e){let{content:t,sentAt:a,fromNumber:r}=e,n=new Date;return a&&(n=new Date(a)),(0,l.jsx)("div",{className:"mx-auto flex w-full max-w-md flex-col gap-4 pt-2",children:(0,l.jsxs)("div",{className:"flex flex-col gap-2 rounded-3xl bg-green-100 p-4 dark:bg-green-900",children:[(0,l.jsxs)("div",{className:"flex items-start gap-3",children:[(0,l.jsxs)(c.qE,{className:"h-10 w-10 shrink-0 border dark:border-green-700",children:[(0,l.jsx)(c.F$,{src:"/images/logo-gravatar.png"}),(0,l.jsx)(c.Q5,{className:"dark:text-gray-100",children:"ML"})]}),(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("div",{className:"font-medium text-black dark:text-white",children:r}),(0,l.jsx)("div",{className:"text-xs text-green-600 dark:text-green-400",children:(0,u.WA)(n)})]})]}),(0,l.jsx)("div",{className:"w-full self-start overflow-hidden text-pretty rounded-2xl bg-white px-4 py-3 text-black shadow-md dark:bg-[#1f1f1f] dark:text-gray-200",children:t.split("\n").map((e,t)=>(0,l.jsxs)(s.Fragment,{children:[e,(0,l.jsx)("br",{})]},t))})]})})}var x=a(88735),h=a.n(x),g=e=>{let{output:t}=e,a=(0,s.useMemo)(()=>{try{let e=t.trim();if(!e)return null;return JSON.parse(e)}catch(e){return console.warn("ImageGenerationOutput: stdout is not valid JSON",t),null}},[t]);return a&&Array.isArray(a.images)&&0!==a.images.length?(0,l.jsxs)("div",{className:"flex w-full flex-col items-center gap-6 p-4",children:[(0,l.jsxs)("div",{className:"text-center text-xs text-gray-500 dark:text-gray-400",children:[a.model," • ",a.size," • ",a.quality,a.inputImagesUsed?" • ".concat(a.inputImagesUsed," reference image").concat(1!==a.inputImagesUsed?"s":""):""]}),(0,l.jsxs)("div",{className:"flex flex-wrap justify-center gap-4",children:[a.images.map((e,t)=>(0,l.jsx)("div",{className:"rounded-2xl shadow",children:(0,l.jsx)(h(),{src:e,alt:"Generated image ".concat(t+1),width:512,height:512,className:"rounded-2xl",priority:0===t,unoptimized:!0})},t)),(0,l.jsx)("p",{className:"prose max-w-[500px] italic",children:null==a?void 0:a.prompt})]})]}):(0,l.jsx)("div",{className:"text-center text-sm italic text-gray-500",children:"No image generated yet"})},f=a(51827),b=a(73853),v=(0,s.memo)(e=>{let{type:t,displayStdOut:a,disableMarkdown:s=!1,json:i,editMode:o=!1,runType:c}=e,{theme:d}=(0,b.F)();if(o)return null;switch(t){case"email-trigger":try{let e=JSON.parse(a);return(0,l.jsx)(m,{subject:e.subject,replyTo:"no-reply@loops.run",emailBody:e.body,markdown:!0,sendTo:e.to})}catch(e){break}case"email":try{let e=JSON.parse(a);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(m,{subject:e.subject,replyTo:"no-reply@loops.run",emailBody:e.emailBody,markdown:e.markdown,sendDate:e.sentAt,sendTo:e.to}),"full-run"!==c&&(0,l.jsx)("p",{className:"py-2 text-slate-600 dark:text-gray-400",children:"⚠️  Note: this was just a test run, so nothing was actually sent. Please activate your Loop to send for real! \uD83D\uDE0A"})]})}catch(e){break}case"sms":try{let e=JSON.parse(a);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(p,{content:e.content,sentAt:e.sentAt,fromNumber:e.fromNumber}),"full-run"!==c&&(0,l.jsx)("p",{className:"py-2 text-slate-600 dark:text-gray-400",children:"⚠️  Note: this was just a test run, so nothing was actually sent. Please activate your Loop to send for real! \uD83D\uDE0A"})]})}catch(e){break}case"image-generation":return(0,l.jsx)(g,{output:a})}return s?(0,l.jsx)(f.Z,{disabled:!0,includeBorders:!1,textClassName:"pb-3 dark:text-gray-300",value:a}):(0,l.jsx)("div",{className:"whitespace-prep-wrap prose max-h-[484px] max-w-none overflow-y-auto break-words pb-3 pr-3 pt-1 dark:prose-invert dark:text-gray-300",children:(0,l.jsx)(r.UG,{remarkPlugins:[n.Z],children:"".concat(null==a?void 0:a.replace(/\n/g,"  \n"))})})})},85891:function(e,t,a){var l=a(74817),s=a(71248);t.Z=e=>{var t;let{text:a,displayText:r,className:n=""}=e,[i,o]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e;return i&&(e=setTimeout(()=>{o(!1)},3e3)),()=>clearTimeout(e)},[i]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("p",{className:"cursor-pointer italic ".concat(n),onClick:e=>{e.preventDefault(),navigator.clipboard&&a&&navigator.clipboard.writeText(a).then(()=>{o(!0)},e=>{console.error("Failed to copy: ",e)})},children:null!==(t=null!=r?r:a)&&void 0!==t?t:""}),i&&(0,l.jsx)("p",{className:n,children:(0,l.jsx)("span",{className:"text-sky-500",children:"Copied to clipboard!"})})]})}},80843:function(e,t,a){a.d(t,{Z:function(){return b}});var l=a(74817),s=a(93108),r=a(83743),n=a(27960),i=a(71248),o=a(64131),c=a(10434),d=a(57597),u=a(901),m=a(22929);let p=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return d.lg.fromClass(class{update(e){e.docChanged&&this.atBottom&&!this.pendingRAF&&(this.pendingRAF=!0,requestAnimationFrame(()=>{this.pendingRAF=!1,this.dom.scrollTop=this.dom.scrollHeight}))}destroy(){this.dom.removeEventListener("scroll",this.onScroll)}constructor(t){this.view=t,this.atBottom=!0,this.pendingRAF=!1,this.onScroll=()=>{let{scrollHeight:t,scrollTop:a,clientHeight:l}=this.dom;this.atBottom=t-(a+l)<=e},this.dom=t.scrollDOM,this.dom.addEventListener("scroll",this.onScroll,{passive:!0})}})};var x=e=>{let t=(0,i.useRef)(null),[a,l]=(0,i.useState)(null),s=(0,i.useRef)(e.onChange);s.current=e.onChange;let r=(0,i.useRef)(null);return(0,i.useEffect)(()=>{if(!t.current)return;let a=c.yy.create({doc:e.code,extensions:[o.Xy,m.vk,e.langSupport,d.$f.of(u.wQ),d.tk.lineWrapping,p(),d.tk.editable.of(!e.disabled),d.tk.updateListener.of(e=>{e.docChanged&&(r.current=e.state)}),d.tk.domEventHandlers({blur(t,a){var l;let n=null!==(l=r.current)&&void 0!==l?l:a.state;s.current&&n.doc.toString()!==e.code&&s.current(n)}})]}),n=new d.tk({state:a,parent:t.current});return l(n),()=>n.destroy()},[e.langSupport,e.disabled]),(0,i.useEffect)(()=>{if(!a)return;let t=a.state.doc.toString(),l=null;if(e.code.startsWith(t)){let a=e.code.slice(t.length);a.length&&(l={changes:{from:t.length,insert:a}})}else t!==e.code&&(l={changes:{from:0,to:t.length,insert:e.code}});l&&a.dispatch(l)},[a,e.code]),[t,a]},h=a(4901);let g={javascript:(0,s.eJ)(),python:(0,r.Vs)(),html:(0,n.dy)()},f={javascript:"Code can access BLOCK_INPUT, previous Block Outputs, and all Loop Variables as normal variables (strings or undefined).\nCode runs using Node.js 23. ",python:"Code can access BLOCK_INPUT, previous Block Outputs, and all Loop Variables as normal variables (strings or None). Code runs using Python 3.9."};var b=e=>{let{language:t,code:a,onChange:s,disabled:r,streaming:n,title:i,note:o,className:c=""}=e,[d,u]=x({langSupport:g[null!=t?t:h.mF[0]],code:null!=a?a:"",disabled:r,onChange:s?e=>{let t=e.doc.toString();!n&&s&&a!==t&&s(t)}:void 0});return(0,l.jsxs)("div",{className:"space-y-2 ".concat(c),children:[i&&(0,l.jsx)("p",{className:"mt-2 rounded-lg bg-transparent px-1.5 font-semibold text-black/80 focus:outline-none dark:text-white/80",children:i}),(0,l.jsx)("div",{className:"".concat(r?"opacity-80":""," h-full min-h-0 overflow-auto"),ref:d}),o&&(0,l.jsx)("p",{className:"rounded-lg bg-transparent px-1.5 pt-2 text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:o}),"html"!==t&&(0,l.jsx)("p",{className:"bg-transparent px-1.5 pt-2 text-xs italic text-black/40 focus:outline-none dark:text-white/40",children:f[null!=t?t:h.mF[0]]})]})}},99507:function(e,t,a){var l=a(74817),s=a(71248),r=a(33657);t.Z=function(e){let{text:t,className:a=""}=e,[n,i]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{let e;return n&&(e=setTimeout(()=>{i(!1)},3e3)),()=>clearTimeout(e)},[n]),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("div",{onClick:e=>{e.preventDefault(),navigator.clipboard&&t&&navigator.clipboard.writeText(t).then(()=>{i(!0)},e=>{console.error("Failed to copy: ",e)})},className:"cursor-pointer ".concat(a),children:(0,l.jsx)(r.Z,{size:18,className:"text-black hover:text-sky-500 dark:text-gray-400 dark:hover:text-sky-400"})}),n&&(0,l.jsx)("div",{className:"absolute left-1/2 top-full mt-1 -translate-x-1/2 transform rounded bg-gray-800 px-2 py-1 text-xs text-white dark:bg-gray-700 dark:text-gray-200",children:"Copied to clipboard!"})]})}},48029:function(e,t,a){var l=a(74817),s=a(71248),r=a(51827),n=a(2002);let i=s.forwardRef((e,t)=>{let{containerClassName:a,textClassName:s,...i}=e;return(0,l.jsx)(r.Z,{ref:t,containerClassName:(0,n.cn)("pl-2 p-2 rounded-none border-2 border-black bg-white dark:bg-[#212121] shadow-[2px_2px_0_0_rgba(0,0,0,1)]",a),textClassName:(0,n.cn)("pl-1 pt-1 text-black dark:text-white/80 text-sm",s),includeBorders:!1,...i})});i.displayName="NeoAutoGrowTextarea",t.Z=i},46114:function(e,t,a){var l=a(74817),s=a(71248),r=a(2002);let n=(0,s.forwardRef)((e,t)=>{let{children:a,className:s,...n}=e;return(0,l.jsxs)("div",{className:"grid w-full",children:[(0,l.jsx)("svg",{className:"pointer-events-none relative right-2 z-10 col-start-1 row-start-1 h-4 w-4 self-center justify-self-end forced-colors:hidden",viewBox:"0 0 16 16",fill:"currentColor","aria-hidden":"true",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M4.22 6.22a.75.75 0 0 1 1.06 0L8 8.94l2.72-2.72a.75.75 0 1 1 1.06 1.06l-3.25 3.25a.75.75 0 0 1-1.06 0L4.22 7.28a.75.75 0 0 1 0-1.06Z",clipRule:"evenodd"})}),(0,l.jsx)("select",{ref:t,className:(0,r.cn)("col-start-1 row-start-1 cursor-pointer appearance-none rounded-none border-2 border-black bg-white p-2 px-3 text-sm text-black shadow-[2px_2px_0_0_rgba(0,0,0,1)] outline-none transition-all hover:translate-x-[1px] hover:translate-y-[1px] hover:shadow-[1px_1px_0_0_rgba(0,0,0,1)] enabled:hover:outline-none dark:bg-[#212121] dark:text-white/80",s),...n,children:a})]})});n.displayName="NeoSelect",t.Z=n},15305:function(e,t,a){var l=a(74817);a(71248);var s=a(97447),r=a(91835);t.Z=e=>{let{disabled:t,color:a,content:n,className:i=""}=e,o="light"===a?t?"text-white/20 border-white/10":"text-white/40 border-white/30":t?"text-black/30 border-black/20":"text-black/60 border-black/40";return(0,l.jsx)(r.Z,{content:n,disabled:t,hoverTimeMs:"none",children:(0,l.jsx)("div",{className:"".concat(o," cursor-pointer ").concat(i),children:(0,l.jsx)(s.Z,{className:"h-4 w-4 text-muted-foreground"})})})}},23489:function(e,t,a){a.d(t,{$N:function(){return p},Vq:function(){return o},cZ:function(){return u},fK:function(){return m}});var l=a(74817),s=a(71248),r=a(53263),n=a(94620),i=a(2002);let o=r.fC;r.xz;let c=r.h_;r.x8;let d=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(r.aV,{ref:t,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...s})});d.displayName=r.aV.displayName;let u=s.forwardRef((e,t)=>{let{className:a,children:s,...o}=e;return(0,l.jsxs)(c,{children:[(0,l.jsx)(d,{}),(0,l.jsxs)(r.VY,{ref:t,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...o,children:[s,(0,l.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,l.jsx)(n.Z,{className:"h-4 w-4"}),(0,l.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});u.displayName=r.VY.displayName;let m=e=>{let{className:t,...a}=e;return(0,l.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t),...a})};m.displayName="DialogHeader";let p=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(r.Dx,{ref:t,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...s})});p.displayName=r.Dx.displayName,s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(r.dk,{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",a),...s})}).displayName=r.dk.displayName},45512:function(e,t,a){a.d(t,{_:function(){return c}});var l=a(74817),s=a(71248),r=a(69698),n=a(82898),i=a(2002);let o=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=s.forwardRef((e,t)=>{let{className:a,...s}=e;return(0,l.jsx)(r.f,{ref:t,className:(0,i.cn)(o(),a),...s})});c.displayName=r.f.displayName},63957:function(e,t,a){a.d(t,{Z:function(){return i}});var l=a(74817),s=a(71248),r=a(47754),n=a(2002);let i=s.forwardRef((e,t)=>{let{className:a,orientation:s="horizontal",decorative:i=!0,...o}=e;return(0,l.jsx)(r.f,{ref:t,decorative:i,orientation:s,className:(0,n.cn)("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",a),...o})});i.displayName=r.f.displayName},28702:function(e,t,a){a.d(t,{j:function(){return r}});var l=a(71248);let s=e=>({...e,spreadsheetId:e.spreadsheet_id||e.spreadsheetId,spreadsheetUrl:e.spreadsheet_url||e.spreadsheetUrl,createdTime:e.created_time||e.createdTime||e.created_at,modifiedTime:e.modified_time||e.modifiedTime||e.modified_at||e.updated_at,sheets:e.sheets_info||e.sheets||[]}),r=()=>{let[e,t]=(0,l.useState)([]),[a,r]=(0,l.useState)(!0),[n,i]=(0,l.useState)(null),[o,c]=(0,l.useState)([]),[d,u]=(0,l.useState)(!1),m=(0,l.useCallback)(async()=>{try{r(!0),i(null);let e=await fetch("/api/userDataTables/list"),a=await e.json();if(a.success){let e=(a.data||[]).map(s);t(e)}else i(a.error||"Failed to load data tables")}catch(e){console.error("Error loading saved spreadsheets:",e),i("Failed to load data tables")}finally{r(!1)}},[]),p=(0,l.useCallback)(async e=>{if(!e.trim())return!1;try{let t=await fetch("/api/userDataTables/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spreadsheetId:e.trim()})}),a=await t.json();if(a.success)return await m(),!0;return console.error("Failed to add to collection:",a.error),i(a.error||"Failed to add to collection"),!1}catch(e){return console.error("Error adding to collection:",e),i("Failed to add to collection"),!1}},[m]),x=(0,l.useCallback)(async e=>{if(!e.trim())return null;try{let t=await fetch("/api/googleSheets/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:e.trim()})}),a=await t.json();if(!a.success)return console.error("Failed to create sheet:",a.error),i(a.error||"Failed to create spreadsheet"),null;{let e=a.data.spreadsheetId;return await p(e),e}}catch(e){return console.error("Error creating sheet:",e),i("Failed to create spreadsheet"),null}},[p]),h=(0,l.useCallback)(async e=>{try{let t=await fetch("/api/userDataTables/remove",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({spreadsheetId:e})}),a=await t.json();if(a.success)return await m(),!0;return i(a.error||"Failed to remove sheet from collection"),!1}catch(e){return console.error("Error removing sheet:",e),i("Failed to remove sheet"),!1}},[m]),g=(0,l.useCallback)(async()=>{try{r(!0),i(null);let e=await fetch("/api/userDataTables/refresh",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await e.json();if(t.success)return await m(),t.errors&&t.errors.length>0&&(console.warn("Some spreadsheets could not be refreshed:",t.errors),i("Some spreadsheets could not be refreshed: ".concat(t.errors.join(", ")))),!0;return i(t.error||"Failed to refresh spreadsheets"),!1}catch(e){return console.error("Error refreshing spreadsheets:",e),i("Failed to refresh spreadsheets"),!1}finally{r(!1)}},[m]),f=(0,l.useCallback)(async e=>{try{await fetch("/api/userDataTables/updateLastAccessed",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spreadsheetId:e})})}catch(e){console.error("Error updating last accessed time:",e)}},[]),b=(0,l.useCallback)(async e=>{if(!e)return c([]),[];try{var t;u(!0);let a=await fetch("/api/googleSheets/info",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spreadsheetId:e})}),l=await a.json();if(!l.success||null===(t=l.data)||void 0===t||!t.sheets)return c([]),[];{let e=l.data.sheets;return c(e),e}}catch(e){return console.error("Error loading worksheets:",e),c([]),[]}finally{u(!1)}},[]),v=(0,l.useCallback)(async(e,t)=>{if(!e||!t.trim())return null;try{let a=await fetch("/api/googleSheets/createWorksheet",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spreadsheetId:e.trim(),title:t.trim()})}),l=await a.json();if(l.success)return await b(e),l.data.sheetId;return console.error("Failed to create worksheet:",l.error),i(l.error||"Failed to create worksheet"),null}catch(e){return console.error("Error creating worksheet:",e),i("Failed to create worksheet"),null}},[b]);return{savedSpreadsheets:e,isLoading:a,error:n,worksheets:o,isLoadingWorksheets:d,loadSavedSpreadsheets:m,addToCollection:p,createNewSpreadsheet:x,removeFromCollection:h,refreshCollection:g,updateLastAccessed:f,loadWorksheets:b,createNewWorksheet:v,clearError:()=>i(null)}}},28923:function(e,t,a){a.d(t,{R:function(){return s},r:function(){return l}});let l=["owner-only","anyone-with-link","discoverable"],s=/^[A-Z][A-Z0-9_]*$/},37942:function(e,t,a){async function l(e,t,a,l,s,r){try{let{data:n,error:i}=await a.from("block_generation_history").select("version").eq("block_id",e.id).eq("loop_id",t.id).order("version",{ascending:!1}).limit(1);if(i)throw i;let o=n&&n.length>0?n[0].version+1:1,{error:c}=await a.from("block_generation_history").insert({loop_id:t.id,block_id:e.id,user_id:t.ownerId,version:o,block_content:e,generation_type:l,generation_mode:s,parent_block_id:r});if(c)throw c}catch(e){console.error("Failed to save block history:",e)}}async function s(e,t,a){try{let{data:l,error:s}=await a.from("block_generation_history").select("*").eq("block_id",e).eq("loop_id",t).order("created_at",{ascending:!1});if(s)throw s;return l||[]}catch(e){return console.error("Failed to fetch block history:",e),[]}}a.d(t,{M:function(){return s},e:function(){return l}})}}]);